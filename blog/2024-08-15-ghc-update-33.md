---
slug: 2024-08-15-ghc-update
title: "IOG GHC Update #33"
authors: [sylvain,doyougnu,luite]
tags: [ghc,ghc-update]
---

Triweekly update from the GHC DevX team at IOG.

<!-- truncate -->

Previous updates can be found [here](https://engineering.iog.io/tags/ghc-update).

## High-level Summary

The team is continuing the work on characterizing and upstreaming some GHC patches that are
only present in haskell.nix-provided GHCs.

## Details

Sylvain: fixed CI of his [haskus-utils-variant](https://hackage.haskell.org/package/haskus-utils-variant) package that is used by [ghcup](https://www.haskell.org/ghcup/) and that was causing [build failure in nixpkgs](https://github.com/NixOS/nixpkgs/issues/212716#issuecomment-2290942272). In the process I've fixed an issue in doctests about error links produced by GHC 9.10 [doctest#448](https://github.com/sol/doctest/pull/448).

Sylvain: encountered and fixed an issue where GHC would pick the wrong `ghcversion.h` file which defines CPP constants such as `__GLASGOW_HASKELL__` (GHC version used). As a result some CPP conditionals were incorrectly evaluated for the GHC version used and some packages failed to build. [cabal#10229](https://github.com/haskell/cabal/issues/10229) [GHC#25106](https://gitlab.haskell.org/ghc/ghc/-/issues/25106) [GHC!13070](https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13070)
