---
slug: 2024-10-17-ghc-update
title: "IOG GHC Update #36"
authors: [sylvain,doyougnu,luite]
tags: [ghc,ghc-update]
---

Triweekly update from the GHC DevX team at IOG.

<!-- truncate -->

Previous updates can be found [here](https://engineering.iog.io/tags/ghc-update).

## High-level Summary

## Details

### Code generation

Sylvain: fixed z-encoding of tuple symbols issue leading to overlong symbols.
[GHC#25364](https://gitlab.haskell.org/ghc/ghc/-/issues/25364)
[GHC!13404](https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13404).

Jeff: Swapped the use of lists with an OrdList [GHC!13221](https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13221) GHC's code generator. Unfortunately, this led to a 2% increase in compile time allocations which is unavoidable due to the need to pattern match on pattern synonyms that allocate new spine's of the OrdList. Improving the data structure also does not work because the knot tying in the Cmm Parser requires a certain amount of laziness. See [GHC#19245](https://gitlab.haskell.org/ghc/ghc/-/issues/19245) for more knot tying mayhem.

### GHC/Base Stability
Jeff: Added an RTS flag, called `--optimistic-linking` to make the runtime linker less conservative. [GHC!13012](https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13012).

Jeff: Got CLC approval to improve the stability of base by removing GHC's RTS flags out of base and into `ghc-experimental`. The present flag api in `base` will be unchanged and deprecated. This work lays the groundwork for the transition. New flags will be exposed through `ghc-experimental` instead of `base`. [GHC!13428](https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13428).

### JavaScript backend

Sylvain: [started writing a blog
post](https://github.com/input-output-hk/engineering/pull/96) to showcase the
JavaScript backend feature allowing it to compile and to link with C sources
compiled to WebAssembly/JavaScript. Once completed it will be published on this
blog.

### Binary Sizes

Jeff: Made the `SrcLoc` data type more strict, which allowed GHC to automatically unpack certain fields. This yields about a 7% reduction in certain boot libraries like `exception`. See (GHC!13381)[https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13381), this also closes (CLC!55)[https://github.com/haskell/core-libraries-committee/issues/55). While that works we can still go farther. (GHC!13438)[https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13438] tries to squeeze these fields into just two machine words (instead of 12); this is still in draft though.
