---
slug: 2023-10-05-ghc-update
title: "IOG GHC Update #18"
authors: [sylvain,doyougnu,luite,josh,bartek]
tags: [ghc,ghc-update]
---

Triweekly update from the GHC DevX team at IOG.

<!-- truncate -->

Previous updates can be found [here](https://engineering.iog.io/tags/ghc-update).

## Performance

Sylvain: started adding support for branchless code generation in GHC's x86-64 native code generator
for STG case-expressions with two cheap and ok-for-speculation alternatives. See [GHC!11315](https://gitlab.haskell.org/ghc/ghc/-/merge_requests/11315).
This is promising as [previous work](https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9654#note_471280) by Andreas showed that a ~10% performance
improvement was possible with an explicit conditional assignment primop and in our case the transformation would be automatic and would benefit even more programs.
Sadly for now there is still a subtly code generation issue: a GHC using the optimization to build test programs pass the testsuite, but a GHC itself built
with the optimization fails in some cases.

## Maintenance

Sylvain: fixed Stack support for the upcoming GHC 9.8.1.
[hi-file-parser#16](https://github.com/commercialhaskell/hi-file-parser/issues/16)
and
[hi-file-parser#17](https://github.com/commercialhaskell/hi-file-parser/pull/17)

## JS backend

Sylvain: started investigating on how to add support for foreign libraries compiled with Emscripten (e.g. C libraries like sqlite) to the JS backend. Nothing to share yet though.
