---
slug: 2023-05-18-ghc-update
title: "IOG GHC Update #10"
authors: [sylvain,doyougnu,luite,josh,bartek]
tags: [ghc,ghc-update]
---

Biweekly update from the GHC DevX team at IOG.

Previous updates can be found [here](https://engineering.iog.io/tags/ghc-update).

## JavaScript backend

- Josh: clock_gettime?

- Luite: Ported the patch to support the `process` package in the GHC JavaScript
backend from GHCJS. The old code was never fully tested and only intended to support
Cabal, so there is missing functionality and error reporting is lacking. Work is
now on the way to bring it up to level where it can be merged in the `process` package.

- Luite: Looked into the test failures for the JavaScript specific weak references.
It turned out to be caused by messing deadlock detection. Experimented with making
the JavaScript storage manager (`FinalizationRegistry`) work for deadlock detection,
but it requires signifcant changes to the representation of `ThreadId#` in the Haskell
code. For GHC 9.8 we will most likely document that deadlocks are not guaranteed to
be detected with the JavaScript backend, and give the user the option to manually run
full deadlock detection (heap scan) if desired.

- Sylvain: fixed support for the `ghcjs_HOST_OS` CPP conditional.
See [GHC#22346](https://gitlab.haskell.org/ghc/ghc/-/issues/23346)
and [GHC!10430](https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10430).

- Sylvain: fixed `getpid`. See [GHC#23399](https://gitlab.haskell.org/ghc/ghc/-/issues/23399) and [GHC!10454](https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10454).

## Deprecation warnings

- Bartek: dynflags, etc.

- Bartek: kick-off of the "deprecate instances" proposal implementation?

## Performance

- Josh: CLC approval + merge of Codec thingy

## Linker

- Sylvain: backported fix for (GHC#19421](https://gitlab.haskell.org/ghc/ghc/-/issues/19421) (`internal error: m32_allocator_init: Failed to map`) to 9.2. See [GHC!10453](https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10453)
