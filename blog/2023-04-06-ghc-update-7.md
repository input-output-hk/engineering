---
slug: 2023-04-06-ghc-update
title: "IOG GHC Update #7"
authors: [sylvain,doyougnu,luite,josh]
tags: [ghc,ghc-update]
---

Biweekly update from the GHC DevX team at IOG.

Previous updates can be found [here](https://engineering.iog.io/tags/ghc-update).

## JavaScript backend

Sylvain: fixed build of GHC with the `quickest` Hadrian flavour. It was failing due to a incorrect coercion in `ghc-heap`. See [#23181](https://gitlab.haskell.org/ghc/ghc/-/issues/23181) and [!10192](https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10192)

Jeff: Began to implement the plan to add GHCJS's optimizer to the JavaScript
backend. This item is slated for GHC 9.8 and is on our
[roadmap](https://gitlab.haskell.org/ghc/ghc/-/wikis/javascript-backend). The
[first step](https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10142), which
is now finished, is to split the intermediate representation the backend uses to
isolate all code generation. This split then allows us to change the existing
intermediate representation for the RTS and GC, remove some cruft that was
adopted from GHCJS, and add optimization passes.

Jeff: Tested generating `let` instead of `var` to take advantage of more recent
JavaScript standards than GHCJS comported to. However, this change produced such
significant runtime regressions in the generated JavaScript that we abandoned it. 

## Miscellaneous

Sylvain: Fixed linker warning issue with `-fproc-alignment=64`. See
[#20758](https://gitlab.haskell.org/ghc/ghc/-/issues/20758) and [!10200](https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10200).

Jeff: Finally landed
[MR!9702](https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9702) which
refactored GHC's driver to use more eficient data structures. This refactor
reduced allocations _for every_ test in GHC's testsuite, with an geometric mean
of -1.6%.
