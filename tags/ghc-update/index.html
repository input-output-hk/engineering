<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="IOG Engineering RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="IOG Engineering Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="IOG Engineering JSON Feed"><title data-react-helmet="true">19 posts tagged with &quot;ghc-update&quot; | IOG Engineering</title><meta data-react-helmet="true" property="og:title" content="19 posts tagged with &quot;ghc-update&quot; | IOG Engineering"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://engineering.iog.io/tags/ghc-update"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_tags_posts"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://engineering.iog.io/tags/ghc-update"><link data-react-helmet="true" rel="alternate" href="https://engineering.iog.io/tags/ghc-update" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://engineering.iog.io/tags/ghc-update" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.10ad4647.css">
<link rel="preload" href="/assets/js/runtime~main.bdfa00cb.js" as="script">
<link rel="preload" href="/assets/js/main.c7478fde.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/iohk-logo.jpg" alt="IOG" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/iohk-logo.jpg" alt="IOG" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Engineering</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Recent</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/tags">Tags</a><a class="navbar__item navbar__link" href="/archive">Archive</a></div><div class="navbar__items navbar__items--right"><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">🌜</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">🌞</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-06-01-ghc-update">IOG GHC Update #11</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-05-18-ghc-update">IOG GHC Update #10</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-05-04-ghc-update">IOG GHC Update #9</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-04-21-stacks-in-the-js-backend">Stacks in the JavaScript Backend</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-04-20-ghc-update">IOG GHC Update #8</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>19 posts tagged with &quot;ghc-update&quot;</h1><a href="/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2023-06-01-ghc-update">IOG GHC Update #11</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2023-06-01T00:00:00.000Z" itemprop="datePublished">June 1, 2023</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey M. Young</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Luite Stegeman</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Joshua Meredith</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Bartłomiej Cieślar</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Intern @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Biweekly update from the GHC DevX team at IOG.</p><p>Previous updates can be found <a href="https://engineering.iog.io/tags/ghc-update" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="javascript-backend">JavaScript backend<a class="hash-link" href="#javascript-backend" title="Direct link to heading">​</a></h2><ul><li><p>Sylvain: updated the MR implementing Template Haskell for the JS backend
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9779" target="_blank" rel="noopener noreferrer">!9779</a> to start
fixing the remaining recompilation avoidance issues.</p></li><li><p>Sylvain: prepared slides for the GHC workshop about the JS backend. See you
there next week!</p></li><li><p>Luite: Continued working on support for the <code>process</code> package with the JS backend,
moving JavaScript specific functionality into the <code>System.Process.JavaScript</code> module.
Most functionality works, but sometimes tests hang, which seems to be caused by
nodejs being inconsistent emitting events on child process creation.</p></li><li><p>Josh: merged changes to the JavaScript code rendering. Previously, we used GHC&#x27;s <code>SDoc</code>
system, which included a hack of using the <code>layLeft</code> function to remove indentation
from rendered code to improve code size. Now, code is instead rendered on one
line using GHC&#x27;s new <code>HLine</code> system. <code>HLine</code> doesn&#x27;t have to waste time on indentation
logic, and instead simply concatenates very quickly. It also renders directly to a file
handle, rather than spending memory on an intermediate <code>ByteString</code>.</p><p>Additionally, the flag <code>-ddisable-js-minifier</code> is added in this MR, which causes JS
code to be rendered with full human-readable indentation and whitespace.</p><p>See: <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10500" target="_blank" rel="noopener noreferrer">GHC!10500</a></p></li><li><p>Josh: fixed an issue where <code>ghc --supported-extensions</code> was incorrectly listing
<code>JavaScriptFFI</code>. This issue had a workaround in Cabal for several years, but the workaround
was causing issues for Cabal support in the JavaScript backend. Now, the extension is removed
from non-JavaScript targets, allowing the Cabal workaround to be reverted for new versions
of GHC.</p><p>See:</p><ul><li><a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10505" target="_blank" rel="noopener noreferrer">GHC!10505</a></li><li><a href="https://github.com/haskell/cabal/pull/8979" target="_blank" rel="noopener noreferrer">Cabal!8979</a>  </li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="deprecation-warnings">Deprecation warnings<a class="hash-link" href="#deprecation-warnings" title="Direct link to heading">​</a></h2><ul><li><p>Bartek: Deprecated exports proposal MR passes CI and has all the issues addressed, waiting for the MR to be accepted
See <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10283" target="_blank" rel="noopener noreferrer">GHC!10283</a></p></li><li><p>Bartek: Slight rework of parsing and storing the custom warnings so that it&#x27;s more generalized (for the upcoming Deprecated Instances)
See <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10531" target="_blank" rel="noopener noreferrer">GHC!10531</a></p></li><li><p>Bartek: Parsing for the Deprecated Instances implemented, still waiting for the <a href="https://github.com/ghc-proposals/ghc-proposals/pull/575" target="_blank" rel="noopener noreferrer">proposal</a> to be accepted</p></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="miscelleaneous">Miscelleaneous<a class="hash-link" href="#miscelleaneous" title="Direct link to heading">​</a></h2><ul><li>Jeff: The FUNARCH version of the <a href="https://hsyl20.fr/home/files/papers/2022-ghc-modularity.pdf" target="_blank" rel="noopener noreferrer">GHC Modularity</a> paper is submitted!</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about IOG GHC Update #11" href="/2023-06-01-ghc-update"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2023-05-18-ghc-update">IOG GHC Update #10</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2023-05-18T00:00:00.000Z" itemprop="datePublished">May 18, 2023</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey M. Young</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Luite Stegeman</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Joshua Meredith</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Bartłomiej Cieślar</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Intern @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Biweekly update from the GHC DevX team at IOG.</p><p>Previous updates can be found <a href="https://engineering.iog.io/tags/ghc-update" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="javascript-backend">JavaScript backend<a class="hash-link" href="#javascript-backend" title="Direct link to heading">​</a></h2><ul><li><p>Josh: Merged a port of <code>clock_gettime</code> from GHCJS into the JavaScript backend. This
function is required by some Cabal <code>Setup.hs</code> programs, so this brings us closer to
full Cabal functionality, as well as Unix parity.
See <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10396" target="_blank" rel="noopener noreferrer">GHC!10396</a></p></li><li><p>Luite: Ported the patch to support the <code>process</code> package in the GHC JavaScript
backend from GHCJS. The old code was never fully tested and only intended to support
Cabal, so there is missing functionality and error reporting is lacking. Work is
now on the way to bring it up to level where it can be merged in the <code>process</code> package.</p></li><li><p>Luite: Looked into the test failures for the JavaScript specific weak references.
It turned out to be caused by messing deadlock detection. Experimented with making
the JavaScript storage manager (<code>FinalizationRegistry</code>) work for deadlock detection,add
but it requires signifcant changes to the representation of <code>ThreadId#</code> in the Haskell
code. For GHC 9.8 we will most likely document that deadlocks are not guaranteed to
be detected with the JavaScript backend, and give the user the option to manually run
full deadlock detection (heap scan) if desired.</p></li><li><p>Sylvain: fixed support for the <code>ghcjs_HOST_OS</code> CPP conditional.
See <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/23346" target="_blank" rel="noopener noreferrer">GHC#22346</a>
and <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10430" target="_blank" rel="noopener noreferrer">GHC!10430</a>.</p></li><li><p>Sylvain: fixed <code>getpid</code>. See <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/23399" target="_blank" rel="noopener noreferrer">GHC#23399</a> and <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10454" target="_blank" rel="noopener noreferrer">GHC!10454</a>.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="deprecation-warnings">Deprecation warnings<a class="hash-link" href="#deprecation-warnings" title="Direct link to heading">​</a></h2><ul><li><p>Bartek: changed the way warning reporting from addUsedGRE was done from artificially removing all warning categories from dynflags to an explicit argument
See <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10414" target="_blank" rel="noopener noreferrer">GHC!10414</a></p></li><li><p>Bartek: almost finished the deprecated exports proposal, a bug left to fix in backpack
See <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10283" target="_blank" rel="noopener noreferrer">GHC!10283</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="performance">Performance<a class="hash-link" href="#performance" title="Direct link to heading">​</a></h2><ul><li>Josh: Merged improvements to the implementation of handle encoders after approval of
the CLC. By manually unboxing functions stored in the <code>CodeBuffer</code> record, the
allocations caused by allocations are reduced by ~20%, and general GHC usage is also
slightly improved.
See <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9948" target="_blank" rel="noopener noreferrer">GHC!9948</a>
and <a href="https://gitlab.haskell.org/ghc/ghc/-/jobs/1514795#L6775" target="_blank" rel="noopener noreferrer">CI Performance Tests</a></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="linker">Linker<a class="hash-link" href="#linker" title="Direct link to heading">​</a></h2><ul><li>Sylvain: backported fix for <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19421" target="_blank" rel="noopener noreferrer">GHC#19421</a> (<code>internal error: m32_allocator_init: Failed to map</code>) to 9.2. See <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10453" target="_blank" rel="noopener noreferrer">GHC!10453</a></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="misc">Misc.<a class="hash-link" href="#misc" title="Direct link to heading">​</a></h2><ul><li>Jeff: First draft of the <a href="https://hsyl20.fr/home/files/papers/2022-ghc-modularity.pdf" target="_blank" rel="noopener noreferrer">GHC Modularity</a> FUNARCH paper is complete.</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about IOG GHC Update #10" href="/2023-05-18-ghc-update"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2023-05-04-ghc-update">IOG GHC Update #9</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2023-05-04T00:00:00.000Z" itemprop="datePublished">May 4, 2023</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey M. Young</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Luite Stegeman</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Joshua Meredith</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Bartłomiej Cieślar</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Intern @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Biweekly update from the GHC DevX team at IOG.</p><p>Previous updates can be found <a href="https://engineering.iog.io/tags/ghc-update" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="javascript-backend">JavaScript backend<a class="hash-link" href="#javascript-backend" title="Direct link to heading">​</a></h2><ul><li><p>Luite: has published a blog post about how Stacks work in the JS backend:
<a href="https://engineering.iog.io/2023-04-21-stacks-in-the-js-backend" target="_blank" rel="noopener noreferrer">https://engineering.iog.io/2023-04-21-stacks-in-the-js-backend</a></p></li><li><p>Jeff: <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10260" target="_blank" rel="noopener noreferrer">GHC!10260</a>, which adds a small optimizer to the JS backend, has landed in master.</p></li><li><p>Josh &amp; Sylvain: fixed the <code>-fcheck-prim-bound</code> feature for the JS backend.
See <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/23123" target="_blank" rel="noopener noreferrer">GHC#23123</a> and
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10234" target="_blank" rel="noopener noreferrer">GHC!10234</a></p></li><li><p>Luite: improved gc pause times for the JS backend for programs that do not
use weak references, by omitting heap scans if there are no pending finalizers.
See <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10379" target="_blank" rel="noopener noreferrer">GHC!10379</a></p></li></ul><ul><li><p>Josh: refactored some code related to saturated/unsaturated ASTs:</p><ul><li>First, the <code>identsS</code>/<code>identsE</code>/<code>identsV</code> functions were changed to
take a <code>Sat.JStat</code> instead of an <code>Unsat.JStat</code> as an argument, since
they previously would raise an error when encountering an unsaturated
constructor (<code>Sat.JStat</code> and <code>Unsat.JStat</code> are identical other than
this constructor)
<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/23304" target="_blank" rel="noopener noreferrer">GHC#23304</a><a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10348" target="_blank" rel="noopener noreferrer">GHC!10348</a></li><li>Then, <code>jsSaturate</code> and <code>satJStat</code> were combined into one function.
Previously, <code>jsSaturate</code> would instantiate unsaturated constructors
in a <code>JStat</code> AST, but retain the <code>Unsat.JStat</code> type, and <code>satJStat</code>
would separately traverse the AST to make the simple type conversion.
Since <code>jsSaturate</code> was never used without calling <code>satJStat</code> directly
after, these can be combined to traverse the AST and instantiate
unsaturated constructors in one pass.
<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/23328" target="_blank" rel="noopener noreferrer">GHC#23328</a><a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10369" target="_blank" rel="noopener noreferrer">GHC!10369</a></li></ul></li><li><p>Josh: Added the type of an STG closure to various STG data types so that
it&#x27;s passed through <code>GHC.CoreToStg.PreStgRhs</code> and <code>GHC.CoreToStg.StgRhsClosure</code>.
With this, we no longer have to guess types based on other information available
during JavaScript code generation. This fixes some issues that were revealed
in the testsuite.
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10261" target="_blank" rel="noopener noreferrer">GHC!10261</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="ghc-proposal-0134-deprecated-exports">GHC Proposal #0134 (Deprecated Exports)<a class="hash-link" href="#ghc-proposal-0134-deprecated-exports" title="Direct link to heading">​</a></h2><ul><li><p>Bartek: found a bug in warnings about duplicate exports when exporting T(..).
See <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/23318" target="_blank" rel="noopener noreferrer">GHC#23318</a></p></li><li><p>Bartek: Finished exporting part of the renamer for the Deprecating Exports proposal.
See <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10283" target="_blank" rel="noopener noreferrer">GHC!10283</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="performance">Performance<a class="hash-link" href="#performance" title="Direct link to heading">​</a></h2><ul><li><p>Jeff: First case study on performance engineering for the <a href="https://input-output-hk.github.io/hs-opt-handbook.github.io/" target="_blank" rel="noopener noreferrer">Haskell
Optimization
Handbook</a> is done
and has been published.</p></li><li><p>Josh: Added a GHC testsuite performance test for measuring memory allocations
of encoding.
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10347" target="_blank" rel="noopener noreferrer">GHC!10347</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="modularity">Modularity<a class="hash-link" href="#modularity" title="Direct link to heading">​</a></h2><ul><li>Jeff: Has begun to consolidate the
<a href="https://hsyl20.fr/home/files/papers/2022-ghc-modularity.pdf" target="_blank" rel="noopener noreferrer">ghc-modularity</a>
paper for a
<a href="https://icfp23.sigplan.org/home/funarch-2023#Call-for-Papers" target="_blank" rel="noopener noreferrer">FUNARCH</a>
submission. See you at ICFP!</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="tooling">Tooling<a class="hash-link" href="#tooling" title="Direct link to heading">​</a></h2><ul><li>Sylvain: fixed Stack&#x27;s hi-file-parser to support GHC 9.4.5 and GHC 9.6.1. See
ticket
<a href="https://github.com/commercialhaskell/hi-file-parser/issues/12" target="_blank" rel="noopener noreferrer">hi-file-parser#12</a>
and PR
<a href="https://github.com/commercialhaskell/hi-file-parser/pull/14" target="_blank" rel="noopener noreferrer">hi-file-parser#13</a>.</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about IOG GHC Update #9" href="/2023-05-04-ghc-update"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2023-04-20-ghc-update">IOG GHC Update #8</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2023-04-20T00:00:00.000Z" itemprop="datePublished">April 20, 2023</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey M. Young</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Luite Stegeman</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Joshua Meredith</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Bartłomiej Cieślar</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Intern @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Biweekly update from the GHC DevX team at IOG.</p><p>Previous updates can be found <a href="https://engineering.iog.io/tags/ghc-update" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="javascript-backend">JavaScript backend<a class="hash-link" href="#javascript-backend" title="Direct link to heading">​</a></h2><ul><li><p>Sylvain: fixed the implementation of some thread-related primops
(listThreads, getThreadLabel...).
See <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10303" target="_blank" rel="noopener noreferrer">GHC!10303</a></p></li><li><p>Sylvain: regenerated Cabal lexer with a newer Alex containing his bug fix
for the JS backend (cf previous update). Some Cabal tests had to be updated in the process because
they were relying on an Alex bug which has been fixed. This raised the question of
bug fixes vs the PVP. See <a href="https://github.com/haskell/cabal/pull/8896" target="_blank" rel="noopener noreferrer">Cabal#8896</a>,
<a href="https://github.com/haskell/alex/issues/227" target="_blank" rel="noopener noreferrer">Alex#227</a>,
and <a href="https://github.com/haskell/pvp/issues/49" target="_blank" rel="noopener noreferrer">PVP#49</a>.</p></li><li><p>Josh: added an implementation for <code>mkdir</code> for node targets. Primarily this is
expected to be used by Cabal setup scripts, but any JS backend programs running on
node will be able to use it. See <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10279" target="_blank" rel="noopener noreferrer">GHC!10279</a>.</p></li><li><p>Josh: fixed the <code>-fcheck-prim-bounds</code> flag for the JS backend. The old implementation
mostly only caused false negatives in the bounds that were rejected (i.e. it would miss
some invalid bounds), but it some cases there were also false positives, caused by
casted byte array indexing operations being indexed on the casted type&#x27;s size.
See <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10234" target="_blank" rel="noopener noreferrer">GHC!10234</a>.</p></li><li><p>Josh: fixed the JS implementation for the <code>access</code> function on files. This
function comes from C, but node also provides a direct equivalent - which the new
implementation uses. See <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10301" target="_blank" rel="noopener noreferrer">GHC!10301</a>.</p></li><li><p>Luite: Worked on optimizing finalizers by disabling heap scanning and found
an issue affecting <code>debugIO</code> in the base library. This is caused by the code
generated for <code>h$appendToHsStringA</code>. A fix is now ready, see
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10312" target="_blank" rel="noopener noreferrer">GHC!10312</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="pipeline-refactoring-and-new-ir">Pipeline refactoring and new IR<a class="hash-link" href="#pipeline-refactoring-and-new-ir" title="Direct link to heading">​</a></h3><ul><li>Jeff: <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10260" target="_blank" rel="noopener noreferrer">MR!10260</a>
ready to land. This MR paves the way for the new IR, changes the small
optimization pass the JavaScript backend had to target the current IR instead of
directly printing optimized forms, and adds an IR to IR optimizer. CI shows that
the compile time allocations for the JavaScript backend is reduced an average of
3.3% with a maximum reduction 13% with this MR. Note that these reductions
come from cleaner code generation, not from the optimizer.</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="testsuite-and-cleanup">Testsuite and cleanup<a class="hash-link" href="#testsuite-and-cleanup" title="Direct link to heading">​</a></h3><ul><li>Sylvain: replaced uses of obsolescent <code>egrep</code> with <code>grep -E</code>. Otherwise
recent <code>egrep</code> programs print a warning that makes some GHC golden tests fail.
See <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22351" target="_blank" rel="noopener noreferrer">GHC#22351</a>
and <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10308" target="_blank" rel="noopener noreferrer">GHC!10308</a>.</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="documentation">Documentation<a class="hash-link" href="#documentation" title="Direct link to heading">​</a></h3><ul><li>Luite: Finished the blog post on the lightweight stacks and calling convention
the JavaScript backend uses. This will be published on the IOG engineering blog
shortly.</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="ghc-proposal-0134-deprecated-exports">GHC Proposal #0134 (Deprecated Exports)<a class="hash-link" href="#ghc-proposal-0134-deprecated-exports" title="Direct link to heading">​</a></h2><ul><li>Bartek: Implemented the parsing and pretty printing of warnings of deprecated exports.
See <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10283" target="_blank" rel="noopener noreferrer">GHC!10283</a> for the partial
implementation of the proposal so far.</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="performance">Performance<a class="hash-link" href="#performance" title="Direct link to heading">​</a></h2><ul><li><p>Jeff : First case study on performance engineering for the <a href="https://input-output-hk.github.io/hs-opt-handbook.github.io/" target="_blank" rel="noopener noreferrer">Haskell
Optimization Handbook</a> is almost done. The case study demonstrates a first pass
of performance engineering on the klister programming language&#x27;s interpreter.
The chapter demonstrates the use of ticky ticky, info-table, biography and
retainer analysis profiling to gain a 6-fold improvement in the interpreter.</p></li><li><p>Josh: Updated the unboxed codebuffers implementation to include pattern
synonyms for backwards-compatability. Now, the implementation of handle encoding
in base can be updated to be more performant without requiring external changes.
See <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9948" target="_blank" rel="noopener noreferrer">GHC!9948</a>.</p></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about IOG GHC Update #8" href="/2023-04-20-ghc-update"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2023-04-06-ghc-update">IOG GHC Update #7</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2023-04-06T00:00:00.000Z" itemprop="datePublished">April 6, 2023</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey M. Young</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Luite Stegeman</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Joshua Meredith</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Bartłomiej Cieślar</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Intern @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Biweekly update from the GHC DevX team at IOG.</p><p>Previous updates can be found <a href="https://engineering.iog.io/tags/ghc-update" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="javascript-backend">JavaScript backend<a class="hash-link" href="#javascript-backend" title="Direct link to heading">​</a></h2><p>Sylvain: fixed build of GHC with the <code>quickest</code> Hadrian flavour.
It was failing due to a incorrect coercion in <code>ghc-heap</code>.
See <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/23181" target="_blank" rel="noopener noreferrer">#23181</a>
and <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10192" target="_blank" rel="noopener noreferrer">!10192</a></p><p>Jeff: Began to implement the plan to add GHCJS&#x27;s optimizer to the JavaScript
backend. This item is slated for GHC 9.8 and is on our
<a href="https://gitlab.haskell.org/ghc/ghc/-/wikis/javascript-backend" target="_blank" rel="noopener noreferrer">roadmap</a>. The
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10142" target="_blank" rel="noopener noreferrer">first step</a>, which
is now finished, is to split the intermediate representation the backend uses to
isolate all code generation. This split then allows us to change the existing
intermediate representation for the RTS and GC, remove some cruft that was
adopted from GHCJS, and add optimization passes.</p><p>Jeff: Tested generating <code>let</code> instead of <code>var</code> to take advantage of more recent
JavaScript standards than GHCJS comported to. However, this change produced such
significant runtime regressions in the generated JavaScript that we abandoned it. </p><p>Sylvain: fixed an out-of-bound array access in code generated by Alex, the lexer
generator, see <a href="https://github.com/haskell/alex/pull/223" target="_blank" rel="noopener noreferrer">Alex#223</a>. The out-of-bound access
only triggers an exception with the JS backend; with native backends it only causes a
benign data corruption. This was found in Cabal-syntax&#x27;s lexer, which still needs to be
regenerated, see <a href="https://github.com/haskell/cabal/issues/8892" target="_blank" rel="noopener noreferrer">Cabal#8892</a>.</p><p>Josh: brought the callbacks CLC ticket to vote. Now it has enough votes to be
passed, so we&#x27;re just awaiting a formal conclusion. Following this, the JavaScript
backend will be able to pass Haskell functions to foreign imports as JavaScript
callbacks, which in turn enables JavaScript to call into Haskell code.</p><p>Merge request: <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10128" target="_blank" rel="noopener noreferrer">GHC MR 10128</a></p><p>Josh: debugged an issue with the <code>-fcheck-prim-bounds</code> flag. The errors were mostly
false negatives in the indicies that were rejected, but there were also a false positive
due to the existing code not accounting for zero-size ranges being allowed in range-based
operations (even at indicies that don&#x27;t exist, such as negative).</p><p>Merge request: <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10234" target="_blank" rel="noopener noreferrer">GHC MR 10234</a></p><p>Luite: Worked on using the JavaScript finalization functionality for Haskell weak references.
It looks like it&#x27;s not possible to keep the existing &quot;GHC style&quot; reachability semantics from
<code>System.Mem.Weak</code>. Our new approach is to create a &quot;JavaScript style&quot; variant in <code>System.Mem.Weak.JS</code>
that avoids the need for expensive heap scanning. Both variants of weak references
can be supported by the JavaScript backend, and heap scanning can be avoided if there
are no pending finalizers for &quot;GHC style&quot; weak references (in progress).</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="compiler-performance">Compiler Performance<a class="hash-link" href="#compiler-performance" title="Direct link to heading">​</a></h2><p>Jeff: Finally landed
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9702" target="_blank" rel="noopener noreferrer">MR!9702</a> which
refactored GHC&#x27;s driver to use more eficient data structures. This refactor
reduced allocations <em>for every</em> test in GHC&#x27;s testsuite, with an geometric mean
of -1.6%.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="team">Team<a class="hash-link" href="#team" title="Direct link to heading">​</a></h2><p>The DevX team at IOG welcomes our summer intern Bartek! Bartek will be working
on GHC proposal
<a href="https://github.com/ghc-proposals/ghc-proposals/blob/master/proposals/0134-deprecating-exports-proposal.rst#implementation-plan" target="_blank" rel="noopener noreferrer">134</a>;
deprecating exports,
<a href="https://github.com/ghc-proposals/ghc-proposals/blob/master/proposals/0516-incomplete-record-selectors.rst" target="_blank" rel="noopener noreferrer">516</a>;
adding warnings for incomplete record selectors, and <a href="https://github.com/ghc-proposals/ghc-proposals/pull/575" target="_blank" rel="noopener noreferrer">deprecating
instances</a>. We are glad
to be working with him and happy to have him on the team.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="ghc-migration-and-stability">GHC migration and stability<a class="hash-link" href="#ghc-migration-and-stability" title="Direct link to heading">​</a></h2><p>Bartek: Started this sprint and has begun to read through the front end code of
GHC to begin working on one of the ghc proposal tickets next week.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="miscellaneous">Miscellaneous<a class="hash-link" href="#miscellaneous" title="Direct link to heading">​</a></h2><p>Sylvain: Fixed linker warning issue with <code>-fproc-alignment=64</code>. See
<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20758" target="_blank" rel="noopener noreferrer">#20758</a> and <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10200" target="_blank" rel="noopener noreferrer">!10200</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about IOG GHC Update #7" href="/2023-04-06-ghc-update"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2023-03-23-ghc-update">IOG GHC Update #6</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2023-03-23T00:00:00.000Z" itemprop="datePublished">March 23, 2023</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey M. Young</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Luite Stegeman</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Joshua Meredith</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Biweekly update from the GHC DevX team at IOG.</p><p>Previous updates can be found <a href="https://engineering.iog.io/tags/ghc-update" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="javascript-backend">JavaScript backend<a class="hash-link" href="#javascript-backend" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="port-of-ghcjss-callback-feature">Port of GHCJS&#x27;s Callback feature<a class="hash-link" href="#port-of-ghcjss-callback-feature" title="Direct link to heading">​</a></h3><p>Josh: opened an MR for porting GHCJS&#x27;s <code>GHCJS.Foreign.Callback</code> module into the JavaScript backend.
The <code>Callback</code> type allows for passing Haskell functions into the FFI using standard JavaScript-styled
function arguments - where compiled functions usually use global variables as registers to pass arguments.
By passing functions into FFI imports and storing references to the functions, we can enable a form
of FFI &quot;exports&quot; - since the passed functions allow JavaScript code to call back into Haskell code.</p><p>This MR additionally adds user guide documentation for both callbacks, and general JavaScript FFI usage.</p><p>We&#x27;re currently awaiting the results of a CLC proposal before the merge can be completed.</p><p>See the following links for more information:</p><ul><li><a href="https://gitlab.haskell.org/ghc/ghc/-/issues/23126" target="_blank" rel="noopener noreferrer">GHC Issue</a></li><li><a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10128" target="_blank" rel="noopener noreferrer">Merge Request</a></li><li><a href="https://github.com/haskell/core-libraries-committee/issues/150" target="_blank" rel="noopener noreferrer">CLC Proposal</a></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="pipeline-refactoring-and-new-ir">Pipeline refactoring and new IR<a class="hash-link" href="#pipeline-refactoring-and-new-ir" title="Direct link to heading">​</a></h3><p>Jeff: Began to lay the foundation for splitting the DSL in the JavaScript backend by segregating code generation to a new, basically identical DSL. The motivation is that by splitting the existing DSL, we can now replace the old DSL while still providing working builds. This is the first step in a multistep plan that eventually ends with GHCJS&#x27;s optimizer and a typed sunroof based DSL. <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10142" target="_blank" rel="noopener noreferrer">MR is up</a></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="faster-weak-references-implementation">Faster weak references implementation?<a class="hash-link" href="#faster-weak-references-implementation" title="Direct link to heading">​</a></h3><p>Luite: investigated replacing heap traversal with newer JS feature.</p><p>ES2021 has new functionality for <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakRef" target="_blank" rel="noopener noreferrer">weak references</a>
and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/FinalizationRegistry" target="_blank" rel="noopener noreferrer">finalization</a>. These do not directly map to Haskell weak references and finalizers, but it&#x27;s probably possible to use them to avoid a lot of the expensive heap scanning that we currently do.</p><p>It&#x27;s not yet clear whether we can completely remove the heap scanning while exactly preserving the current semantics for weak references.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="testsuite-and-cleanup">Testsuite and cleanup<a class="hash-link" href="#testsuite-and-cleanup" title="Direct link to heading">​</a></h3><p>Sylvain: removed dead code in the JS RTS <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10102" target="_blank" rel="noopener noreferrer">!10102</a></p><p>Sylvain: did some triage of tests in GHC&#x27;s testsuite failing with the JS backend. See tickets <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22370" target="_blank" rel="noopener noreferrer">#22370</a>, <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22374" target="_blank" rel="noopener noreferrer">#22374</a>, <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22576" target="_blank" rel="noopener noreferrer">#22576</a>, and merge requests <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10148" target="_blank" rel="noopener noreferrer">!10148</a>, <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10150" target="_blank" rel="noopener noreferrer">!10150</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="code-generator-and-performance">Code generator and performance<a class="hash-link" href="#code-generator-and-performance" title="Direct link to heading">​</a></h3><p>Jeff: tested changing the code generator to generate <code>let</code> instead of <code>var</code>. This led to a large performance regression (~20%), which was not isolated to any single function (via a ticky profile in node). The working hypothesis is that <code>let</code> requires more work when allocating closures because the JavaScript engine needs to ensure all variables are lexically scoped. We have not confirmed that this is the cause yet, but we did find that we generate closures that are allocated at runtime in the code generated for <code>base</code>. So after review we decided to leave the <code>var</code>s and not generate <code>let</code>s. Unless we begin to observe issues around scoping, using the safer construct seems to be too much of a performance hit.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="miscellaneous">Miscellaneous<a class="hash-link" href="#miscellaneous" title="Direct link to heading">​</a></h2><p>Jeff: Revived Data structure work in GHC.Unit.State resulting in -1.7% reduction in allocations (by geometric average) and -9% in some cases. <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9702" target="_blank" rel="noopener noreferrer">MR is here</a> and ready to land, just needs to upstream a single-line patch to haddock.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about IOG GHC Update #6" href="/2023-03-23-ghc-update"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2023-03-09-ghc-update">IOG GHC Update #5</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2023-03-09T00:00:00.000Z" itemprop="datePublished">March 9, 2023</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey M. Young</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Luite Stegeman</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Joshua Meredith</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Biweekly update from the GHC DevX team at IOG.</p><p>Previous updates can be found <a href="https://engineering.iog.io/tags/ghc-update" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="javascript-backend">JavaScript backend<a class="hash-link" href="#javascript-backend" title="Direct link to heading">​</a></h2><p>Luite: <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10059" target="_blank" rel="noopener noreferrer">!10059</a>
Implemented computing a valid <code>LambdaFormInfo</code> for the JavaScript backend
so that interface files can be written without warnings. Fixes
<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/23053" target="_blank" rel="noopener noreferrer">#23053</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="template-haskell">Template Haskell<a class="hash-link" href="#template-haskell" title="Direct link to heading">​</a></h3><p>Luite: <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10008" target="_blank" rel="noopener noreferrer">!10008</a>
implemented keeping track of subdirectories in GHC&#x27;s temporary file manager.
It has been updated after reviews and is now ready to be merged.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="javascript-edsl">JavaScript EDSL<a class="hash-link" href="#javascript-edsl" title="Direct link to heading">​</a></h3><p>Jeff: MR is <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10000" target="_blank" rel="noopener noreferrer">open</a>.
In response to feedback from the team Jeff has added (and removed)
several features that distinguish the eDSL from
<a href="https://github.com/ku-fpg/sunroof-compiler" target="_blank" rel="noopener noreferrer">sunroof</a>. These include: </p><ul><li>removing threading and continuations</li><li>adding named unique variables and a proper switch statement</li><li>removing a dependency on the <code>operational</code> package</li><li>removing a dependency on the <code>data-reify</code> package</li><li>added a compilation function that compiles the eDSL to the IR the JavaScript backend uses.</li></ul><p>These changes allow more of the RTS to be replaced in the eDSL and allow the RTS
to be typed using Haskell&#x27;s type system. For example, now the STG registers
track the type of the values they hold. The RTS migration is now underway.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="copymutablearray-primops">copyMutableArray primops<a class="hash-link" href="#copymutablearray-primops" title="Direct link to heading">​</a></h3><p>Sylvain: fixed JS implementations for <code>copyMutableByteArray#</code> and
<code>copySmallMutableArray</code> primops. They were wrong in some cases when the source
and target arrays overlap. See
<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/23033" target="_blank" rel="noopener noreferrer">#23033</a> and
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10037" target="_blank" rel="noopener noreferrer">!10037</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="testsuite">Testsuite<a class="hash-link" href="#testsuite" title="Direct link to heading">​</a></h3><p>Sylvain: made a minor cleanup in the testsuite to correctly tag tests requiring
Cmm support (which the JS backend doesn&#x27;t have):
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10043" target="_blank" rel="noopener noreferrer">!10043</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="callbacks">Callbacks<a class="hash-link" href="#callbacks" title="Direct link to heading">​</a></h3><p>Josh: ported GHCJS&#x27;s <code>GHCJS.Foreign.Callback</code> module. Manual testing revealed some
minor changes required in the JavaScript backend, including to <code>base.GHC.JS.Prim</code>,
to make everything work as expected.</p><p>This will enable passing Haskell functions into <code>foreign import</code>s, which in turn
enables a form of calling into Haskell from JavaScript code.</p><hr><h2 class="anchor anchorWithStickyNavbar_mojV" id="compiler-performance">Compiler performance<a class="hash-link" href="#compiler-performance" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="optimization-handbook">Optimization Handbook<a class="hash-link" href="#optimization-handbook" title="Direct link to heading">​</a></h3><p>Jeff: Work has begun on the first major case study: a performance
<a href="https://github.com/LeventErkok/sbv/issues/642" target="_blank" rel="noopener noreferrer">regression</a> in the
<a href="https://github.com/LeventErkok/sbv" target="_blank" rel="noopener noreferrer">sbv</a> library. </p><hr><h2 class="anchor anchorWithStickyNavbar_mojV" id="rts-linker">RTS linker<a class="hash-link" href="#rts-linker" title="Direct link to heading">​</a></h2><p>Sylvain: helped fixing a RTS linker bug. The RTS ELF linker didn&#x27;t properly
take into account required section alignments and always used 16-bytes alignment.
However AVX instructions generated by the C compiler may expect 32-bytes alignment
(even if the code uses unaligned load intrinsics, the C compiler may optimize them
into aligned load instructions, as was the case here).
The fix was simple, the test case a bit more involved.
See <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/23066" target="_blank" rel="noopener noreferrer">#23066</a> and <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10087" target="_blank" rel="noopener noreferrer">!10087</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about IOG GHC Update #5" href="/2023-03-09-ghc-update"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2023-02-23-ghc-update">IOG GHC Update #4</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2023-02-23T00:00:00.000Z" itemprop="datePublished">February 23, 2023</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey M. Young</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Luite Stegeman</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Joshua Meredith</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Biweekly update from the GHC DevX team at IOG.</p><p>Previous updates can be found <a href="https://engineering.iog.io/tags/ghc-update" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="javascript-backend">JavaScript backend<a class="hash-link" href="#javascript-backend" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="template-haskell">Template Haskell<a class="hash-link" href="#template-haskell" title="Direct link to heading">​</a></h3><p>Sylvain: <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9779" target="_blank" rel="noopener noreferrer">!9779</a>
adding TH support for the JS backend passes CI and is ready for reviews.</p><p>Ticket <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/23013" target="_blank" rel="noopener noreferrer">#23013</a> has been
opened to keep track of an issue with the recompilation avoidance mechanism.
Fixing the issue seems to require some invasive refactoring that is best left
for a future merge request.</p><p>Luite: <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10008" target="_blank" rel="noopener noreferrer">!10008</a>
Implemented keeping track of subdirectories in GHC&#x27;s temporary file manager.
Ready for review. Fixes
<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22952" target="_blank" rel="noopener noreferrer">#22952</a>.</p><p>Temporary subdirectories are used when linking Template Haskell with the
JavaScript backend and also in some situations when linking with other backends.
This would always result in files being left behind in GHC&#x27;s temporary directory
(and a warning at high enough verbosity settings) since these subdirectories
were never removed. With this patch, GHC keeps track of all created subdirectories
and removes them at the end of the session.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="javascript-rts-refactor">JavaScript RTS refactor<a class="hash-link" href="#javascript-rts-refactor" title="Direct link to heading">​</a></h3><p>Josh: has merged the refactor of the RTS generation module to reduce redundant code.
In this refactor, debug logging was also completed to determine the correct numbers
to use as the cache sizes for generated JavaScript names - allowing us to vastly
reduce the size of these arrays for efficiency, and to remove <code>panic</code> cases in favour
of generating higher numbered names without caching.</p><p><a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9794" target="_blank" rel="noopener noreferrer">!9794</a></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="integer-performance">Integer performance<a class="hash-link" href="#integer-performance" title="Direct link to heading">​</a></h3><p>Sylvain: <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9825" target="_blank" rel="noopener noreferrer">!9825</a> has
been updated after an helpful review by Matthew Claven.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="javascript-edsl">JavaScript EDSL<a class="hash-link" href="#javascript-edsl" title="Direct link to heading">​</a></h3><p>Jeff: MR is <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10000" target="_blank" rel="noopener noreferrer">open</a>.
In response to feedback from the team Jeff has added (and removed)
several features that distinguish the eDSL from
<a href="https://github.com/ku-fpg/sunroof-compiler" target="_blank" rel="noopener noreferrer">sunroof</a>. These include: removing
threading and continuations, adding named unique variables and a proper switch
statement. These changes allow more of the RTS to be replaced in the eDSL and
allow the RTS to be typed using Haskell&#x27;s type system. For example, now the STG
registers track the type of the values they hold.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ci">CI<a class="hash-link" href="#ci" title="Direct link to heading">​</a></h3><p>Sylvain: fixed CI script test that prevented performance results to be stored for
the JS backend (see <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22923" target="_blank" rel="noopener noreferrer">#22923</a> and
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10026" target="_blank" rel="noopener noreferrer">!10026</a>).</p><hr><h2 class="anchor anchorWithStickyNavbar_mojV" id="compiler-performance">Compiler performance<a class="hash-link" href="#compiler-performance" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="more-strict-breakspan">More-strict <code>break</code>/<code>span</code><a class="hash-link" href="#more-strict-breakspan" title="Direct link to heading">​</a></h3><p>Josh: opened a CLC (Core Libraries Committee) proposal to add stricter versions of
<code>break</code> and <code>span</code> to <code>Data.List</code> in addition to the existing lazy versions. The
proposal considers evidence that these versions are situationally more performant,
by comparing allocation statistics, generated STG, and microbenchmarks - as well as
making the argument for consistency with existing <code>List</code> functions that also have
strict versions.</p><p>See also:</p><ul><li><a href="https://github.com/haskell/core-libraries-committee/issues/133" target="_blank" rel="noopener noreferrer">CLC proposal 133</a></li><li><a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22865" target="_blank" rel="noopener noreferrer">GHC Issue 22865</a></li><li><a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9868" target="_blank" rel="noopener noreferrer">GHC MR 9868</a></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="unboxed-codebuffers">Unboxed CodeBuffers<a class="hash-link" href="#unboxed-codebuffers" title="Direct link to heading">​</a></h3><p>Josh: opened a CLC proposal to modify the implementation of <code>CodeBuffer</code>s in <code>base</code>
to use unboxed tuples in the return type of encoding functions. This change presents
a significant allocation improvement, due to the difficulty GHC has with applying a
certain optimisation within data types.</p><p>See also:</p><ul><li><a href="https://github.com/haskell/core-libraries-committee/issues/134" target="_blank" rel="noopener noreferrer">CLC proposal 134</a></li><li><a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22946" target="_blank" rel="noopener noreferrer">GHC Issue 22946</a></li><li><a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9948" target="_blank" rel="noopener noreferrer">GHC MR 9948</a>.</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="optimization-handbook">Optimization Handbook<a class="hash-link" href="#optimization-handbook" title="Direct link to heading">​</a></h3><p>Jeff: Has been hard at work on the <a href="https://input-output-hk.github.io/hs-opt-handbook.github.io/" target="_blank" rel="noopener noreferrer">Optimization Handbook</a>.
He has finished a
chapter on <code>Lambda Lifting</code>, significantly expanded the glossary, and added
documentation to the
<a href="https://github.com/yongrenjie/sphinx-exec-directive" target="_blank" rel="noopener noreferrer">sphinx-exec-directive</a>
haskell extension that he finished last month. The optimization handbook is now
in review by IOG&#x27;s IT team to migrate it to the Haskell Foundation website.</p><hr><h2 class="anchor anchorWithStickyNavbar_mojV" id="ghci">GHCi<a class="hash-link" href="#ghci" title="Direct link to heading">​</a></h2><p>Luite: Added a testcase and did some cleanups in the types of the C code in MR
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9957" target="_blank" rel="noopener noreferrer">!9957</a>, and adjusted
the bytecode generator to not produce zero offset <code>SLIDE</code> instructions anymore.
This is now ready for review.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about IOG GHC Update #4" href="/2023-02-23-ghc-update"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2023-02-09-ghc-update">IOG GHC Update #3 (2023-02-09)</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2023-02-09T00:00:00.000Z" itemprop="datePublished">February 9, 2023</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey M. Young</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Luite Stegeman</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Joshua Meredith</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Biweekly update from the GHC DevX team at IOG.</p><p>Previous updates can be found <a href="https://engineering.iog.io/tags/ghc-update" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="javascript-backend">JavaScript backend<a class="hash-link" href="#javascript-backend" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="template-haskell">Template Haskell<a class="hash-link" href="#template-haskell" title="Direct link to heading">​</a></h3><p>Luite: fixed the support for one-shot mode (GHC&#x27;s <code>-c</code> command-line flag)
in the TH JS linker.</p><p>Luite: Investigated a warning about the temporary directory not being removed
after running Template Haskell with the JavaScript backend. It turned out
that GHC&#x27;s <code>GHC.Utils.TmpFs.newTempDir</code>, which is used by the Template Haskell
linker, does not allow the newly created directory to be removed
(see <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22952" target="_blank" rel="noopener noreferrer">#22952</a>).</p><p>Sylvain: cleaned up the <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9779" target="_blank" rel="noopener noreferrer">merge request</a>,
removing unnecessary changes and adding documentation.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="javascript-backend-ci">JavaScript backend CI<a class="hash-link" href="#javascript-backend-ci" title="Direct link to heading">​</a></h3><p>Jeff: JavaScript backend CI was <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9552" target="_blank" rel="noopener noreferrer">finally
merged</a>! Now that we
have CI we are unblocked on several fronts, such as, implementing <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9825" target="_blank" rel="noopener noreferrer">faster
arithmetic</a> and fixing
some <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9879" target="_blank" rel="noopener noreferrer">async
exceptions</a>. In
general, we can now have confidence that our work is progressing the JavaScript
backend to a better state.</p><p>Sylvain: fixed a spurious failure on JS CI due to some test <em>passing</em> on fast runners
while it was expected to fail (see <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9934" target="_blank" rel="noopener noreferrer">!9934</a>).</p><p>Josh: fixed some inaccurate test predicates <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9939" target="_blank" rel="noopener noreferrer">!9939</a></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="filestat">FileStat<a class="hash-link" href="#filestat" title="Direct link to heading">​</a></h3><p>Josh: rebased and merged <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9755" target="_blank" rel="noopener noreferrer">!9755</a>.
This patch changes the representation of the JavaScript equivalent of the C <code>struct stat</code>
to make its field offsets match the C ones: some Haskell codes directly access fields of
this structure using <code>hsc2hs</code> to get the field offsets from the C headers.</p><p>This patch also adds fields to the JavaScript file stat that were previously not
included, such as modification and access times.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="javascript-rts-refactor">JavaScript RTS refactor<a class="hash-link" href="#javascript-rts-refactor" title="Direct link to heading">​</a></h3><p>Josh: rebased <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9794" target="_blank" rel="noopener noreferrer">!9794</a> which consists
in the refactor of the module generating some part of the RTS. The new JS CI job found a bug in the patch that
caused ~50 tests to time out, so waiting for CI to be set up before merging this MR was judicious.</p><p>This MR also became an opportunity to revisit some arbitrary cache sizes in the RTS code generator.
This is still ongoing work.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="warnings">Warnings<a class="hash-link" href="#warnings" title="Direct link to heading">​</a></h3><p>Luite: We accidently removed the check for the &quot;javascript&quot; calling convention on
foreign imports, allowing this convention to be wrongly used on native platform.
Fixed in <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9880" target="_blank" rel="noopener noreferrer">!9880</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="fix-for-asynchronous-exceptions">Fix for asynchronous exceptions<a class="hash-link" href="#fix-for-asynchronous-exceptions" title="Direct link to heading">​</a></h3><p>Luite: Fixed an issue in the garbage collector for the JavaScript backend:
A thread that posts an asynchronous exception (<code>throwTo</code>) to another thread
is temporarily suspended until the exception has been delivered. The
garbage collector did not correctly follow the list of threads suspended in
this way, potentially considering them unreachable and cleaning up data
referenced by them. See <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22836" target="_blank" rel="noopener noreferrer">#22836</a> and
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9879" target="_blank" rel="noopener noreferrer">!9879</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="integer-performance">Integer performance<a class="hash-link" href="#integer-performance" title="Direct link to heading">​</a></h3><p>Evaluating the following expression is very slow in general but especially with
the JS backend:</p><div class="codeBlockContainer_I0IT language-haskell theme-code-block"><div class="codeBlockContent_wNvx haskell"><pre tabindex="0" class="prism-code language-haskell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">1 `shiftL` (1 `shiftL` 20) :: Integer</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We&#x27;ve had to mark a test computing this as broken on CI because it triggers a
timeout error. Luckily the identification of slow operations is easy with
JavaScript profiling tools (see graphs in
<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22835" target="_blank" rel="noopener noreferrer">https://gitlab.haskell.org/ghc/ghc/-/issues/22835</a>) and we know that <code>Word32</code>
primops are the culprit in this case.</p><p>Sylvain started replacing the uses of JavaScript&#x27;s <code>BigInt</code> in the
implementation of these primops with usual JavaScript <code>numbers</code>.
See <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9825" target="_blank" rel="noopener noreferrer">!9825</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="javascript-edsl">JavaScript EDSL<a class="hash-link" href="#javascript-edsl" title="Direct link to heading">​</a></h3><p>Jeff: JavaScript eDSL based on
<a href="https://github.com/ku-fpg/sunroof-compiler" target="_blank" rel="noopener noreferrer">sunroof</a> close to MR, see
<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22736" target="_blank" rel="noopener noreferrer">#22736</a> for background.
Compiler is complete. Major items left are: the interpreter to translate to
<code>JStat</code>, filling in documentation, and testing now that CI has been merged.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="documentation">Documentation<a class="hash-link" href="#documentation" title="Direct link to heading">​</a></h3><p>Jeff: Wrote the JavaScript backend release notes. Notes pending
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9828" target="_blank" rel="noopener noreferrer">approval</a>. We cite
the <a href="https://gitlab.haskell.org/ghc/ghc/-/wikis/javascript-backend" target="_blank" rel="noopener noreferrer">JavaScript
backend</a> wiki
page in the release notes. So Jeff and Sylvain heavily edited the wiki pages to
make them suitable for external customers.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="change-from-js-to-javascript-architecture">Change from <code>js</code> to <code>javascript</code> architecture<a class="hash-link" href="#change-from-js-to-javascript-architecture" title="Direct link to heading">​</a></h3><p>In <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22740" target="_blank" rel="noopener noreferrer">#22740</a> it was noticed that
<code>hackage-server</code> would prevent the upload of the upcoming <code>base</code> package bundled with GHC 9.6.
The reason is that <code>hackage-server</code> relies on the <code>cabal --check</code> feature which filters
out perfectly valid packages (it happened before, for example with <a href="https://gitlab.haskell.org/haskell/ghc-api-compat/-/issues/1" target="_blank" rel="noopener noreferrer">ghc-api-compat</a>).</p><p>In our case, the package was rejected because the <code>js</code> architecture wasn&#x27;t recognized
as a built-in one, but luckily we could fall back to the existing <code>javascript</code> built-in
architecture defined for GHCJS (if it wasn&#x27;t a JS backend, we would have had to fix Cabal,
update <code>hackage-server</code> dependencies, and redeploy <code>hackage-server</code>...).</p><p>Sylvain completed Ben&#x27;s MR in <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9814" target="_blank" rel="noopener noreferrer">!9814</a>.</p><p>For early users of the JS backend the change means that from now on:</p><ul><li><code>configure</code> command is: <code>emconfigure ./configure --target=javascript-unknown-ghcjs</code></li><li>Cabal condition is: <code>arch(javascript)</code></li><li>CPP condition is: <code>#if defined(javascript_HOST_ARCH)</code></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="compiler-performance">Compiler performance<a class="hash-link" href="#compiler-performance" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="more-strict-break">More-strict <code>break</code><a class="hash-link" href="#more-strict-break" title="Direct link to heading">​</a></h3><p>Josh: opened merge request <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9868" target="_blank" rel="noopener noreferrer">!9868</a> to add a stricter <code>break&#x27;</code> version to <code>base</code> - however, this would require a CLC proposal.</p><p>Further analysis was done using ticky profiles on a simple test program that benchmarks GHC&#x27;s startup code.
This has found an example where a more-strict break is an improvement in GHC, which will provide motivation
for the CLC proposal.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="unboxed-codebuffers">Unboxed CodeBuffers<a class="hash-link" href="#unboxed-codebuffers" title="Direct link to heading">​</a></h3><p>Josh: implemented changes to GHC&#x27;s text encoding buffers to use unboxed tuples on handle encoders/decoders.
The buffers pass around and repeatedly pack/unpack a tuple in an <code>IO</code> inner loop, which causes a significant
number of unnecessary allocations. By replacing this with an unboxed tuple, and replacing the <code>IO</code> with
manually passing around a <code>State# RealWorld</code> in the same tuple, we&#x27;re able to reduce allocations by nearly 50%
in a pathological example (non-allocating loop printing characters). See <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22946" target="_blank" rel="noopener noreferrer">#22946</a> and <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9948" target="_blank" rel="noopener noreferrer">!9948</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="optimization-handbook">Optimization Handbook<a class="hash-link" href="#optimization-handbook" title="Direct link to heading">​</a></h3><p>Jeff: opened IT ticket to move the <a href="https://github.com/input-output-hk/hs-opt-handbook.github.io" target="_blank" rel="noopener noreferrer">Optimization
Handbook</a> to Haskell Foundation&#x27;s repository.
IT stated they need to check with legal, of course.</p><p>Jeff: almost finished the <a href="https://input-output-hk.github.io/hs-opt-handbook.github.io/src/Optimizations/GHC_opt/lambda_lifting.html" target="_blank" rel="noopener noreferrer">lambda
lifting</a>
chapter; major remaining items are adding some glossary terms and describing the
interaction between lambda lifting and calling conventions.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="constant-folding-for-division-operations">Constant folding for division operations<a class="hash-link" href="#constant-folding-for-division-operations" title="Direct link to heading">​</a></h3><p>While looking into his old merge requests still opened, Sylvain nerd-snipped
himself into fixing constant folding rules for division operations (see
<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22152" target="_blank" rel="noopener noreferrer">#22152</a>).</p><p>MR <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/8956" target="_blank" rel="noopener noreferrer">!8956</a> adds the
following rewrite rules:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">   case quotRemInt# x y of</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     (# q, _ #) -&gt; body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ====&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   case quotInt# x y of</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     q -&gt; body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   case quotRemInt# x y of</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     (# _, r #) -&gt; body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ====&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   case remInt# x y of</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     r -&gt; body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  For all primitive numerical types:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (x `quot` l1) `quot` l2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | l1 /= 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | l2 /= 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | l1*l2 doesn&#x27;t overflow/underflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ====&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x `quot` (l1 * l2)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>It also makes some division primops (Word64/Int64 Quot/Rem, WordQuotRem2Op)
ok-for-speculation when the divisor is known to be non-zero, similarly to other
division primops. Otherwise the last rule wasn&#x27;t firing in the added test
because we got the following Core (simplified for the presentation):</p><div class="codeBlockContainer_I0IT language-haskell theme-code-block"><div class="codeBlockContent_wNvx haskell"><pre tabindex="0" class="prism-code language-haskell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">case quotWord64# x# 10#Word64 of</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ds1 -&gt; case quotWord64# ds1 20#Word64 of</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ds2 -&gt; ...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and not:</p><div class="codeBlockContainer_I0IT language-haskell theme-code-block"><div class="codeBlockContent_wNvx haskell"><pre tabindex="0" class="prism-code language-haskell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">case quotWord64# (quotWord64# x# 10#Word64) 20#Word64 of</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ds2 -&gt; ...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="ghci">GHCi<a class="hash-link" href="#ghci" title="Direct link to heading">​</a></h2><p>Luite: A test run of GHC 9.6 with the <code>-fbyte-code-and-object-code</code> flag
on <a href="https://ghc.gitlab.haskell.org/head.hackage/" target="_blank" rel="noopener noreferrer">head.hackage</a> revealed
<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22888" target="_blank" rel="noopener noreferrer">issue #22888</a> with bytecode
size limits. Many bytecode instructions have <code>Word16</code> operands, which
is not always enough to run programs generated from optimized core. The solution
is to enable large operands for all the bytecode instructions that deal with
stack offsets. See <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22888" target="_blank" rel="noopener noreferrer">#22888</a>
and <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9957" target="_blank" rel="noopener noreferrer">!9957</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about IOG GHC Update #3 (2023-02-09)" href="/2023-02-09-ghc-update"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2023-01-26-ghc-update">GHC DevX Update 2023-01-26</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2023-01-26T00:00:00.000Z" itemprop="datePublished">January 26, 2023</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey M. Young</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Luite Stegeman</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Joshua Meredith</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>This is the second biweekly update of the IOG GHC DevX team.
You can find the previous one <a href="https://engineering.iog.io/2023-01-12-ghc-update" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="javascript-backend">JavaScript backend<a class="hash-link" href="#javascript-backend" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="template-haskell">Template Haskell<a class="hash-link" href="#template-haskell" title="Direct link to heading">​</a></h3><p>Sylvain continued his work on the implementation of Template Haskell for the JS
backend. He factorized the code from <code>iserv</code> and <code>libiserv</code> into the <code>ghci</code>
library. This makes it easy for GHC to load and run the external interpreter
server (<code>iserv</code>) that ends up compiled into JavaScript in a NodeJS instance. He
modified GHC to avoid creating ByteCode objects (which are unsupported by the JS
backend) and to instead compile and link JavaScript code.</p><p>Template Haskell basically works with the JavaScript backend now, except for a few
corner cases (such as one-shot mode), but these should be fixed in the coming
days/weeks.</p><p>Luite modified Sylvain&#x27;s JavaScript code to fix support for Darwin and Windows. If you
want to test it, a draft merge request has been opened:
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9779" target="_blank" rel="noopener noreferrer">https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9779</a></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="javascript-backend-in-the-browser-tutorial">JavaScript backend in the browser tutorial<a class="hash-link" href="#javascript-backend-in-the-browser-tutorial" title="Direct link to heading">​</a></h3><p>Josh published a tutorial about using code produced by the JavaScript backend in a web
page:
<a href="https://engineering.iog.io/2023-01-24-javascript-browser-tutorial" target="_blank" rel="noopener noreferrer">https://engineering.iog.io/2023-01-24-javascript-browser-tutorial</a></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cabal-support-for-js-sources">Cabal support for js-sources<a class="hash-link" href="#cabal-support-for-js-sources" title="Direct link to heading">​</a></h3><p>Sylvain added tests to his patch that adds cabal support for the <code>js-sources</code>
stanza when GHC is used as a compiler (and not only when GHCJS is used as a
compiler), allowing the patch to be merged:
<a href="https://github.com/haskell/cabal/pull/8636" target="_blank" rel="noopener noreferrer">https://github.com/haskell/cabal/pull/8636</a></p><p><a href="https://github.com/haskell/cabal/issues/8639" target="_blank" rel="noopener noreferrer">https://github.com/haskell/cabal/issues/8639</a> is still open though so be careful
if you try to use <code>js-sources</code>, they still don&#x27;t work in some cases.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="javascript-backend-ci">JavaScript backend CI<a class="hash-link" href="#javascript-backend-ci" title="Direct link to heading">​</a></h3><p>The <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9552" target="_blank" rel="noopener noreferrer">JavaScript backend
CI</a> has been an
ongoing saga for the last month, and has been a blocking item for JavaScript
Backend development. Thankfully it is close to being merged. This week, Jeff
rebased the CI to discover that recent
<a href="https://gitlab.haskell.org/ghc/ghc/-/commit/d31fcbca6cf4bc166904cfd25696503401ad631d" target="_blank" rel="noopener noreferrer">changes</a>
removed <code>nodejs</code> (the <code>node</code> that is bundled with emscripten) from the CI
containers <code>$PATH</code>. So Jeff patched the CI images to add <code>node</code>. Now the CI runs
and has discovered two new bugs even before being merged. All that is left is to
bump some submodules and the CI will be ready to land in GHC HEAD.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="filestat">FileStat<a class="hash-link" href="#filestat" title="Direct link to heading">​</a></h3><p>Josh opened an MR to match the layout of the JavaScript <code>fileStat</code> with the
layout of the equivalent struct defined in Emscripten&#x27;s <code>stat.h</code>. This is needed
to ensure that hsc2hs features work correctly with this data type. Hsc2hs features
can peek at memory locations directly without using accessor functions, and the
memory locations are taken from the header file, hence the requirement to match
these layouts.</p><p>This MR only touches JavaScript files, so we&#x27;re waiting on the approval of the
JS CI before continuing. For more information, see
<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22573" target="_blank" rel="noopener noreferrer">https://gitlab.haskell.org/ghc/ghc/-/issues/22573</a></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="javascript-rts-refactor">JavaScript RTS refactor<a class="hash-link" href="#javascript-rts-refactor" title="Direct link to heading">​</a></h3><p>Josh refactored parts of the GHC.StgtoJS.Rts.Rts module to remove special cases
from one of the n-argument JavaScript RTS functions, and combined these cases
into a general case. Thus, simplifying the Rts module&#x27;s code.</p><p>Josh also improved the caching in the JavaScript Backend for commonly used names
in the generated JavaScript ASTs. Previously, names such as <code>x1</code> would require
allocation <em>for each</em> use: first by allocating a <code>String</code>, which was then
converted to a GHC <code>FastString</code>, which was finally wrapped in a JavaScript AST
data constructor. Now, these names are captured in a static CAF&#x27;d <code>Array</code> and
each reference was replaced with a lookup to the corresponding slot in the
array. This avoids the extra allocations and ensures these names are shared.</p><p>For the full set of refactors, see:
<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22822" target="_blank" rel="noopener noreferrer">https://gitlab.haskell.org/ghc/ghc/-/issues/22822</a></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="javascript-edsl">JavaScript EDSL<a class="hash-link" href="#javascript-edsl" title="Direct link to heading">​</a></h3><p>Jeff began work on a new eDSL to replace the existing DSL the JavaScript Backend
inherited from GHCJS. This solves a <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22736" target="_blank" rel="noopener noreferrer">design
problem</a>. The existing DSL in
the JavaScript Backend is used for two things: (1) to write the JavaScript
Backend&#x27;s garbage collector, runtime system and other low level bits; (2) as a
target for optimizations; (3) as the source for code generation. This becomes
problematic because the existing DSL tries to do so much that it ends up not
being particularly good at (1), (2) and (3).</p><p>The fix is to separate concerns by writing a new DSL for (1). The DSL is Type
Safe and based on the <a href="https://github.com/ku-fpg/sunroof-compiler" target="_blank" rel="noopener noreferrer">Sunroof
compiler</a> (Thanks Andy Gill et al.
for your labor!). Then, we&#x27;ll compile the new DSL to the existing GHCJS DSL.
This way we can slowly begin to replace JavaScript Backend code module by
module, thus gaining type safety while still continuing other work. The end game
of this project is to eventually remove the GHCJS DSL entirely and then compile
our new DSL to a better intermediate representation that is explicitly crafted
to make optimizations easier.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="blog-posts">Blog posts<a class="hash-link" href="#blog-posts" title="Direct link to heading">​</a></h3><p>Luite has been working on new blog posts about internals of the GHC JavaScript
backend and a strategy guide for debugging the generated JavaScript code. These
will be published in the coming weeks.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="javascript-backend-configuration-issue-in-a-docker-image">JavaScript backend configuration issue in a Docker image<a class="hash-link" href="#javascript-backend-configuration-issue-in-a-docker-image" title="Direct link to heading">​</a></h3><p>Sylvain debugged a configuration issue of GHC with the JavaScript backend (see
<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22814" target="_blank" rel="noopener noreferrer">#22814</a>).
The recommended way to configure is to use the following command line:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">emconfigure ./configure --target=js-unknown-ghcjs</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>where <code>emconfigure</code> is provided by the Emscripten project and sets appropriate
environment variables (CC, LD, AR...).</p><p>However in some cases it seems like these variables are set as follows:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">CC=emcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LD=emcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>in which case GHC&#x27;s <code>configure</code> script will silently ignores them... and uses
the C compiler for the host platform instead (x86-64, aarch64...). As the C
compiler is only used for the CPP pass, it results in some inscrutable errors.
In <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22814" target="_blank" rel="noopener noreferrer">#22814</a> the error is due
to <code>CSize</code> being inferred as a 64-bit type while it should be 32-bit for the
JavaScript platform, leading to CSize values being passed as 2 arguments in FFI
calls while the callee expects 1.</p><p>Calling <code>configure</code> with the right environment variables fixes the issue:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">./configure CC=$(which emcc) LD=$(which emcc) --target=js-unknown-ghcjs</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="discussion-about-javascript-backend-maturity">Discussion about JavaScript backend maturity<a class="hash-link" href="#discussion-about-javascript-backend-maturity" title="Direct link to heading">​</a></h3><p>Quite some time was spent discussing users&#x27; expectations about the JavaScript and WASM backends.
We would like to make it very clear that even if GHCJS has been here for a long time,
the JavaScript backend doesn&#x27;t yet have the same level of maturity.</p><p>Bugs, missing features, and sub-par performance are to be expected in the 9.6 release.
We encourage adventurous users to try out this release and send us feedback, but it&#x27;s
best to exercise caution before relying on it for production.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="compiler-performance">Compiler performance<a class="hash-link" href="#compiler-performance" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="more-strict-break">More-strict <code>break</code><a class="hash-link" href="#more-strict-break" title="Direct link to heading">​</a></h3><p>Josh did more investigation into the performance difference that introducing
some strictness into the <code>break</code> function would make. The STG and microbenchmarks
are very promising, but using the &quot;compile cabal&quot; benchmark, there doesn&#x27;t seem
to be a noticable time difference caused by the change. In terms of memory, it
seems to reduce GC copying, but slightly increase overall allocations and total
memory usage.</p><p>There&#x27;s pathological cases in using a strict break by default - for example in the
<code>lines</code> function. Because of this, it&#x27;s likely that this optimization would have
the most benefit if applied in isolated cases in GHC, if any pathological lazy
cases are found.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="misc">Misc<a class="hash-link" href="#misc" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="cross-compilation-from-linuxdarwin-to-windows">Cross-compilation from Linux/Darwin to Windows<a class="hash-link" href="#cross-compilation-from-linuxdarwin-to-windows" title="Direct link to heading">​</a></h3><p>Ticket <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22805" target="_blank" rel="noopener noreferrer">#22805</a> reminded Sylvain that he had made <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9310" target="_blank" rel="noopener noreferrer">MR !9310</a> more than two months ago to fix the same issue: cross-compilation from Linux/Darwin to Windows. The MR has now been updated, tested, reviewed, and merged.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="hadrian-rules-to-build-the-sphinx-based-docs">Hadrian rules to build the Sphinx-based docs<a class="hash-link" href="#hadrian-rules-to-build-the-sphinx-based-docs" title="Direct link to heading">​</a></h3><p>Sylvain started working on adding a chapter about the JavaScript in GHC&#x27;s Users Guide.
The first step was to fix Hadrian&#x27;s build rules for the Users Guide (<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9795" target="_blank" rel="noopener noreferrer">MR !9795</a>)</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about GHC DevX Update 2023-01-26" href="/2023-01-26-ghc-update"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2023-01-12-ghc-update">GHC DevX Update 2023-01-12</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2023-01-12T00:00:00.000Z" itemprop="datePublished">January 12, 2023</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey M. Young</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Luite Stegeman</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Joshua Meredith</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Starting in 2023 we–the IOG GHC DevX team–are going to provide biweekly updates
about our work. This is the first edition.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="js-backend">JS backend<a class="hash-link" href="#js-backend" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="js-backend-in-the-browser-tutorial">JS backend in the browser tutorial<a class="hash-link" href="#js-backend-in-the-browser-tutorial" title="Direct link to heading">​</a></h3><p>We are working on a draft of a JS backend tutorial about using it to build a
simple web application: <a href="https://github.com/input-output-hk/engineering/pull/24" target="_blank" rel="noopener noreferrer">https://github.com/input-output-hk/engineering/pull/24</a></p><p>Publication is expected next week.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cabal-support-for-js-sources">Cabal support for js-sources<a class="hash-link" href="#cabal-support-for-js-sources" title="Direct link to heading">​</a></h3><p>Sylvain made a patch to add cabal support for the <code>js-sources</code> stanza when
GHC is used as a compiler (and not only when GHCJS is used as a compiler):
<a href="https://github.com/haskell/cabal/pull/8636" target="_blank" rel="noopener noreferrer">https://github.com/haskell/cabal/pull/8636</a></p><p>It’s missing tests and then it should be ready to be merged.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="js-backend-ci">JS backend CI<a class="hash-link" href="#js-backend-ci" title="Direct link to heading">​</a></h3><p>Jeff worked on adding a proper CI job that runs the full testsuite
with the JS backend. Cf ticket
<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22128" target="_blank" rel="noopener noreferrer">#22128</a> and merge request
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9552" target="_blank" rel="noopener noreferrer">!9552</a>.</p><p>He had to fix some unexpected test passes (!) with the JS backend due to an
imprecise <code>req_smp</code> predicate used by the testsuite. More details on
<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22630" target="_blank" rel="noopener noreferrer">#22630</a> and
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9568" target="_blank" rel="noopener noreferrer">!9568</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="js-backend-template-haskell">JS backend: Template Haskell<a class="hash-link" href="#js-backend-template-haskell" title="Direct link to heading">​</a></h3><p>Luite and Sylvain started implementing support for Template Haskell (TH) with
the JS backend.</p><p>Sylvain reimplemented support for running an adapted version of the
THRunner.js script from GHCJS. He also refactored the JS linker and
implemented incremental linking.</p><p>The next step is to link and to run an instance of the external interpreter code
that implements the Template Haskell protocol (execution of the <code>Q</code> monad)
adapted to run in JavaScript. GHCJS used to have its own duplicated code for
this but for maintenance concerns it’s much better to reuse the external
interpreter code.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="ghci">GHCi<a class="hash-link" href="#ghci" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="ghci-sized-primitive-types-word8-etc">GHCi: sized primitive types (Word8#, etc.)<a class="hash-link" href="#ghci-sized-primitive-types-word8-etc" title="Direct link to heading">​</a></h3><p>Luite implemented support for sized primitive types in GHCi. Cf
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/8822" target="_blank" rel="noopener noreferrer">!8822</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ghci-prim-calling-convention">GHCi: “prim” calling convention<a class="hash-link" href="#ghci-prim-calling-convention" title="Direct link to heading">​</a></h3><p>Luite implemented support for the “prim” calling convention in GHCi. Cf
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9026" target="_blank" rel="noopener noreferrer">!9026</a></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="compiler-performance">Compiler performance<a class="hash-link" href="#compiler-performance" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="jeff">Jeff<a class="hash-link" href="#jeff" title="Direct link to heading">​</a></h3><p>Each of these improves allocations between 0.2 - 0.7% depending on the input
(improvements by a thousand cuts):</p><ul><li><p><strong>GHC.Foreign improved Strictness</strong>: An Attempt to remove lazy IO and SAT an
argument that is only used for a debug message. Got a review from Andreas.
Want to try to 2 more improvements then ready to merge.
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9644" target="_blank" rel="noopener noreferrer">!9644</a></p></li><li><p><strong>InfoTableProv: ShortText → ShortByteString</strong>: Post review from Ben I made some
improvements that preserved type safety and still recovered most of the
performance improvements. Ready to merge
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9637" target="_blank" rel="noopener noreferrer">!9637</a></p></li><li><p><strong>GHC.Unit.State</strong>: swapped use of Data.Map for GHC.Unique.UniqMap and expanded
UniqMap API. Results in progress (need to patch Haddock) and still
experimental. The idea here is to use a data structure that no longer needs to
balance on insertions because Unit.State performs a lot of merges on these
maps.</p></li><li><p><strong>GHC.Utils.Binary.foldGet’ removed lazy IO and lazy accumulator</strong>: merged
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9538" target="_blank" rel="noopener noreferrer">!9538</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="josh">Josh<a class="hash-link" href="#josh" title="Direct link to heading">​</a></h3><ul><li><p><strong>Stricter break</strong>: we noticed in a ticky profile that <code>GHC.List.break</code> allocates
3 thunks and 1 datacon per list element returned the first part of the list.
If this list is fully evaluated later, we can allocate only 1 datacon per list
element instead. Preliminary results bootstrapping GHC with this change look
very promising.</p></li><li><p><strong>FastMutInt (Binary)</strong>: Josh started reviving Sylvain’s MR
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7246" target="_blank" rel="noopener noreferrer">!7246</a> about
bundling more than one <code>Int#</code> in a <code>FastMutInt</code> for performance. He tried to
make a proof of concept generalisation of 2-FastMutInt into n-FastMutInts
(using GHC type level Natural). The types don’t really recurse in a convenient
way (Int -&gt; (… -&gt; IO ())) so it would probably introduce more complexity than
the problem is worth. Now, he’s just implementing the original patch with the
fixes and documentation.</p></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about GHC DevX Update 2023-01-12" href="/2023-01-12-ghc-update"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2022-08-01-ghc-update">GHC DevX July 2022 Update</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-08-01T00:00:00.000Z" itemprop="datePublished">August 1, 2022</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>This is the July 2022 monthly update from the GHC DevX team at IOG.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="javascript-backend-for-ghc">JavaScript Backend for GHC<a class="hash-link" href="#javascript-backend-for-ghc" title="Direct link to heading">​</a></h2><p>For a few months we have been merging GHCJS (Haskell to JavaScript compiler)
into GHC. We set our first milestone to be the ability to compile and to run the
usual &quot;Hello World&quot; program. This month we finally reached it!</p><p>We are now focusing on:</p><ul><li><p>fixing failing tests in GHC&#x27;s testsuite (~2800 unexpected failures). To do that, we
have to implement new primops, to fix bugs we introduced while we ported the
code from GHCJS, etc.</p></li><li><p>implementing support for the &quot;js-sources&quot; Cabal stanza in Hadrian. Currently
the JS backend finds the JS sources required for the RTS and for base into
explicitly defined location. It was only a stop-gap measure and we now need to
implement proper support for user-provided JavaScript files.</p></li><li><p>documenting and refactoring the source code and making it similar to other GHC
modules. As an example, GHCJS used the text package which isn&#x27;t a boot
package. Hence we first switched to use GHC&#x27;s ShortText implementation and now
we switched to a FastString based implementation.</p></li><li><p>adding back GHCJS&#x27;s features that we haven&#x27;t ported for some reasons (e.g. the
compactor, TH, etc.).</p></li></ul><p>You can follow our progress on our development branch
<a href="https://gitlab.haskell.org/ghc/ghc/-/tree/wip/js-staging" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="blog-posts">Blog posts<a class="hash-link" href="#blog-posts" title="Direct link to heading">​</a></h2><p>For the time being, we will focus blog post topics on GHCJS internals and
related topics. A few of these blog posts are currently under review and should
be published shortly.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about GHC DevX July 2022 Update" href="/2022-08-01-ghc-update"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2022-07-01-ghc-update">GHC DevX June 2022 Update</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-07-01T00:00:00.000Z" itemprop="datePublished">July 1, 2022</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>This is the June 2022 monthly update from the GHC DevX team at IOG.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="javascript-backend-for-ghc">JavaScript Backend for GHC<a class="hash-link" href="#javascript-backend-for-ghc" title="Direct link to heading">​</a></h2><p>For a few months we have been merging GHCJS (Haskell to JavaScript compiler) into GHC.
We set our first milestone to be the ability to compile and to run the usual &quot;Hello World&quot; program.
It turned out to be much more involved than we initially thought (requiring FFI support, etc.), but we should be getting there soon.</p><p>This month we have made the following progress:</p><ul><li><p><strong>Linking</strong>: GHCJS requires some functions to be directly implemented in
JavaScript (e.g. the RTS, some low-level functions in base). We have added support
for linking <code>.js</code> files. We&#x27;ve also added support for a preprocessing pass with CPP
for <code>.js.pp</code> files.</p></li><li><p><strong>js-sources</strong>: there is some ongoing work to load these external JavaScript
files from installed libraries. Cabal provides a <code>js-sources</code> stanza for this,
we need to adapt Hadrian to make use of it.</p></li><li><p><strong>Binary vs Objectable</strong>: GHCJS used its own ByteString-based Objectable
type-class: we replaced it with GHC&#x27;s similar Binary type-class.
Josh has published a <a href="https://engineering.iog.io/2022/05/24/april-GHCJS-Objectable-vs-GHC-Binary" target="_blank" rel="noopener noreferrer">blog
post</a>
about their differences.</p></li><li><p><strong>64-bit primops</strong>: we&#x27;ve added support for 64-bit primops (Word64# and Int64#
types). In GHCJS (GHC 8.10), these were still implemented as foreign function
calls. It&#x27;s no longer true on GHC head.</p></li><li><p><strong>base library</strong>: added CPP as required to support the JS backend. Ported and
converted FFI imports from GHCJS to use JavaScript fat arrows (we haven&#x27;t
implemented GHCJS&#x27;s fancy import syntax yet).</p></li></ul><p>Now we can compile and link the &quot;HelloWorld&quot; program.
To reach the first milestone we only have to fix the remaining runtime errors.</p><p>You can follow our progress on our development branch <a href="https://gitlab.haskell.org/ghc/ghc/-/tree/wip/js-staging" target="_blank" rel="noopener noreferrer">here</a>.
We now rebase this branch every Friday to avoid lagging too much behind GHC head.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="haskell-optimization-handbook">Haskell Optimization Handbook<a class="hash-link" href="#haskell-optimization-handbook" title="Direct link to heading">​</a></h2><p>The &quot;Haskell Optimization Handbook&quot; is an <a href="https://github.com/haskellfoundation/tech-proposals/blob/main/proposals/accepted/026-haskell-optimization-handbook.md" target="_blank" rel="noopener noreferrer">accepted proposal</a> of the Haskell Foundation.
Jeff has been steadily writing some initial material as per the project plan.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about GHC DevX June 2022 Update" href="/2022-07-01-ghc-update"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2022-06-01-ghc-update">GHC DevX May 2022 Update</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-06-01T00:00:00.000Z" itemprop="datePublished">June 1, 2022</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>This is the May 2022 monthly update from the GHC DevX team at IOG.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="javascript-backend-for-ghc">JavaScript Backend for GHC<a class="hash-link" href="#javascript-backend-for-ghc" title="Direct link to heading">​</a></h2><p>For a few months we have been merging GHCJS (Haskell to JavaScript compiler) into GHC.
We set our first milestone to be the ability to compile and to run the usual &quot;Hello World&quot; program.
It turned out to be much more involved than we initially thought (requiring FFI support, etc.), but we should be getting there soon.</p><p>This month we have made the following progress:</p><ul><li><p><strong>RTS</strong>: we have modified Hadrian and <code>rts.cabal</code> in order to build a valid
native <code>rts</code> unit that GHC can use, in particular containing appropriate
header files.</p></li><li><p><strong>linker</strong>: the JS linker has been hooked up with GHC&#x27;s driver.
We fixed several panics in the linker due to erroneous symbol generation code.
These bugs were introduced while porting the code from the old 8.10 pretty-printing infrastructure to the newer one.</p></li><li><p><strong>boot libraries</strong>: the JS backend can now build and link all the boot libraries.
Note that we are not claiming that they are all usable yet. In particular complete FFI support is lacking, but the JS backend Hadrian build completes and so we can start using the produced JS cross-compiler.</p></li><li><p><strong>levity polymorphism</strong>: building <code>ghc-prim</code> uncovered a lurking bug related to
levity polymorphism. It wasn&#x27;t noticed in GHCJS 8.10 because it is also
related to the <code>BoxedRep</code> proposal that introduced a constructor application
in a commonly used <code>RuntimeRep</code>.</p></li><li><p><strong>sized literals</strong>: support for new sized literals have been added to the code
generator.</p></li></ul><p>Now that have achieved a build process that actually produces a JS cross compiler, we are confronting and fixing issues in the produced JavaScript code, such as adding, managing, and debugging CPP conditional compilation blocks in JS shim files. You can follow our progress on our development branch <a href="https://gitlab.haskell.org/ghc/ghc/-/tree/wip/js-staging" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="external-static-plugins">External Static Plugins<a class="hash-link" href="#external-static-plugins" title="Direct link to heading">​</a></h2><p>GHC doesn&#x27;t support plugins in cross-compilers <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/14335" target="_blank" rel="noopener noreferrer">#14335</a>.
Some time ago, we came up with a solution called &quot;external static plugins&quot; <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7377" target="_blank" rel="noopener noreferrer">!7377</a>.
These are plugins that are directly loaded from shared libaries, bypassing the issue with usual plugins.</p><p>Our colleague Shea Levy confirmed that the approach works, backported it to GHC 8.10, and has been working on making it work in stage1 cross-compilers for Windows.
Kudos for this work, Shea.</p><p>As the current user-interface based on environment variables isn&#x27;t convenient, we have been working on adding new command-line flags to GHC instead.
We expect to propose this for integration into GHC when the new interface will be fully implemented.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="blog-posts">Blog posts<a class="hash-link" href="#blog-posts" title="Direct link to heading">​</a></h2><p>Inspired by our friends and colleagues at Well-Typed and Tweag, we have been starting to write blog posts for IOG&#x27;s engineering blog.
They will mostly be about stuff we are working on or that we are interested in.
Feel free to send us feedback about these posts and to send us topics you would be interested to read about.</p><ul><li><a href="https://engineering.iog.io/2022-04-28-on-the-inlining-of-integer-and-natural-operations" target="_blank" rel="noopener noreferrer">https://engineering.iog.io/2022-04-28-on-the-inlining-of-integer-and-natural-operations</a></li><li><a href="https://engineering.iog.io/2022-05-02-setup-ext-stg-interp" target="_blank" rel="noopener noreferrer">https://engineering.iog.io/2022-05-02-setup-ext-stg-interp</a></li><li><a href="https://engineering.iog.io/2022-05-17-javascript-template-haskell-external-interpreter" target="_blank" rel="noopener noreferrer">https://engineering.iog.io/2022-05-17-javascript-template-haskell-external-interpreter</a></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="haskell-optimization-handbook">Haskell Optimization Handbook<a class="hash-link" href="#haskell-optimization-handbook" title="Direct link to heading">​</a></h2><p>The &quot;Haskell Optimization Handbook&quot; is an <a href="https://github.com/haskellfoundation/tech-proposals/blob/main/proposals/accepted/026-haskell-optimization-handbook.md" target="_blank" rel="noopener noreferrer">accepted proposal</a> of the Haskell Foundation.
Jeff has been working behind the scene to make this proposal concrete.
More about this in the upcoming months.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about GHC DevX May 2022 Update" href="/2022-06-01-ghc-update"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/ghc-update-2022-04">GHC April 2022 Update</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-05-13T00:00:00.000Z" itemprop="datePublished">May 13, 2022</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey M. Young</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Welcome to the (rather late) April 2022 monthly update from the GHC DevX team at IOG. Since the last update we&#x27;ve continued work on the upcoming JavaScript backend for GHC. Unfortunately, we have nothing to show quite yet but that doesn&#x27;t mean nothing has happened! On the contrary, we&#x27;ve made great progress and are close to that crucial first milestone <code>hello world</code>. Besides our work on the JavaScript backend, we were pleased to finally push through the <a href="https://hsyl20.fr/home/posts/2022-05-03-modularizing-ghc-paper.html" target="_blank" rel="noopener noreferrer">Modularizing GHC</a> paper that Sylvain has been working on for 2+ years! It causes quite the splash on the Haskell discourse and reddit, we recommend reading it if you haven&#x27;t already (links below). Alright, enough introduction let&#x27;s get into the update.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="javascript-backend">JavaScript Backend<a class="hash-link" href="#javascript-backend" title="Direct link to heading">​</a></h2><p>We have made the following progresses in the implementation of a JavaScript
backend for GHC (adapted from GHCJS):</p><ul><li><p><strong>linker</strong>: ported GHCJS&#x27;s linker code into GHC. A lot of code was duplicated from GHC and
slightly modified for GHCJS&#x27;s needs, making the process far from trivial.</p></li><li><p><strong>testsuite</strong>: fixed Hadrian to run GHC&#x27;s testsuite with cross-compilers
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7850" target="_blank" rel="noopener noreferrer">!7850</a>. There are
remaining issues though (see
<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/21292" target="_blank" rel="noopener noreferrer">#21292</a>).</p></li><li><p><strong>build system</strong>: fixes for GHC&#x27;s configure script were ported (e.g. support for
the &quot;ghcjs&quot; target in <code>config.sub</code>). GHCJS&#x27;s custom
build script was integrated into <code>configure.ac</code>. We can now
configure the build with: <code>./configure --target=js-unknown-ghcjs</code></p></li><li><p><strong>TH</strong>: we have conducted some experiments to find the best way to bridge GHCJS&#x27;s
TH runner and GHC&#x27;s external interpreter. This will be described in details in
a future blog post.</p></li><li><p><strong>FFI</strong>: basic support for JavaScript FFI has been ported from GHCJS to GHC. We
haven&#x27;t ported the JavaScript parser, so we have dropped the fancy import
syntax (e.g. &quot;$1.xyz&quot;). It should be enough to build boot libraries and we
will add JS parsing support later.</p></li></ul><p>At this stage, we are working on building boot libraries and on supporting
linking with the JS RTS.</p><p>Development happens in the following branch: <a href="https://gitlab.haskell.org/ghc/ghc/-/tree/wip/js-staging" target="_blank" rel="noopener noreferrer">https://gitlab.haskell.org/ghc/ghc/-/tree/wip/js-staging</a></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="modularity-paper">Modularity paper<a class="hash-link" href="#modularity-paper" title="Direct link to heading">​</a></h2><p>Sylvain, Jeffrey, and John Ericson (from Obsidian Systems) wrote a paper about
&quot;modularizing GHC&quot; using domain-driven design.</p><ul><li>Announce blog post: <a href="https://hsyl20.fr/home/posts/2022-05-03-modularizing-ghc-paper.html" target="_blank" rel="noopener noreferrer">https://hsyl20.fr/home/posts/2022-05-03-modularizing-ghc-paper.html</a></li><li>Paper: <a href="https://hsyl20.fr/home/files/papers/2022-ghc-modularity.pdf" target="_blank" rel="noopener noreferrer">https://hsyl20.fr/home/files/papers/2022-ghc-modularity.pdf</a></li><li>Reddit: <a href="https://www.reddit.com/r/haskell/comments/uhdu4l/modularizing_ghc_paper/" target="_blank" rel="noopener noreferrer">https://www.reddit.com/r/haskell/comments/uhdu4l/modularizing_ghc_paper/</a></li><li>Discourse: <a href="https://discourse.haskell.org/t/modularizing-ghc-paper/4471" target="_blank" rel="noopener noreferrer">https://discourse.haskell.org/t/modularizing-ghc-paper/4471</a></li></ul><p>We&#x27;ve got a lot of great feedback about it (expect a first revision soon).
We also got a GHC contribution directly inspired by the paper (see
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/8160" target="_blank" rel="noopener noreferrer">!8160</a>) which was
very welcome!</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about GHC April 2022 Update" href="/ghc-update-2022-04"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2022-04-19-ghc-march-2022-update">GHC March 2022 Update</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-04-19T00:00:00.000Z" itemprop="datePublished">April 19, 2022</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_mojV" id="js-backend">JS Backend<a class="hash-link" href="#js-backend" title="Direct link to heading">​</a></h2><p>In March the team focused on porting more GHCJS code to GHC head.</p><ul><li>Most of us are new to GHCJS’s codebase so we are taking some time to better understand it and to better document it as code gets integrated into GHC head.</li><li>Development process: initially we had planned to integrate features one after the others into GHC head. However it was finally decided that features would be merged into a <a href="https://gitlab.haskell.org/ghc/ghc/-/commits/wip/javascript-backend" target="_blank" rel="noopener noreferrer">wip/javascript-backend</a> branch first and then later merged into GHC head. After trying this approach we decided to work directly into another branch: <a href="https://gitlab.haskell.org/ghc/ghc/-/commits/wip/js-staging" target="_blank" rel="noopener noreferrer">wip/js-staging</a> . Opening merge requests that can’t be tested against a branch that isn’t GHC head didn’t bring any benefit and slowed us too much.</li><li>Documentation: we wrote a document comparing the different approaches to target JavaScript/WebAssembly <a href="https://gitlab.haskell.org/ghc/ghc/-/wikis/javascript" target="_blank" rel="noopener noreferrer"> https://gitlab.haskell.org/ghc/ghc/-/wikis/javascript</a></li><li>RTS: some parts of GHCJS’s RTS are generated from Haskell code, similarly to code generated with the genapply program in the C RTS. This code has been ported to GHC head. As JS linking---especially linking with the RTS---will only be performed by GHC in the short term, we plan to make it generate this code dynamically at link time.</li><li>Linker: most of GHCJS’s linker code has been adapted to GHC head. Because of the lack of modularity of GHC, a lot of GHC code was duplicated into GHCJS and slightly modified. Now that both codes have diverged we need to spend some time making them converge again, probably by making the Linker code in GHC more modular.</li><li>Adaptation to GHC head: some work is underway to replace GHCJS’s Objectable type-class with GHC’s Binary type-class which serves the same purpose. Similarly a lot of uses of Text have been replaced with GHC’s ShortText or FastString.</li><li>Template Haskell: GHCJS has its own TH runner which inspired GHC’s external interpreter (“Iserv”) programs. We have been exploring options to port TH runner code as an Iserv implementation. The Iserv protocol uses GADTs to represent its messages which requires more boilerplate code to convert them into JS because we can’t automatically derive aeson instances for them.</li><li>Plugins: we have an MR adding support for “external static plugins” to GHC <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7377" target="_blank" rel="noopener noreferrer">!7377</a>. Currently it only supports configuring plugins <em>via</em> environment variables. We have been working on adding support for command-line flags instead.</li><li>Testsuite: we have fixed GHC’s build system so that it can run GHC’s testsuite when GHC is built as a cross-compiler (<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7850" target="_blank" rel="noopener noreferrer">!7850</a>). There is still some work to do (tracked in <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/21292" target="_blank" rel="noopener noreferrer">#21292</a>) to somehow support tests that <em>run</em> compiled programs: with cross-compilers, target programs can’t be directly executed by the host architecture.</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="misc">Misc<a class="hash-link" href="#misc" title="Direct link to heading">​</a></h2><ul><li><a href="https://github.com/haskellfoundation/tech-proposals/pull/26" target="_blank" rel="noopener noreferrer">Performance book</a>: some time was spent on the infrastructure (CI) and on switching the format of the book to ReStructured Text</li><li>Modularity: some time was spent discussing GHC’s design and refactoring (c.f. <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7442" target="_blank" rel="noopener noreferrer">!7442</a> and <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20927" target="_blank" rel="noopener noreferrer">#20927</a>).</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about GHC March 2022 Update" href="/2022-04-19-ghc-march-2022-update"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2022-03-09-ghc-february-2022-update">GHC February 2022 Update</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-03-09T00:00:00.000Z" itemprop="datePublished">March 9, 2022</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_mojV" id="js-backend">JS backend<a class="hash-link" href="#js-backend" title="Direct link to heading">​</a></h2><p>This month we worked on adapting code from GHCJS to merge into GHC head. We also started discussing the implementation process publicly and especially with our colleagues at Well-Typed.</p><ul><li>Ticket about adapting GHCJS’ code into a proper JS backend for GHC has been opened <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/21078" target="_blank" rel="noopener noreferrer">#21078</a>]<!-- -->. Feedback was very positive!</li><li>There were discussions about the process and an agreement to target GHC 9.6 release <!-- -->[<a href="https://mail.haskell.org/pipermail/ghc-devs/2022-February/020580.html" target="_blank" rel="noopener noreferrer">email on ghc-devs</a>, <a href="https://gitlab.haskell.org/ghc/ghc/-/wikis/javascript-backend" target="_blank" rel="noopener noreferrer">wiki page</a>]</li><li><code>deriveConstants</code> is a program used to generate some header file included in the rts package. While it is mainly useful for native targets, we had to make it support Javascript targets <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7585" target="_blank" rel="noopener noreferrer">!7585</a>]</li><li>Javascript is going to be the first official target platform supported by GHC that has its own notion of managed heap objects. Hence we may need a new <code>RuntimeRep</code> to represent these values for Haskell codes interacting with JS codes via FFI. We opened <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7577" target="_blank" rel="noopener noreferrer">!7577</a> into which we tried to make this new <code>RuntimeRep</code> non JS specific so that it could be reused for future backends targeting other managed platforms (e.g. CLR, JVM). It triggered a lot of discussions summarized in <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/21142" target="_blank" rel="noopener noreferrer">#21142</a>.</li><li>GHCJS’s code generator was ported to GHC head <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7573" target="_blank" rel="noopener noreferrer">!7573</a>]<!-- -->. In its current state, we can generate Javascript unoptimised code -- the optimiser hasn’t been ported yet -- by compiling a module with <code>-c -fjavascript</code>. It required many changes, not only to adapt to changes between GHC 8.10 and GHC head but also to avoid adding new package dependencies. It was also an opportunity to refactor and to document the code, which is still a work in progress.</li><li>GHC doesn’t use any lens library, hence to port the code generator we had to replace lenses with usual record accessors. It turned out that <code>case</code> alternatives in STG lacked them because they were represented with a triple. We took the opportunity to introduce a proper record type for them  <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7652" target="_blank" rel="noopener noreferrer">!7652</a></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="plutus-apps-js-demo">Plutus-apps JS demo<a class="hash-link" href="#plutus-apps-js-demo" title="Direct link to heading">​</a></h2><ul><li>We improved the proof of concept JavaScript library for generating Plutus transactions with a given set of constraints and lookups, exposing functionality from the <code>plutus-ledger-constraints</code> package. <!-- -->[<a href="https://github.com/hamishmack/plutus-apps/blob/1f331225853f502807aab370f82ec975bdec38ee/plutus-pab/mktx/README.md" target="_blank" rel="noopener noreferrer">Report</a>]</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="reporting">Reporting<a class="hash-link" href="#reporting" title="Direct link to heading">​</a></h2><ul><li>we wrote a blog post about the work we have done in 2021 as it wasn’t covered anywhere else: <a href="https://engineering.iog.io/2022-03-01-2021-ghc-update" target="_blank" rel="noopener noreferrer">https://engineering.iog.io/2022-03-01-2021-ghc-update</a></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about GHC February 2022 Update" href="/2022-03-09-ghc-february-2022-update"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2022-03-01-2021-ghc-update">2021 GHC update</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-03-01T00:00:00.000Z" itemprop="datePublished">March 1, 2022</time> · <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>IOG is committed to improving Haskell developer experience, both by <a href="https://iohk.io/en/blog/posts/2020/11/04/iohk-sponsors-new-haskell-foundation" target="_blank" rel="noopener noreferrer">sponsoring the Haskell Foundation</a> and by directly founding a team committed to this task: the Haskell DX team.</p><p>The team now tries to provide regular (monthly) updates about its work. This post is a bit longer because it covers all of 2021 which has not been covered anywhere else.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="code-generation">Code generation<a class="hash-link" href="#code-generation" title="Direct link to heading">​</a></h2><ul><li>Added a new backend for AArch64 architectures, especially to support Apple’s M1. Previously AArch64 was only supported via the LLVM based backend which is much slower. <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5884" target="_blank" rel="noopener noreferrer">!5884</a>]</li><li>Added support for Apple’s M1 calling convention. In GHC 9.2.1 it implied making lifted sized types (e.g. <code>Word8</code>, <code>Int16</code>...) use their unlifted counterparts (e.g. <code>Word8#</code>, <code>Int16#</code>...); in GHC 8.10.7 – a minor release –  a less invasive but more fragile solution was implemented <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/commit/c49250d88915db6acf88d2574db827cc2c4fa080" target="_blank" rel="noopener noreferrer">commit</a>]<!-- -->.</li><li>Fixed a very old GHC issue <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/1257" target="_blank" rel="noopener noreferrer">#1257</a>]<!-- --> by making GHCi support unboxed values <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4412" target="_blank" rel="noopener noreferrer">!4412</a>]<!-- -->: ByteCode is now generated from STG instead of directly from Core. It allows more Haskell codes to be supported by HLS and it even allows GHC code to be loaded into GHCi <!-- -->[<a href="https://mail.haskell.org/pipermail/ghc-devs/2021-October/020345.html" target="_blank" rel="noopener noreferrer">link</a>]<!-- -->.</li><li>Fixed a bug in the Cmm sinking pass that led to register corruption at runtime with the C backend. Even if we don’t use the C backend, fixing this avoided spurious errors in CI jobs using it <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19237" target="_blank" rel="noopener noreferrer">#19237</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5755/" target="_blank" rel="noopener noreferrer">!5755</a>]</li><li>Fixed a register clobbering issue for 64-bit comparisons generated with the 32-bit x86 NCG backend <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/commit/ecd6d14215eb40ac441c075e432ddaa0237f3c72" target="_blank" rel="noopener noreferrer">commit</a>]<!-- -->.</li><li>Fixed generation of switches on sized literals in StgToCmm <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6211" target="_blank" rel="noopener noreferrer">!6211</a>]</li><li>Fixed LLVM shifts <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19215" target="_blank" rel="noopener noreferrer">#19215</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4822" target="_blank" rel="noopener noreferrer">!4822</a>]</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="linker">Linker<a class="hash-link" href="#linker" title="Direct link to heading">​</a></h2><ul><li>Fixed an off-by-one error in the MachO (Darwin) linker <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6041/" target="_blank" rel="noopener noreferrer">!6041</a>]<!-- -->. The fix is simple but the debugging session was epic!</li><li>Fix to avoid linking plugin units unconditionally with target code, which is wrong in general but even more so when GHC is used as a cross-compiler: plugins and target code aren’t for the same platform <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20218" target="_blank" rel="noopener noreferrer">#20218</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6496" target="_blank" rel="noopener noreferrer">!6496</a>]</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="cross-compilation">Cross-compilation<a class="hash-link" href="#cross-compilation" title="Direct link to heading">​</a></h2><ul><li>With John Ericson (Obsidian Systems) we finally made GHC independent of its target <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6791" target="_blank" rel="noopener noreferrer">!6791</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6539" target="_blank" rel="noopener noreferrer">!6539</a>]<!-- -->. It means that there is no need to rebuild GHC to make it target another platform, so it now becomes possible to add support for a <code>--target=...</code> command-line flag <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/11470" target="_blank" rel="noopener noreferrer">#11470</a>]<!-- -->. It also means that a cross-compiling GHC could build plugins for its host platform in addition to building code for its target platform.</li><li>A side-effect of the previous bullet is that primops’ types are now platform independent. Previously some of them would use Word64 on 32-bit architectures and Word on 64-bit architectures: now Word64 is used on every platform. A side-effect of this side-effect is that we had to make Word64 as efficient as Word: it now benefits from the same optimizations (constant folding <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19024" target="_blank" rel="noopener noreferrer">#19024</a>, etc.). On 32-bit platforms, it reduced allocations by a fair amount in some cases: e.g. -25.8% in T9203 test and -11.5% when running haddock on base library <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6167" target="_blank" rel="noopener noreferrer">!6167</a>]<!-- -->. We hope it will benefit other 32-bit architectures such as JavaScript or WebAssembly.</li><li>GHC built as a cross-compiler doesn’t support compiler plugins <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/14335" target="_blank" rel="noopener noreferrer">#14335</a>]<!-- -->. We have been working on refactoring GHC to make it support two separate environments in a given compiler session – one for target code and another for the plugin/compiler code. The implementation in <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6748" target="_blank" rel="noopener noreferrer">!6748</a>]<!-- --> conflicts quite a lot with the support of multiple home-units that was added at about the same time. GHC needs to be refactored a lot more to correctly support this approach, so instead we implemented a different approach to load plugins which is more low-level and bypasses the issue <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20964" target="_blank" rel="noopener noreferrer">#20964</a>, <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7377" target="_blank" rel="noopener noreferrer">!7377</a>]<!-- -->.</li><li>We made GHC consider the target platform instead of the host platform in guessOutputFile <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6116" target="_blank" rel="noopener noreferrer">!6116</a>]</li><li>Use target platform instead of host platform to detect literal overflows <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/17336" target="_blank" rel="noopener noreferrer">#17336</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4986" target="_blank" rel="noopener noreferrer">!4986</a>]</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="ghcjs">GHCJS<a class="hash-link" href="#ghcjs" title="Direct link to heading">​</a></h2><ul><li>We updated GHCJS to use GHC 8.10.7 <!-- -->[<a href="https://github.com/ghcjs/ghcjs/tree/ghc-8.10" target="_blank" rel="noopener noreferrer">branch</a>]</li><li>We worked on making GHCJS’s codebase more suitable for integration into GHC: reducing the number of dependencies, avoiding the use of Template Haskell, reusing GHC’s build system, etc. There is now a GHCJS integrated into a GHC 8.10.7 fork <!-- -->[<a href="https://github.com/ghcjs/ghc/tree/ghc-8.10-ghcjs" target="_blank" rel="noopener noreferrer">branch</a>]<!-- -->.</li><li>This experience led us to plan the realization of a JS backend into GHC head based on GHCJS. More information about this topic in our next report.</li><li>We worked on making GHC’s testsuite pass with GHCJS, triaging tests that legitimately fail on a JS platform from tests revealing real GHCJS issues. <strong>[<!-- -->LINK<!-- -->]</strong></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="windows">Windows<a class="hash-link" href="#windows" title="Direct link to heading">​</a></h2><ul><li>We seemed to be the first to try to build GHC on Windows with the updated GNU autotools 2.70 and this release made a breaking change to the way auxiliary files (config.guess, config.sub) were handled, breaking GHC’s build (<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19189#note_332168" target="_blank" rel="noopener noreferrer">#19189</a>). The root cause of the issue couldn’t be easily solved so we modified GHC’s build system to avoid the use of these auxiliary files, bypassing the issue. Most GHC devs won’t ever notice that something was broken to begin with when they will update their GNU toolchain on Windows. <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4768" target="_blank" rel="noopener noreferrer">!4768</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4987" target="_blank" rel="noopener noreferrer">!4987</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5065/" target="_blank" rel="noopener noreferrer">!5065</a>]</li><li>Fixed cross-compilation of GHC from Linux to Windows using Hadrian <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20657" target="_blank" rel="noopener noreferrer">#20657</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6945" target="_blank" rel="noopener noreferrer">!6945</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6958" target="_blank" rel="noopener noreferrer">!6958</a>]</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="numeric">Numeric<a class="hash-link" href="#numeric" title="Direct link to heading">​</a></h2><ul><li>Fixed Natural to Float/Double conversions to align with the method used for Integer to Float/Double and added missing rewrite rules <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6004/" target="_blank" rel="noopener noreferrer">!6004</a>]</li><li>Made most bignum literals be desugared into their final form in HsToCore stage instead of CoreToStg stage to ensure that Core optimizations were applied correctly to them <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20245" target="_blank" rel="noopener noreferrer">#20245</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6376" target="_blank" rel="noopener noreferrer">!6376</a>]</li><li>Some constant folding rules were missing and were added:<ul><li>bitwise <code>and</code> primops when applied to a full mask (e.g. 0xFF for a 8-bit word). <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20448" target="_blank" rel="noopener noreferrer">#20448</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6629" target="_blank" rel="noopener noreferrer">!6629</a>]</li><li><code>negate</code> primops <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20347" target="_blank" rel="noopener noreferrer">#20347</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6535" target="_blank" rel="noopener noreferrer">!6535</a></li><li><code>timesInt2#</code> primop <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20374" target="_blank" rel="noopener noreferrer">#20374</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6531" target="_blank" rel="noopener noreferrer">!6531</a></li><li><code>ctz#/clz#/popCnt#</code> <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20376" target="_blank" rel="noopener noreferrer">#20376</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6532" target="_blank" rel="noopener noreferrer">!6532</a></li><li>missing rewrite rule to make the implementation of <code>nat2Word#</code> efficient <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/15547" target="_blank" rel="noopener noreferrer">#15547</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6847" target="_blank" rel="noopener noreferrer">!6847</a>]</li><li>rules for <code>Natural</code> <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/15821" target="_blank" rel="noopener noreferrer">#15821</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4837" target="_blank" rel="noopener noreferrer">!4837</a>]</li></ul></li><li>Allowed some ghc-bignum operations to inline to get better performance, while still managing to keep constant-folding working <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19641" target="_blank" rel="noopener noreferrer">#19641</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6677" target="_blank" rel="noopener noreferrer">!6677</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6696" target="_blank" rel="noopener noreferrer">!6696</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6306" target="_blank" rel="noopener noreferrer">!6306</a>]<!-- -->. There is some work left to do (cf <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20361" target="_blank" rel="noopener noreferrer">#20361</a>) but it is blocked by <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19313" target="_blank" rel="noopener noreferrer">#19313</a> which in turn is blocked by <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20554" target="_blank" rel="noopener noreferrer">#20554</a> which should be fixed soon (<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6865" target="_blank" rel="noopener noreferrer">!6865</a>, thanks Joachim!).</li><li>The ubiquitous <code>fromIntegral</code> function used to have many associated rewrite rules to make it fast (avoiding heap allocation of a passthrough Integer when possible) that were difficult to manage due to the combinatorial number of needed rules (<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19907" target="_blank" rel="noopener noreferrer">#19907</a>, <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20062" target="_blank" rel="noopener noreferrer">#20062</a>). We found a way to remove all these rules (<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5862" target="_blank" rel="noopener noreferrer">!5862</a>).</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="technical-debt--modularity">Technical debt &amp; modularity<a class="hash-link" href="#technical-debt--modularity" title="Direct link to heading">​</a></h2><ul><li>Made several component of the compiler independent of <code>DynFlags</code> (parsed command-line flags):<ul><li>TmpFS (dealing with temporary files) <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6186" target="_blank" rel="noopener noreferrer">!6186</a>]</li><li>Diagnostic options <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6043" target="_blank" rel="noopener noreferrer">!6043</a>]</li><li>Tracing functions <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5970" target="_blank" rel="noopener noreferrer">!5970</a>]</li><li>Logger <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4757" target="_blank" rel="noopener noreferrer">!4757</a>]</li><li>Logger &amp; Parser <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5845" target="_blank" rel="noopener noreferrer">!5845</a>]</li><li>Hooks <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4812" target="_blank" rel="noopener noreferrer">!4812</a>]</li></ul></li><li>Made the handling of “package imports” less fragile <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6586" target="_blank" rel="noopener noreferrer">!6586</a>]<!-- --> and refactored some code related to dependencies and recompilation avoidance <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6528" target="_blank" rel="noopener noreferrer">!6528</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6346" target="_blank" rel="noopener noreferrer">!6346</a>]<!-- -->.</li><li>Abstracted plugin related fields from HscEnv <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7175" target="_blank" rel="noopener noreferrer">!7175</a>]</li><li>Made a home-unit optional in several places <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7013/" target="_blank" rel="noopener noreferrer">!7013</a>]<!-- -->: the home-unit should only be required when compiling code, not when loading code (e.g. when loading plugins in cross-compilers <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/14335" target="_blank" rel="noopener noreferrer">#14335</a>).</li><li>Made GHC no longer expose the (wrong) selected ghc-bignum backend with <code>ghc --info</code>. ghc-bignum now exposes a backendName function for this purpose <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20495" target="_blank" rel="noopener noreferrer">#20495</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6903" target="_blank" rel="noopener noreferrer">!6903</a>]</li><li>Moved <code>tmpDir</code> from Settings to <code>DynFlags</code> <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6297/" target="_blank" rel="noopener noreferrer">!6297</a>]</li><li>Removed use of <code>unsafePerfomIO</code> in <code>getProgName</code> <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6137/" target="_blank" rel="noopener noreferrer">!6137</a>]</li><li>Refactored warning flags handling <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5815" target="_blank" rel="noopener noreferrer">!5815</a>]</li><li>Made assertions use normal functions instead of CPP <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5693" target="_blank" rel="noopener noreferrer">!5693</a>]</li><li>Made the interpreter more independent of the driver <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5627" target="_blank" rel="noopener noreferrer">!5627</a>]</li><li>Replaced <code>ptext . sLit</code> with <code>text</code> <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5625" target="_blank" rel="noopener noreferrer">!5625</a>]</li><li>Removed broken “dynamic-by-default” setting <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/16782" target="_blank" rel="noopener noreferrer">#16782</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5467" target="_blank" rel="noopener noreferrer">!5467</a>]</li><li>Abstracted some components from the compiler session state (<code>HscEnv</code>):<ul><li>unit-related fields into a new <code>UnitEnv</code>datatype <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5425" target="_blank" rel="noopener noreferrer">!5425</a>]</li><li><code>FinderCache</code> and <code>NameCache</code>[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4951" target="_blank" rel="noopener noreferrer">!4951</a>]</li><li>Loader state <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5287" target="_blank" rel="noopener noreferrer">!5287</a>]</li></ul></li><li>Removed the need for a home unit-id to initialize an external package state (EPS) <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5043" target="_blank" rel="noopener noreferrer">!5043</a>]</li><li>Refactored <code>-dynamic-too</code> handling <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19264" target="_blank" rel="noopener noreferrer">#19264</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4905" target="_blank" rel="noopener noreferrer">!4905</a>]</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="performance">Performance<a class="hash-link" href="#performance" title="Direct link to heading">​</a></h2><ul><li>Made <code>divInt#, modInt# and divModInt#</code> branchless and inlineable <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/18067" target="_blank" rel="noopener noreferrer">#18067</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19636" target="_blank" rel="noopener noreferrer">#19636</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/3229" target="_blank" rel="noopener noreferrer">!3229</a>]</li><li>Fixed Integral instances for Word8/16/32 and <code>showWord</code> to use <code>quotRemWordN</code> <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5891" target="_blank" rel="noopener noreferrer">!5891</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5846/" target="_blank" rel="noopener noreferrer">!5846</a>]</li><li>Improved performance of occurrence analysis <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19989" target="_blank" rel="noopener noreferrer">#19989</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5977" target="_blank" rel="noopener noreferrer">!5977</a>]</li><li>Fixed unnecessary pinned allocations in <code>appendFS</code> <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5989/" target="_blank" rel="noopener noreferrer">!5989</a>]</li><li>Added a rewrite rules for string literals:<ul><li>Concatenation of string literals <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20174" target="_blank" rel="noopener noreferrer">#20174</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/16373" target="_blank" rel="noopener noreferrer">#16373</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6259" target="_blank" rel="noopener noreferrer">!6259</a>]</li><li><code>(++) . unpackCString# ⇒ unpackAppendCString#</code> leading to a 15% reduction in compilation time on a specific example. <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6619" target="_blank" rel="noopener noreferrer">!6619</a>]</li><li>Compute SDoc literal size at compilation time <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19266" target="_blank" rel="noopener noreferrer">#19266</a>, <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4901" target="_blank" rel="noopener noreferrer">!4901</a>]</li></ul></li><li>Fix for Dwarf strings generated by the NCG that were unnecessarily retained in the FastString table <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6621" target="_blank" rel="noopener noreferrer">!6621</a>]</li><li>Worked on improving inlining heuristics by taking into account applied constructors at call sites <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20516" target="_blank" rel="noopener noreferrer">#20516</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6732" target="_blank" rel="noopener noreferrer">!6732</a>]<!-- -->. More work is needed though.</li><li>Fixed <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20857" target="_blank" rel="noopener noreferrer">#20857</a> by making the Id cache for primops used more often <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7241" target="_blank" rel="noopener noreferrer">!7241</a>]</li><li>Replaced some avoidable uses of <code>replicateM . length</code> with more efficient code <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7198" target="_blank" rel="noopener noreferrer">!7198</a>]<!-- -->. No performance gain this time but the next reader of this code won’t have to wonder if fixing it could improve performance.</li><li>Made <code>exprIsCheapX</code> inline for modest but easy perf improvements <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7183" target="_blank" rel="noopener noreferrer">!7183</a>]</li><li>Removed an allocation in the code used to write text on a Handle (used by putStrLn, etc.) <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7160" target="_blank" rel="noopener noreferrer">!7160</a>]</li><li>Replaced inefficient list operations with more efficient <code>Monoid ([a],[b])</code> operations in the driver <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7069" target="_blank" rel="noopener noreferrer">!7069</a>]<!-- -->, leading to 1.9% reduction in compiler allocations in MultiLayerModules test.</li><li>Disabled some callstack allocations in non-debug builds <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6252/" target="_blank" rel="noopener noreferrer">!6252</a>]</li><li>Made file copy in GHC more efficient <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5801" target="_blank" rel="noopener noreferrer">!5801</a>]</li><li>Miscellaneous pretty-printer enhancements <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5226" target="_blank" rel="noopener noreferrer">!5226</a>]</li><li>Type tidying perf improvements with strictness <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/14738" target="_blank" rel="noopener noreferrer">#14738</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4892" target="_blank" rel="noopener noreferrer">!4892</a>]</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="rts">RTS<a class="hash-link" href="#rts" title="Direct link to heading">​</a></h2><ul><li>Fixed issues related to the RTS’s ticker<ul><li>Fixed some races <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/18033" target="_blank" rel="noopener noreferrer">#18033</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20132" target="_blank" rel="noopener noreferrer">#20132</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6201" target="_blank" rel="noopener noreferrer">!6201</a>]</li><li>Made the RTS open the file descriptor for its timer (<code>timerfd</code>) on Linux synchronously to avoid weird interactions with Haskell code manipulating file descriptors <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20618" target="_blank" rel="noopener noreferrer">#20618</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6902" target="_blank" rel="noopener noreferrer">!6902</a>]<!-- -->.</li></ul></li><li>Moved GHC’s global variables used to manage Uniques into the RTS to fix plugin issues <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19940" target="_blank" rel="noopener noreferrer">#19940</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5900" target="_blank" rel="noopener noreferrer">!5900</a>]</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="build-system--ci">Build system / CI<a class="hash-link" href="#build-system--ci" title="Direct link to heading">​</a></h2><ul><li>Fixed Hadrian output to display warnings and errors after the multi screen long command lines <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20490" target="_blank" rel="noopener noreferrer">#20490</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6690" target="_blank" rel="noopener noreferrer">!6690</a>]</li><li>Avoided the installation of a global <code>platformConstants</code> file; made GHC load constants from the RTS unit instead, allowing it to be reinstalled with different constants <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5427" target="_blank" rel="noopener noreferrer">!5427</a>]</li><li>Made <code>deriveConstants</code> output its file atomically <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19684" target="_blank" rel="noopener noreferrer">#19684</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5520" target="_blank" rel="noopener noreferrer">!5520</a>]</li><li>Made compression with <code>xz</code> faster on CI <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5066" target="_blank" rel="noopener noreferrer">!5066</a>]</li><li>Don’t build extra object with <code>-no-hs-main</code> <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/18938" target="_blank" rel="noopener noreferrer">#18938</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4974" target="_blank" rel="noopener noreferrer">!4974</a>]</li><li>Add <code>hi-boot</code> dependencies with <code>ghc -M</code> <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/14482" target="_blank" rel="noopener noreferrer">#14482</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4876" target="_blank" rel="noopener noreferrer">!4876</a>]</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="misc">Misc<a class="hash-link" href="#misc" title="Direct link to heading">​</a></h2><ul><li>Stack: fixed interface reading in <code>hi-file-parser</code> to support GHC 8.10 and 9.0 <!-- -->[<a href="https://github.com/commercialhaskell/hi-file-parser/pull/2" target="_blank" rel="noopener noreferrer">PR</a>, <a href="https://github.com/commercialhaskell/stack/issues/5134" target="_blank" rel="noopener noreferrer">Stack#5134</a>]</li><li>Enhanced pretty-printing of coercions in Core dumps <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4856" target="_blank" rel="noopener noreferrer">!4856</a>]</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about 2021 GHC update" href="/2022-03-01-2021-ghc-update"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2022-02-01-ghc-january-2022-update">GHC January 2022 update</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-02-01T00:00:00.000Z" itemprop="datePublished">February 1, 2022</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Hopefully 2022 should be the year GHC will get a JavaScript backend without relying on GHCJS. This month the team has been busy planning the work that needs to be done to get there!</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="cross-compilation">Cross-compilation<a class="hash-link" href="#cross-compilation" title="Direct link to heading">​</a></h2><ul><li>GHCJS has been <a href="https://github.com/ghcjs/ghc/tree/ghc-8.10-ghcjs" target="_blank" rel="noopener noreferrer">updated</a> to reduce the gap with GHC 8.10.7 codebase to the point that GHC’s build system is used to build GHCJS</li><li>Internal work planning for the integration of GHCJS into GHC</li><li>A different approach to load plugins into cross-compilers has been implemented <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20964" target="_blank" rel="noopener noreferrer">#20964</a>, <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7377" target="_blank" rel="noopener noreferrer">!7377</a>]</li><li>GHCJS has been exercised to showcase compilation of some Plutus applications</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="modularity">Modularity<a class="hash-link" href="#modularity" title="Direct link to heading">​</a></h2><ul><li>A few “subsystems” of GHC have been made more modular and reusable by making them independent of the command-line flags (<code>DynFlags</code>) <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/17957" target="_blank" rel="noopener noreferrer">#17957</a>, <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7158" target="_blank" rel="noopener noreferrer">!7158</a>, <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7199" target="_blank" rel="noopener noreferrer">!7199</a>, <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7325" target="_blank" rel="noopener noreferrer">!7325</a>]<!-- -->. This work resulted in a 10% reduction in call sites to <code>DynFlags</code> and has now removed all references to <code>DynFlags</code> up to the <code>CoreToStg</code> pass, which is almost the entire backend of GHC.</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="performance">Performance<a class="hash-link" href="#performance" title="Direct link to heading">​</a></h2><ul><li>Jeffrey wrote a new HF <a href="https://github.com/haskellfoundation/tech-proposals/pull/26" target="_blank" rel="noopener noreferrer">proposal</a> about writing a Haskell Optimization handbook and has started working on it</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about GHC January 2022 update" href="/2022-02-01-ghc-january-2022-update"><b>Read More</b></a></div></footer></article></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/iog_eng" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://iohk.io/en/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">IOG Blog</a></li><li class="footer__item"><a href="https://github.com/input-output-hk/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 IOG Engineering, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.bdfa00cb.js"></script>
<script src="/assets/js/main.c7478fde.js"></script>
</body>
</html>