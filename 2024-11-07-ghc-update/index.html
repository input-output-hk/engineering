<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<title data-react-helmet="true">IOG GHC Update #37 | IOG Engineering</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://engineering.iog.io/2024-11-07-ghc-update"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="IOG GHC Update #37 | IOG Engineering"><meta data-react-helmet="true" name="description" content="Triweekly update from the GHC DevX team at IOG."><meta data-react-helmet="true" property="og:description" content="Triweekly update from the GHC DevX team at IOG."><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2024-11-07T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://iog.io/en/"><meta data-react-helmet="true" property="article:tag" content="ghc,ghc-update"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://engineering.iog.io/2024-11-07-ghc-update"><link data-react-helmet="true" rel="alternate" href="https://engineering.iog.io/2024-11-07-ghc-update" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://engineering.iog.io/2024-11-07-ghc-update" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.10ad4647.css">
<link rel="preload" href="/assets/js/runtime~main.186bfbc3.js" as="script">
<link rel="preload" href="/assets/js/main.c3cbf730.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/iohk-logo.png" alt="IOG" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/iohk-logo-inverted.png" alt="IOG" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Engineering</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Recent</a><a class="navbar__item navbar__link" href="/tags">Tags</a><a class="navbar__item navbar__link" href="/archive">Archive</a></div><div class="navbar__items navbar__items--right"><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a aria-current="page" class="sidebarItemLink_miNk sidebarItemLinkActive_RRTD" href="/2024-11-07-ghc-update">IOG GHC Update #37</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-10-17-ghc-update">IOG GHC Update #36</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-09-26-ghc-update">IOG GHC Update #35</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-09-05-ghc-update">IOG GHC Update #34</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-08-15-ghc-update">IOG GHC Update #33</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-07-24-ghc-update">IOG GHC Update #32</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-07-08-ghc-update">IOG GHC Update #31</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-06-17-ghc-update">IOG GHC Update #30</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-05-23-ghc-update">IOG GHC Update #29</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-05-02-ghc-update">IOG GHC Update #28</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-04-11-ghc-update">IOG GHC Update #27</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-03-21-ghc-update">IOG GHC Update #26</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-02-29-ghc-update">IOG GHC Update #25</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-02-08-ghc-update">IOG GHC Update #24</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-01-18-ghc-update">IOG GHC Update #23</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-01-04-ghc-update">IOG GHC Update #22</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-12-07-ghc-update">IOG GHC Update #21</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-11-16-ghc-update">IOG GHC Update #20</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-10-26-ghc-update">IOG GHC Update #19</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-10-25-internship">Internship in GHC at IOG</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_rzP5" itemprop="headline">IOG GHC Update #37</h1><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2024-11-07T00:00:00.000Z" itemprop="datePublished">November 7, 2024</time> Â· <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey M. Young</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Luite Stegeman</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>Triweekly update from the GHC DevX team at IOG.</p><p>Previous updates can be found <a href="https://engineering.iog.io/tags/ghc-update" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="high-level-summary">High-level Summary<a class="hash-link" href="#high-level-summary" title="Direct link to heading">â€‹</a></h2><p>The team has been working on providing patches for GHC to fix the cardano regression mentioned in previous updates.</p><p>See details below for the more general maintenance and improvement fixes.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="details">Details<a class="hash-link" href="#details" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="performance">Performance<a class="hash-link" href="#performance" title="Direct link to heading">â€‹</a></h3><p>Sylvain: improved performance of codes using user event tracing (e.g.
<code>traceEvent</code>) when tracing is disabled, putting an end to a long saga of merge
requests by different people
(<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/3323" target="_blank" rel="noopener noreferrer">GHC!3323</a>,
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5316" target="_blank" rel="noopener noreferrer">GHC!5316</a>,
<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/12302" target="_blank" rel="noopener noreferrer">GHC!12302</a>). I
mostly did the menial work of making the latest MR pass CI and of getting it
approved by the CLC because it impacts <code>base</code>
(<a href="https://github.com/haskell/core-libraries-committee/issues/291#issuecomment-2420734806" target="_blank" rel="noopener noreferrer">CLC!291</a>).
See <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13295" target="_blank" rel="noopener noreferrer">GHC!13295</a> and
<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/17949" target="_blank" rel="noopener noreferrer">GHC#17949</a>.</p><p>Luite: Attempted to find the right conditions in the coreprep pass to modify speculative
evaluation optimization to fix the regression preventing us from upgrading Cardano
to GHC 9.6. Unfortunately it turned out that a working fix would also affect
optimizations elsewhere, making it risky to backport. We decided to add flags
to GHC for directly controlling the speculative evaluation optimization instead,
with the intention of backporting them to GHC 9.6+. See <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13556" target="_blank" rel="noopener noreferrer">GHC!13556</a> and
<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/25284" target="_blank" rel="noopener noreferrer">GHC#25284</a>.</p><p>Jeff: Refined the SrcLoc type to be unpacked and strict. This was the second attempt to close out CLC proposal <a href="https://github.com/haskell/core-libraries-committee/issues/55" target="_blank" rel="noopener noreferrer">CLC#55</a>. This is now merged in <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13381" target="_blank" rel="noopener noreferrer">GHC!13381</a> and reduced binary sizes for almost every compiler artifact.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="toolchain">Toolchain<a class="hash-link" href="#toolchain" title="Direct link to heading">â€‹</a></h3><p>Sylvain: fixed Stack support for the upcoming GHC 9.12. See <a href="https://github.com/commercialhaskell/hi-file-parser/issues/21" target="_blank" rel="noopener noreferrer">hi-file-parser#21</a> and
<a href="https://github.com/commercialhaskell/hi-file-parser/pull/23" target="_blank" rel="noopener noreferrer">hi-file-parser!23</a>. Almost every release of GHC makes some changes to the interface file (.hi) format.
Stack parses these files to get dependency tracking right. This solution is fragile but there isn&#x27;t another option currently: see <a href="https://github.com/commercialhaskell/stack/issues/5134" target="_blank" rel="noopener noreferrer">stack#5134</a>,
<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/17620" target="_blank" rel="noopener noreferrer">GHC#17620</a>, and <a href="https://github.com/ghc-proposals/ghc-proposals/pull/245" target="_blank" rel="noopener noreferrer">GHC-proposal#245</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="maintenance">Maintenance<a class="hash-link" href="#maintenance" title="Direct link to heading">â€‹</a></h3><p>Sylvain: simplified the handling of the virtual <code>GHC.Prim</code> module by the build system.
The build systems no longer have to special-case the handling of this module: it is all done in GHC which was already treating it differently internally anyway. See <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13477" target="_blank" rel="noopener noreferrer">GHC!13477</a>.</p><p>Luite: Fixed a small issue with non-ASCII characters in the parser breaking HLS. See <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/25396" target="_blank" rel="noopener noreferrer">GHC#25396</a>, <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13461" target="_blank" rel="noopener noreferrer">GHC!13461</a>.</p><p>Jeff: Has been working towards splitting base and GHC with CLC proposal <a href="https://github.com/haskell/core-libraries-committee/issues/289" target="_blank" rel="noopener noreferrer">CLC#289</a>. This has been implemented in <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13428" target="_blank" rel="noopener noreferrer">GHC!13428</a> and <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13343" target="_blank" rel="noopener noreferrer">GHC!13343</a>. GHC will be a little less coupled to base in 9.14 :)</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_h6_j"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/input-output-hk/engineering/tree/master/blog/2024-11-07-ghc-update-37.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/2024-10-17-ghc-update"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">IOG GHC Update #36</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_cNA8 thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#high-level-summary" class="table-of-contents__link toc-highlight">High-level Summary</a></li><li><a href="#details" class="table-of-contents__link toc-highlight">Details</a><ul><li><a href="#performance" class="table-of-contents__link toc-highlight">Performance</a></li><li><a href="#toolchain" class="table-of-contents__link toc-highlight">Toolchain</a></li><li><a href="#maintenance" class="table-of-contents__link toc-highlight">Maintenance</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/iog_eng" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://iohk.io/en/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">IOG Blog</a></li><li class="footer__item"><a href="https://github.com/input-output-hk/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2024 IOG Engineering, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.186bfbc3.js"></script>
<script src="/assets/js/main.c3cbf730.js"></script>
</body>
</html>