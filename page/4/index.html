<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<title data-react-helmet="true">Blog | IOG Engineering</title><meta data-react-helmet="true" property="og:title" content="Blog | IOG Engineering"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="description" content="Blog"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" property="og:url" content="https://engineering.iog.io/page/4"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_posts_list"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://engineering.iog.io/page/4"><link data-react-helmet="true" rel="alternate" href="https://engineering.iog.io/page/4" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://engineering.iog.io/page/4" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.10ad4647.css">
<link rel="preload" href="/assets/js/runtime~main.70882d04.js" as="script">
<link rel="preload" href="/assets/js/main.b2cdd8e8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/iohk-logo.png" alt="IOG" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/iohk-logo-inverted.png" alt="IOG" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Engineering</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Recent</a><a class="navbar__item navbar__link" href="/tags">Tags</a><a class="navbar__item navbar__link" href="/archive">Archive</a></div><div class="navbar__items navbar__items--right"><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">🌜</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">🌞</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-11-28-ghc-update">IOG GHC Update #38</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-11-07-ghc-update">IOG GHC Update #37</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-10-17-ghc-update">IOG GHC Update #36</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-09-26-ghc-update">IOG GHC Update #35</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-09-05-ghc-update">IOG GHC Update #34</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-08-15-ghc-update">IOG GHC Update #33</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-07-24-ghc-update">IOG GHC Update #32</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-07-08-ghc-update">IOG GHC Update #31</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-06-17-ghc-update">IOG GHC Update #30</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-05-23-ghc-update">IOG GHC Update #29</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-05-02-ghc-update">IOG GHC Update #28</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-04-11-ghc-update">IOG GHC Update #27</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-03-21-ghc-update">IOG GHC Update #26</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-02-29-ghc-update">IOG GHC Update #25</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-02-08-ghc-update">IOG GHC Update #24</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-01-18-ghc-update">IOG GHC Update #23</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-01-04-ghc-update">IOG GHC Update #22</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-12-07-ghc-update">IOG GHC Update #21</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-11-16-ghc-update">IOG GHC Update #20</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-10-26-ghc-update">IOG GHC Update #19</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2022-04-08-haskell-nix-march-update">haskell.nix March Update</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-04-08T00:00:00.000Z" itemprop="datePublished">April 8, 2022</time> · <!-- -->2 min read</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_mojV" id="changes">Changes<a class="hash-link" href="#changes" title="Direct link to heading">​</a></h2><ul><li>To cross compile Haskell code for windows a <code>wine</code> process must be used to evaluate Template Haskell code at compile time.  Some times this code needs DLLs to be present for the Template Haskell code to run.  We had been maintaining a list of DLLs manually (<a href="https://github.com/input-output-hk/haskell.nix/pull/1400" target="_blank" rel="noopener noreferrer">#1400</a> for instance added <code>secp256k1</code>).  A more general solution (<a href="https://github.com/input-output-hk/haskell.nix/pull/1405" target="_blank" rel="noopener noreferrer">#1405</a>) was found that uses the <code>pkgsHostTarget</code> environment variable to obtain a list of all the packages dependencies.  Then the DLLs from the are made available to the <code>wine</code> process running the Template Haskell code.  This should make more libraries build correctly while reducing unnecessary dependencies.</li><li>The way Haskell.nix cleans source trees has changed with <a href="https://github.com/input-output-hk/haskell.nix/pull/1403" target="_blank" rel="noopener noreferrer">#1403</a>, <a href="https://github.com/input-output-hk/haskell.nix/pull/1409" target="_blank" rel="noopener noreferrer">#1409</a> and <a href="https://github.com/input-output-hk/haskell.nix/pull/1418" target="_blank" rel="noopener noreferrer">#1418</a>.  When using Nix <code>&gt;=2.4</code> source in the store is now filtered in the same way it is locally.  This has a couple of key advantages:<ul><li>It makes it less likely that results on CI systems (where the source is likely to be in the store) will differ from results for local builds (where the source is in a cloned git repository).</li><li>Potential for reducing load on CI.  Although more work may be needed, this kind of filtering combined with the experimental content addressing features of Nix reduce the required rebuilds.</li></ul></li><li>In the past rather cryptic error messages were given when an attempt was made to use an old version of GHC on a platform Haskell.nix did not support it.  In some cases Haskell.nix would even attempt to build GHC and only fail after some time.  Better error messages are now given right away when an attempt is made to use a GHC version that is not supported for a particular platform <a href="https://github.com/input-output-hk/haskell.nix/pull/1411" target="_blank" rel="noopener noreferrer">#1411</a></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="version-updates">Version Updates<a class="hash-link" href="#version-updates" title="Direct link to heading">​</a></h2><ul><li>GHC 9.2.2 was added <a href="https://github.com/input-output-hk/haskell.nix/pull/1394" target="_blank" rel="noopener noreferrer">#1394</a></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="bug-fixes">Bug fixes<a class="hash-link" href="#bug-fixes" title="Direct link to heading">​</a></h2><ul><li><code>gitMinimal</code> replaces <code>git</code> to reduce the dependency tree of <code>cabalProject</code> functions <a href="https://github.com/input-output-hk/haskell.nix/pull/1387" target="_blank" rel="noopener noreferrer">#1387</a></li><li>Less used of <code>allowSubstitutes=false</code> <a href="https://github.com/input-output-hk/haskell.nix/pull/1389" target="_blank" rel="noopener noreferrer">#1389</a></li><li>Fixed <code>aarch64-linux</code> builds by using correct boot compiler <a href="https://github.com/input-output-hk/haskell.nix/pull/1390" target="_blank" rel="noopener noreferrer">#1390</a></li><li><code>icu-i18n</code> package mapping added to make <code>text-icu</code> build <a href="https://github.com/input-output-hk/haskell.nix/pull/1395" target="_blank" rel="noopener noreferrer">#1395</a></li><li>Fixes needed for newer <code>nixpkgs</code> versions<ul><li>Use list for <code>configureFlags</code> <a href="https://github.com/input-output-hk/haskell.nix/pull/1396" target="_blank" rel="noopener noreferrer">#1396</a></li><li>The spdx json file is in a <code>.json</code> output <a href="https://github.com/input-output-hk/haskell.nix/pull/1397" target="_blank" rel="noopener noreferrer">#1397</a></li><li><code>gdk_pixbuf</code> is now <code>gdk-pixbuf</code> <a href="https://github.com/input-output-hk/haskell.nix/pull/1398" target="_blank" rel="noopener noreferrer">#1398</a></li></ul></li><li>Replaced deprecated NixOS binary cache settings in docs <a href="https://github.com/input-output-hk/haskell.nix/pull/1410" target="_blank" rel="noopener noreferrer">#1410</a></li><li>Enable static build of <code>secp256k1</code> on musl <a href="https://github.com/input-output-hk/haskell.nix/pull/1413" target="_blank" rel="noopener noreferrer">#1413</a></li></ul><p>Finally, we’d like to thank all the awesome contributors, who make <code>haskell.nix</code> a thriving open source project! ❤️</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/nix">nix</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2022-03-09-ghc-february-2022-update">GHC February 2022 Update</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-03-09T00:00:00.000Z" itemprop="datePublished">March 9, 2022</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_mojV" id="js-backend">JS backend<a class="hash-link" href="#js-backend" title="Direct link to heading">​</a></h2><p>This month we worked on adapting code from GHCJS to merge into GHC head. We also started discussing the implementation process publicly and especially with our colleagues at Well-Typed.</p><ul><li>Ticket about adapting GHCJS’ code into a proper JS backend for GHC has been opened <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/21078" target="_blank" rel="noopener noreferrer">#21078</a>]<!-- -->. Feedback was very positive!</li><li>There were discussions about the process and an agreement to target GHC 9.6 release <!-- -->[<a href="https://mail.haskell.org/pipermail/ghc-devs/2022-February/020580.html" target="_blank" rel="noopener noreferrer">email on ghc-devs</a>, <a href="https://gitlab.haskell.org/ghc/ghc/-/wikis/javascript-backend" target="_blank" rel="noopener noreferrer">wiki page</a>]</li><li><code>deriveConstants</code> is a program used to generate some header file included in the rts package. While it is mainly useful for native targets, we had to make it support Javascript targets <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7585" target="_blank" rel="noopener noreferrer">!7585</a>]</li><li>Javascript is going to be the first official target platform supported by GHC that has its own notion of managed heap objects. Hence we may need a new <code>RuntimeRep</code> to represent these values for Haskell codes interacting with JS codes via FFI. We opened <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7577" target="_blank" rel="noopener noreferrer">!7577</a> into which we tried to make this new <code>RuntimeRep</code> non JS specific so that it could be reused for future backends targeting other managed platforms (e.g. CLR, JVM). It triggered a lot of discussions summarized in <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/21142" target="_blank" rel="noopener noreferrer">#21142</a>.</li><li>GHCJS’s code generator was ported to GHC head <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7573" target="_blank" rel="noopener noreferrer">!7573</a>]<!-- -->. In its current state, we can generate Javascript unoptimised code -- the optimiser hasn’t been ported yet -- by compiling a module with <code>-c -fjavascript</code>. It required many changes, not only to adapt to changes between GHC 8.10 and GHC head but also to avoid adding new package dependencies. It was also an opportunity to refactor and to document the code, which is still a work in progress.</li><li>GHC doesn’t use any lens library, hence to port the code generator we had to replace lenses with usual record accessors. It turned out that <code>case</code> alternatives in STG lacked them because they were represented with a triple. We took the opportunity to introduce a proper record type for them  <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7652" target="_blank" rel="noopener noreferrer">!7652</a></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="plutus-apps-js-demo">Plutus-apps JS demo<a class="hash-link" href="#plutus-apps-js-demo" title="Direct link to heading">​</a></h2><ul><li>We improved the proof of concept JavaScript library for generating Plutus transactions with a given set of constraints and lookups, exposing functionality from the <code>plutus-ledger-constraints</code> package. <!-- -->[<a href="https://github.com/hamishmack/plutus-apps/blob/1f331225853f502807aab370f82ec975bdec38ee/plutus-pab/mktx/README.md" target="_blank" rel="noopener noreferrer">Report</a>]</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="reporting">Reporting<a class="hash-link" href="#reporting" title="Direct link to heading">​</a></h2><ul><li>we wrote a blog post about the work we have done in 2021 as it wasn’t covered anywhere else: <a href="https://engineering.iog.io/2022-03-01-2021-ghc-update" target="_blank" rel="noopener noreferrer">https://engineering.iog.io/2022-03-01-2021-ghc-update</a></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2022-03-01-2021-ghc-update">2021 GHC update</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-03-01T00:00:00.000Z" itemprop="datePublished">March 1, 2022</time> · <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>IOG is committed to improving Haskell developer experience, both by <a href="https://iohk.io/en/blog/posts/2020/11/04/iohk-sponsors-new-haskell-foundation" target="_blank" rel="noopener noreferrer">sponsoring the Haskell Foundation</a> and by directly founding a team committed to this task: the Haskell DX team.</p><p>The team now tries to provide regular (monthly) updates about its work. This post is a bit longer because it covers all of 2021 which has not been covered anywhere else.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="code-generation">Code generation<a class="hash-link" href="#code-generation" title="Direct link to heading">​</a></h2><ul><li>Added a new backend for AArch64 architectures, especially to support Apple’s M1. Previously AArch64 was only supported via the LLVM based backend which is much slower. <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5884" target="_blank" rel="noopener noreferrer">!5884</a>]</li><li>Added support for Apple’s M1 calling convention. In GHC 9.2.1 it implied making lifted sized types (e.g. <code>Word8</code>, <code>Int16</code>...) use their unlifted counterparts (e.g. <code>Word8#</code>, <code>Int16#</code>...); in GHC 8.10.7 – a minor release –  a less invasive but more fragile solution was implemented <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/commit/c49250d88915db6acf88d2574db827cc2c4fa080" target="_blank" rel="noopener noreferrer">commit</a>]<!-- -->.</li><li>Fixed a very old GHC issue <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/1257" target="_blank" rel="noopener noreferrer">#1257</a>]<!-- --> by making GHCi support unboxed values <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4412" target="_blank" rel="noopener noreferrer">!4412</a>]<!-- -->: ByteCode is now generated from STG instead of directly from Core. It allows more Haskell codes to be supported by HLS and it even allows GHC code to be loaded into GHCi <!-- -->[<a href="https://mail.haskell.org/pipermail/ghc-devs/2021-October/020345.html" target="_blank" rel="noopener noreferrer">link</a>]<!-- -->.</li><li>Fixed a bug in the Cmm sinking pass that led to register corruption at runtime with the C backend. Even if we don’t use the C backend, fixing this avoided spurious errors in CI jobs using it <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19237" target="_blank" rel="noopener noreferrer">#19237</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5755/" target="_blank" rel="noopener noreferrer">!5755</a>]</li><li>Fixed a register clobbering issue for 64-bit comparisons generated with the 32-bit x86 NCG backend <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/commit/ecd6d14215eb40ac441c075e432ddaa0237f3c72" target="_blank" rel="noopener noreferrer">commit</a>]<!-- -->.</li><li>Fixed generation of switches on sized literals in StgToCmm <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6211" target="_blank" rel="noopener noreferrer">!6211</a>]</li><li>Fixed LLVM shifts <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19215" target="_blank" rel="noopener noreferrer">#19215</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4822" target="_blank" rel="noopener noreferrer">!4822</a>]</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="linker">Linker<a class="hash-link" href="#linker" title="Direct link to heading">​</a></h2><ul><li>Fixed an off-by-one error in the MachO (Darwin) linker <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6041/" target="_blank" rel="noopener noreferrer">!6041</a>]<!-- -->. The fix is simple but the debugging session was epic!</li><li>Fix to avoid linking plugin units unconditionally with target code, which is wrong in general but even more so when GHC is used as a cross-compiler: plugins and target code aren’t for the same platform <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20218" target="_blank" rel="noopener noreferrer">#20218</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6496" target="_blank" rel="noopener noreferrer">!6496</a>]</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="cross-compilation">Cross-compilation<a class="hash-link" href="#cross-compilation" title="Direct link to heading">​</a></h2><ul><li>With John Ericson (Obsidian Systems) we finally made GHC independent of its target <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6791" target="_blank" rel="noopener noreferrer">!6791</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6539" target="_blank" rel="noopener noreferrer">!6539</a>]<!-- -->. It means that there is no need to rebuild GHC to make it target another platform, so it now becomes possible to add support for a <code>--target=...</code> command-line flag <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/11470" target="_blank" rel="noopener noreferrer">#11470</a>]<!-- -->. It also means that a cross-compiling GHC could build plugins for its host platform in addition to building code for its target platform.</li><li>A side-effect of the previous bullet is that primops’ types are now platform independent. Previously some of them would use Word64 on 32-bit architectures and Word on 64-bit architectures: now Word64 is used on every platform. A side-effect of this side-effect is that we had to make Word64 as efficient as Word: it now benefits from the same optimizations (constant folding <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19024" target="_blank" rel="noopener noreferrer">#19024</a>, etc.). On 32-bit platforms, it reduced allocations by a fair amount in some cases: e.g. -25.8% in T9203 test and -11.5% when running haddock on base library <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6167" target="_blank" rel="noopener noreferrer">!6167</a>]<!-- -->. We hope it will benefit other 32-bit architectures such as JavaScript or WebAssembly.</li><li>GHC built as a cross-compiler doesn’t support compiler plugins <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/14335" target="_blank" rel="noopener noreferrer">#14335</a>]<!-- -->. We have been working on refactoring GHC to make it support two separate environments in a given compiler session – one for target code and another for the plugin/compiler code. The implementation in <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6748" target="_blank" rel="noopener noreferrer">!6748</a>]<!-- --> conflicts quite a lot with the support of multiple home-units that was added at about the same time. GHC needs to be refactored a lot more to correctly support this approach, so instead we implemented a different approach to load plugins which is more low-level and bypasses the issue <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20964" target="_blank" rel="noopener noreferrer">#20964</a>, <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7377" target="_blank" rel="noopener noreferrer">!7377</a>]<!-- -->.</li><li>We made GHC consider the target platform instead of the host platform in guessOutputFile <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6116" target="_blank" rel="noopener noreferrer">!6116</a>]</li><li>Use target platform instead of host platform to detect literal overflows <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/17336" target="_blank" rel="noopener noreferrer">#17336</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4986" target="_blank" rel="noopener noreferrer">!4986</a>]</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="ghcjs">GHCJS<a class="hash-link" href="#ghcjs" title="Direct link to heading">​</a></h2><ul><li>We updated GHCJS to use GHC 8.10.7 <!-- -->[<a href="https://github.com/ghcjs/ghcjs/tree/ghc-8.10" target="_blank" rel="noopener noreferrer">branch</a>]</li><li>We worked on making GHCJS’s codebase more suitable for integration into GHC: reducing the number of dependencies, avoiding the use of Template Haskell, reusing GHC’s build system, etc. There is now a GHCJS integrated into a GHC 8.10.7 fork <!-- -->[<a href="https://github.com/ghcjs/ghc/tree/ghc-8.10-ghcjs" target="_blank" rel="noopener noreferrer">branch</a>]<!-- -->.</li><li>This experience led us to plan the realization of a JS backend into GHC head based on GHCJS. More information about this topic in our next report.</li><li>We worked on making GHC’s testsuite pass with GHCJS, triaging tests that legitimately fail on a JS platform from tests revealing real GHCJS issues. <strong>[<!-- -->LINK<!-- -->]</strong></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="windows">Windows<a class="hash-link" href="#windows" title="Direct link to heading">​</a></h2><ul><li>We seemed to be the first to try to build GHC on Windows with the updated GNU autotools 2.70 and this release made a breaking change to the way auxiliary files (config.guess, config.sub) were handled, breaking GHC’s build (<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19189#note_332168" target="_blank" rel="noopener noreferrer">#19189</a>). The root cause of the issue couldn’t be easily solved so we modified GHC’s build system to avoid the use of these auxiliary files, bypassing the issue. Most GHC devs won’t ever notice that something was broken to begin with when they will update their GNU toolchain on Windows. <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4768" target="_blank" rel="noopener noreferrer">!4768</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4987" target="_blank" rel="noopener noreferrer">!4987</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5065/" target="_blank" rel="noopener noreferrer">!5065</a>]</li><li>Fixed cross-compilation of GHC from Linux to Windows using Hadrian <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20657" target="_blank" rel="noopener noreferrer">#20657</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6945" target="_blank" rel="noopener noreferrer">!6945</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6958" target="_blank" rel="noopener noreferrer">!6958</a>]</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="numeric">Numeric<a class="hash-link" href="#numeric" title="Direct link to heading">​</a></h2><ul><li>Fixed Natural to Float/Double conversions to align with the method used for Integer to Float/Double and added missing rewrite rules <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6004/" target="_blank" rel="noopener noreferrer">!6004</a>]</li><li>Made most bignum literals be desugared into their final form in HsToCore stage instead of CoreToStg stage to ensure that Core optimizations were applied correctly to them <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20245" target="_blank" rel="noopener noreferrer">#20245</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6376" target="_blank" rel="noopener noreferrer">!6376</a>]</li><li>Some constant folding rules were missing and were added:<ul><li>bitwise <code>and</code> primops when applied to a full mask (e.g. 0xFF for a 8-bit word). <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20448" target="_blank" rel="noopener noreferrer">#20448</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6629" target="_blank" rel="noopener noreferrer">!6629</a>]</li><li><code>negate</code> primops <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20347" target="_blank" rel="noopener noreferrer">#20347</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6535" target="_blank" rel="noopener noreferrer">!6535</a></li><li><code>timesInt2#</code> primop <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20374" target="_blank" rel="noopener noreferrer">#20374</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6531" target="_blank" rel="noopener noreferrer">!6531</a></li><li><code>ctz#/clz#/popCnt#</code> <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20376" target="_blank" rel="noopener noreferrer">#20376</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6532" target="_blank" rel="noopener noreferrer">!6532</a></li><li>missing rewrite rule to make the implementation of <code>nat2Word#</code> efficient <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/15547" target="_blank" rel="noopener noreferrer">#15547</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6847" target="_blank" rel="noopener noreferrer">!6847</a>]</li><li>rules for <code>Natural</code> <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/15821" target="_blank" rel="noopener noreferrer">#15821</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4837" target="_blank" rel="noopener noreferrer">!4837</a>]</li></ul></li><li>Allowed some ghc-bignum operations to inline to get better performance, while still managing to keep constant-folding working <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19641" target="_blank" rel="noopener noreferrer">#19641</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6677" target="_blank" rel="noopener noreferrer">!6677</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6696" target="_blank" rel="noopener noreferrer">!6696</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6306" target="_blank" rel="noopener noreferrer">!6306</a>]<!-- -->. There is some work left to do (cf <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20361" target="_blank" rel="noopener noreferrer">#20361</a>) but it is blocked by <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19313" target="_blank" rel="noopener noreferrer">#19313</a> which in turn is blocked by <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20554" target="_blank" rel="noopener noreferrer">#20554</a> which should be fixed soon (<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6865" target="_blank" rel="noopener noreferrer">!6865</a>, thanks Joachim!).</li><li>The ubiquitous <code>fromIntegral</code> function used to have many associated rewrite rules to make it fast (avoiding heap allocation of a passthrough Integer when possible) that were difficult to manage due to the combinatorial number of needed rules (<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19907" target="_blank" rel="noopener noreferrer">#19907</a>, <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20062" target="_blank" rel="noopener noreferrer">#20062</a>). We found a way to remove all these rules (<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5862" target="_blank" rel="noopener noreferrer">!5862</a>).</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="technical-debt--modularity">Technical debt &amp; modularity<a class="hash-link" href="#technical-debt--modularity" title="Direct link to heading">​</a></h2><ul><li>Made several component of the compiler independent of <code>DynFlags</code> (parsed command-line flags):<ul><li>TmpFS (dealing with temporary files) <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6186" target="_blank" rel="noopener noreferrer">!6186</a>]</li><li>Diagnostic options <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6043" target="_blank" rel="noopener noreferrer">!6043</a>]</li><li>Tracing functions <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5970" target="_blank" rel="noopener noreferrer">!5970</a>]</li><li>Logger <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4757" target="_blank" rel="noopener noreferrer">!4757</a>]</li><li>Logger &amp; Parser <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5845" target="_blank" rel="noopener noreferrer">!5845</a>]</li><li>Hooks <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4812" target="_blank" rel="noopener noreferrer">!4812</a>]</li></ul></li><li>Made the handling of “package imports” less fragile <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6586" target="_blank" rel="noopener noreferrer">!6586</a>]<!-- --> and refactored some code related to dependencies and recompilation avoidance <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6528" target="_blank" rel="noopener noreferrer">!6528</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6346" target="_blank" rel="noopener noreferrer">!6346</a>]<!-- -->.</li><li>Abstracted plugin related fields from HscEnv <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7175" target="_blank" rel="noopener noreferrer">!7175</a>]</li><li>Made a home-unit optional in several places <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7013/" target="_blank" rel="noopener noreferrer">!7013</a>]<!-- -->: the home-unit should only be required when compiling code, not when loading code (e.g. when loading plugins in cross-compilers <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/14335" target="_blank" rel="noopener noreferrer">#14335</a>).</li><li>Made GHC no longer expose the (wrong) selected ghc-bignum backend with <code>ghc --info</code>. ghc-bignum now exposes a backendName function for this purpose <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20495" target="_blank" rel="noopener noreferrer">#20495</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6903" target="_blank" rel="noopener noreferrer">!6903</a>]</li><li>Moved <code>tmpDir</code> from Settings to <code>DynFlags</code> <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6297/" target="_blank" rel="noopener noreferrer">!6297</a>]</li><li>Removed use of <code>unsafePerfomIO</code> in <code>getProgName</code> <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6137/" target="_blank" rel="noopener noreferrer">!6137</a>]</li><li>Refactored warning flags handling <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5815" target="_blank" rel="noopener noreferrer">!5815</a>]</li><li>Made assertions use normal functions instead of CPP <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5693" target="_blank" rel="noopener noreferrer">!5693</a>]</li><li>Made the interpreter more independent of the driver <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5627" target="_blank" rel="noopener noreferrer">!5627</a>]</li><li>Replaced <code>ptext . sLit</code> with <code>text</code> <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5625" target="_blank" rel="noopener noreferrer">!5625</a>]</li><li>Removed broken “dynamic-by-default” setting <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/16782" target="_blank" rel="noopener noreferrer">#16782</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5467" target="_blank" rel="noopener noreferrer">!5467</a>]</li><li>Abstracted some components from the compiler session state (<code>HscEnv</code>):<ul><li>unit-related fields into a new <code>UnitEnv</code>datatype <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5425" target="_blank" rel="noopener noreferrer">!5425</a>]</li><li><code>FinderCache</code> and <code>NameCache</code>[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4951" target="_blank" rel="noopener noreferrer">!4951</a>]</li><li>Loader state <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5287" target="_blank" rel="noopener noreferrer">!5287</a>]</li></ul></li><li>Removed the need for a home unit-id to initialize an external package state (EPS) <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5043" target="_blank" rel="noopener noreferrer">!5043</a>]</li><li>Refactored <code>-dynamic-too</code> handling <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19264" target="_blank" rel="noopener noreferrer">#19264</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4905" target="_blank" rel="noopener noreferrer">!4905</a>]</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="performance">Performance<a class="hash-link" href="#performance" title="Direct link to heading">​</a></h2><ul><li>Made <code>divInt#, modInt# and divModInt#</code> branchless and inlineable <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/18067" target="_blank" rel="noopener noreferrer">#18067</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19636" target="_blank" rel="noopener noreferrer">#19636</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/3229" target="_blank" rel="noopener noreferrer">!3229</a>]</li><li>Fixed Integral instances for Word8/16/32 and <code>showWord</code> to use <code>quotRemWordN</code> <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5891" target="_blank" rel="noopener noreferrer">!5891</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5846/" target="_blank" rel="noopener noreferrer">!5846</a>]</li><li>Improved performance of occurrence analysis <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19989" target="_blank" rel="noopener noreferrer">#19989</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5977" target="_blank" rel="noopener noreferrer">!5977</a>]</li><li>Fixed unnecessary pinned allocations in <code>appendFS</code> <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5989/" target="_blank" rel="noopener noreferrer">!5989</a>]</li><li>Added a rewrite rules for string literals:<ul><li>Concatenation of string literals <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20174" target="_blank" rel="noopener noreferrer">#20174</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/16373" target="_blank" rel="noopener noreferrer">#16373</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6259" target="_blank" rel="noopener noreferrer">!6259</a>]</li><li><code>(++) . unpackCString# ⇒ unpackAppendCString#</code> leading to a 15% reduction in compilation time on a specific example. <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6619" target="_blank" rel="noopener noreferrer">!6619</a>]</li><li>Compute SDoc literal size at compilation time <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19266" target="_blank" rel="noopener noreferrer">#19266</a>, <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4901" target="_blank" rel="noopener noreferrer">!4901</a>]</li></ul></li><li>Fix for Dwarf strings generated by the NCG that were unnecessarily retained in the FastString table <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6621" target="_blank" rel="noopener noreferrer">!6621</a>]</li><li>Worked on improving inlining heuristics by taking into account applied constructors at call sites <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20516" target="_blank" rel="noopener noreferrer">#20516</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6732" target="_blank" rel="noopener noreferrer">!6732</a>]<!-- -->. More work is needed though.</li><li>Fixed <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20857" target="_blank" rel="noopener noreferrer">#20857</a> by making the Id cache for primops used more often <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7241" target="_blank" rel="noopener noreferrer">!7241</a>]</li><li>Replaced some avoidable uses of <code>replicateM . length</code> with more efficient code <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7198" target="_blank" rel="noopener noreferrer">!7198</a>]<!-- -->. No performance gain this time but the next reader of this code won’t have to wonder if fixing it could improve performance.</li><li>Made <code>exprIsCheapX</code> inline for modest but easy perf improvements <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7183" target="_blank" rel="noopener noreferrer">!7183</a>]</li><li>Removed an allocation in the code used to write text on a Handle (used by putStrLn, etc.) <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7160" target="_blank" rel="noopener noreferrer">!7160</a>]</li><li>Replaced inefficient list operations with more efficient <code>Monoid ([a],[b])</code> operations in the driver <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7069" target="_blank" rel="noopener noreferrer">!7069</a>]<!-- -->, leading to 1.9% reduction in compiler allocations in MultiLayerModules test.</li><li>Disabled some callstack allocations in non-debug builds <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6252/" target="_blank" rel="noopener noreferrer">!6252</a>]</li><li>Made file copy in GHC more efficient <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5801" target="_blank" rel="noopener noreferrer">!5801</a>]</li><li>Miscellaneous pretty-printer enhancements <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5226" target="_blank" rel="noopener noreferrer">!5226</a>]</li><li>Type tidying perf improvements with strictness <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/14738" target="_blank" rel="noopener noreferrer">#14738</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4892" target="_blank" rel="noopener noreferrer">!4892</a>]</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="rts">RTS<a class="hash-link" href="#rts" title="Direct link to heading">​</a></h2><ul><li>Fixed issues related to the RTS’s ticker<ul><li>Fixed some races <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/18033" target="_blank" rel="noopener noreferrer">#18033</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20132" target="_blank" rel="noopener noreferrer">#20132</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6201" target="_blank" rel="noopener noreferrer">!6201</a>]</li><li>Made the RTS open the file descriptor for its timer (<code>timerfd</code>) on Linux synchronously to avoid weird interactions with Haskell code manipulating file descriptors <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20618" target="_blank" rel="noopener noreferrer">#20618</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6902" target="_blank" rel="noopener noreferrer">!6902</a>]<!-- -->.</li></ul></li><li>Moved GHC’s global variables used to manage Uniques into the RTS to fix plugin issues <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19940" target="_blank" rel="noopener noreferrer">#19940</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5900" target="_blank" rel="noopener noreferrer">!5900</a>]</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="build-system--ci">Build system / CI<a class="hash-link" href="#build-system--ci" title="Direct link to heading">​</a></h2><ul><li>Fixed Hadrian output to display warnings and errors after the multi screen long command lines <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20490" target="_blank" rel="noopener noreferrer">#20490</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/6690" target="_blank" rel="noopener noreferrer">!6690</a>]</li><li>Avoided the installation of a global <code>platformConstants</code> file; made GHC load constants from the RTS unit instead, allowing it to be reinstalled with different constants <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5427" target="_blank" rel="noopener noreferrer">!5427</a>]</li><li>Made <code>deriveConstants</code> output its file atomically <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/19684" target="_blank" rel="noopener noreferrer">#19684</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5520" target="_blank" rel="noopener noreferrer">!5520</a>]</li><li>Made compression with <code>xz</code> faster on CI <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/5066" target="_blank" rel="noopener noreferrer">!5066</a>]</li><li>Don’t build extra object with <code>-no-hs-main</code> <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/18938" target="_blank" rel="noopener noreferrer">#18938</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4974" target="_blank" rel="noopener noreferrer">!4974</a>]</li><li>Add <code>hi-boot</code> dependencies with <code>ghc -M</code> <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/14482" target="_blank" rel="noopener noreferrer">#14482</a>,<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4876" target="_blank" rel="noopener noreferrer">!4876</a>]</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="misc">Misc<a class="hash-link" href="#misc" title="Direct link to heading">​</a></h2><ul><li>Stack: fixed interface reading in <code>hi-file-parser</code> to support GHC 8.10 and 9.0 <!-- -->[<a href="https://github.com/commercialhaskell/hi-file-parser/pull/2" target="_blank" rel="noopener noreferrer">PR</a>, <a href="https://github.com/commercialhaskell/stack/issues/5134" target="_blank" rel="noopener noreferrer">Stack#5134</a>]</li><li>Enhanced pretty-printing of coercions in Core dumps <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/4856" target="_blank" rel="noopener noreferrer">!4856</a>]</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2022-03-01-haskell-nix-february-update">haskell.nix February Update</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-03-01T00:00:00.000Z" itemprop="datePublished">March 1, 2022</time> · <!-- -->2 min read</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_mojV" id="documentation">Documentation<a class="hash-link" href="#documentation" title="Direct link to heading">​</a></h2><ul><li>A tutorial has been added on <a href="https://outline.zw3rk.com/share/d461004d-1f2f-4d7a-95f2-4e20acb18cac" target="_blank" rel="noopener noreferrer">building DWARF-enabled executables</a> on linux systems.  There was also a related fix for building DWARF executables in a nix shell (<a href="https://github.com/input-output-hk/haskell.nix/pull/1385" target="_blank" rel="noopener noreferrer">#1385</a>)</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="changes">Changes<a class="hash-link" href="#changes" title="Direct link to heading">​</a></h2><ul><li>Support for external Hackage repositories was improved by <a href="https://github.com/input-output-hk/haskell.nix/pull/1370" target="_blank" rel="noopener noreferrer">#1370</a>. We can now use an extra package repository just by adding a <code>repository</code> block to the <code>cabal.project</code> file.  This makes it easy to make use of an extra hackage databases such as <a href="https://ghc.gitlab.haskell.org/head.hackage/" target="_blank" rel="noopener noreferrer">hackage.head</a> and <a href="https://github.com/input-output-hk/hackage-overlay-ghcjs" target="_blank" rel="noopener noreferrer">hackage-overlay-ghcjs</a>.  A <code>sha256</code> for the repository it can be added as a comment in the <code>repository</code> block or by including it in the <code>sha256map</code> argument.</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="version-updates">Version Updates<a class="hash-link" href="#version-updates" title="Direct link to heading">​</a></h2><ul><li>nix-tools was updated to use the Cabal 3.6.2 and hnix 0.16 <a href="https://github.com/input-output-hk/nix-tools/pull/113" target="_blank" rel="noopener noreferrer">nix-tools#113</a></li><li>Nixpkgs pins were bumped <a href="https://github.com/input-output-hk/haskell.nix/pull/1371" target="_blank" rel="noopener noreferrer">#1371</a></li><li>Update booting on aarch64 linux to ghc 8.8.4 <a href="https://github.com/input-output-hk/haskell.nix/pull/1325" target="_blank" rel="noopener noreferrer">1325</a> and <a href="https://github.com/input-output-hk/haskell.nix/pull/1374" target="_blank" rel="noopener noreferrer">1374</a></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="bug-fixes">Bug fixes<a class="hash-link" href="#bug-fixes" title="Direct link to heading">​</a></h2><ul><li>Allow linking pcre statically with musl <a href="https://github.com/input-output-hk/haskell.nix/pull/1363" target="_blank" rel="noopener noreferrer">#1363</a></li><li>Add gpiod to system nixpkgs map <a href="https://github.com/input-output-hk/haskell.nix/pull/1359" target="_blank" rel="noopener noreferrer">#1359</a></li><li>Add poppler-cpp to png-config Nixpkgs map <a href="https://github.com/input-output-hk/haskell.nix/pull/1373" target="_blank" rel="noopener noreferrer">#1373</a></li><li>Use the same logic that cabal-install uses for determining the path of a packages <code>.tar.gz</code> in a repository  <a href="https://github.com/input-output-hk/nix-tools/pull/114" target="_blank" rel="noopener noreferrer">nix-tools#114</a></li><li>Fix libnuma dependency in rts.conf <a href="https://github.com/input-output-hk/haskell.nix/commit/18ebf60137dd2ff1be7363eb46f67ebfa366d1dd" target="_blank" rel="noopener noreferrer">1342</a></li><li>Fix when &quot;materialized&quot; dir is deep <a href="https://github.com/input-output-hk/haskell.nix/pull/1376" target="_blank" rel="noopener noreferrer">#1376</a></li><li>Prefer local building for <code>git-ls-files</code> <a href="https://github.com/input-output-hk/haskell.nix/pull/1378" target="_blank" rel="noopener noreferrer">#1378</a> and <a href="https://github.com/input-output-hk/haskell.nix/issues/1381" target="_blank" rel="noopener noreferrer">#1381</a></li><li>Fix stack cache generator <code>sha256</code> is a string not a lambda <a href="https://github.com/input-output-hk/haskell.nix/pull/1383" target="_blank" rel="noopener noreferrer">#1383</a></li><li>Only pass <code>--index-state</code> to <code>cabal</code> when asked <a href="https://github.com/input-output-hk/haskell.nix/pull/1384" target="_blank" rel="noopener noreferrer">#1384</a></li><li>Pass <code>enableDWARF</code> to <code>makeConfigFiles</code> to fix <code>-g3</code> support in <code>nix-shell</code> <a href="https://github.com/input-output-hk/haskell.nix/pull/1385" target="_blank" rel="noopener noreferrer">#1385</a></li></ul><p>Finally, we’d like to thank all the awesome contributors, who make <code>haskell.nix</code> a thriving open source project! ❤️</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/nix">nix</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2022-02-01-ghc-january-2022-update">GHC January 2022 update</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-02-01T00:00:00.000Z" itemprop="datePublished">February 1, 2022</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Hopefully 2022 should be the year GHC will get a JavaScript backend without relying on GHCJS. This month the team has been busy planning the work that needs to be done to get there!</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="cross-compilation">Cross-compilation<a class="hash-link" href="#cross-compilation" title="Direct link to heading">​</a></h2><ul><li>GHCJS has been <a href="https://github.com/ghcjs/ghc/tree/ghc-8.10-ghcjs" target="_blank" rel="noopener noreferrer">updated</a> to reduce the gap with GHC 8.10.7 codebase to the point that GHC’s build system is used to build GHCJS</li><li>Internal work planning for the integration of GHCJS into GHC</li><li>A different approach to load plugins into cross-compilers has been implemented <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/20964" target="_blank" rel="noopener noreferrer">#20964</a>, <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7377" target="_blank" rel="noopener noreferrer">!7377</a>]</li><li>GHCJS has been exercised to showcase compilation of some Plutus applications</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="modularity">Modularity<a class="hash-link" href="#modularity" title="Direct link to heading">​</a></h2><ul><li>A few “subsystems” of GHC have been made more modular and reusable by making them independent of the command-line flags (<code>DynFlags</code>) <!-- -->[<a href="https://gitlab.haskell.org/ghc/ghc/-/issues/17957" target="_blank" rel="noopener noreferrer">#17957</a>, <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7158" target="_blank" rel="noopener noreferrer">!7158</a>, <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7199" target="_blank" rel="noopener noreferrer">!7199</a>, <a href="https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7325" target="_blank" rel="noopener noreferrer">!7325</a>]<!-- -->. This work resulted in a 10% reduction in call sites to <code>DynFlags</code> and has now removed all references to <code>DynFlags</code> up to the <code>CoreToStg</code> pass, which is almost the entire backend of GHC.</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="performance">Performance<a class="hash-link" href="#performance" title="Direct link to heading">​</a></h2><ul><li>Jeffrey wrote a new HF <a href="https://github.com/haskellfoundation/tech-proposals/pull/26" target="_blank" rel="noopener noreferrer">proposal</a> about writing a Haskell Optimization handbook and has started working on it</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc-update">ghc-update</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/2022-02-01-haskell-nix-january-update">haskell.nix January Update</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-02-01T00:00:00.000Z" itemprop="datePublished">February 1, 2022</time> · <!-- -->2 min read</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_mojV" id="january-2022"><strong>January 2022</strong><a class="hash-link" href="#january-2022" title="Direct link to heading">​</a></h2><p>This month we merged some very significant improvements to the support for compiling for Android and iOS based AArch64 devices.  When the build system is also AArch64 template haskell can often be run locally.  This will make targeting mobile devices from AArch64 builders much easier.</p><p>A long running branch containing bug fixes for cross compilation to JavaScript with GHCJS was merged.  One nice feature included is better support for adding bindings to C code compiled with emscripten.  In some cases it can be as easy as adding a single JavaScript file to the package with wrappers for the C functions.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="changes">Changes<a class="hash-link" href="#changes" title="Direct link to heading">​</a></h4><ul><li>Much improved AArch64 support including Template Haskell (#1316)</li><li>Improved GHCJS and support for calling C code compiled with emscripten (#1311)</li><li>The environment variables LANG and LOCALE_ARCHIVE are no longer set in shells allowing the users prefered settings to persist (#1341).</li><li>source-repo-override argument added for cabal projects to allow the location of source-repository-package packages to be replaced (#1354)</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="version-updates">Version Updates<a class="hash-link" href="#version-updates" title="Direct link to heading">​</a></h4><ul><li>GHC 9.0.2 was added to the available GHC versions (#1338)</li><li>The nixpkgs pins for 21.05, 21.11 and unstable were all updated (#1334).</li><li>Remaining uses of cabal 3.4 were updated to 3.6.2 (#1328)</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="bug-fixes">Bug fixes<a class="hash-link" href="#bug-fixes" title="Direct link to heading">​</a></h4><ul><li>Dwarf build of ghc 9.2.1 now skipped on hydra to work around 4GB hydra limit (#1333)</li><li>Removed use of propagatedBuildInputs in ghc derivation (#1318).</li><li>Caching of the check-hydra CI script was fixed (#1340)</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/nix">nix</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/page/3"><div class="pagination-nav__label">Newer Entries</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/iog_eng" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://iohk.io/en/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">IOG Blog</a></li><li class="footer__item"><a href="https://github.com/input-output-hk/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 IOG Engineering, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.70882d04.js"></script>
<script src="/assets/js/main.b2cdd8e8.js"></script>
</body>
</html>