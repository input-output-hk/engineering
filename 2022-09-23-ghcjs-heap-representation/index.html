<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<title data-react-helmet="true">GHCJS heap representation | IOG Engineering</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://engineering.iog.io/2022-09-23-ghcjs-heap-representation"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="GHCJS heap representation | IOG Engineering"><meta data-react-helmet="true" name="description" content="Introduction"><meta data-react-helmet="true" property="og:description" content="Introduction"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2022-09-23T00:00:00.000Z"><meta data-react-helmet="true" property="article:tag" content="ghc,javascript"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://engineering.iog.io/2022-09-23-ghcjs-heap-representation"><link data-react-helmet="true" rel="alternate" href="https://engineering.iog.io/2022-09-23-ghcjs-heap-representation" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://engineering.iog.io/2022-09-23-ghcjs-heap-representation" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.10ad4647.css">
<link rel="preload" href="/assets/js/runtime~main.2d1454a5.js" as="script">
<link rel="preload" href="/assets/js/main.dffb9c5e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/iohk-logo.png" alt="IOG" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/iohk-logo-inverted.png" alt="IOG" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Engineering</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Recent</a><a class="navbar__item navbar__link" href="/tags">Tags</a><a class="navbar__item navbar__link" href="/archive">Archive</a></div><div class="navbar__items navbar__items--right"><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-05-23-ghc-update">IOG GHC Update #29</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-05-02-ghc-update">IOG GHC Update #28</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-04-11-ghc-update">IOG GHC Update #27</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-03-21-ghc-update">IOG GHC Update #26</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-02-29-ghc-update">IOG GHC Update #25</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-02-08-ghc-update">IOG GHC Update #24</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-01-18-ghc-update">IOG GHC Update #23</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2024-01-04-ghc-update">IOG GHC Update #22</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-12-07-ghc-update">IOG GHC Update #21</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-11-16-ghc-update">IOG GHC Update #20</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-10-26-ghc-update">IOG GHC Update #19</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-10-25-internship">Internship in GHC at IOG</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-10-05-ghc-update">IOG GHC Update #18</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-09-14-ghc-update">IOG GHC Update #17</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-08-24-ghc-update">IOG GHC Update #16</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-08-03-ghc-update">IOG GHC Update #15</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-07-13-ghc-update">IOG GHC Update #14</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-06-29-ghc-update">IOG GHC Update #13</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-06-28-p2p">Unveiling Cardano&#x27;s Dynamic P2P: a leap forward in decentralization</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-06-15-ghc-update">IOG GHC Update #12</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_rzP5" itemprop="headline">GHCJS heap representation</h1><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-09-23T00:00:00.000Z" itemprop="datePublished">September 23, 2022</time> Â· <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_mojV" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">â€‹</a></h2><p>I recently gave a short presentation about heap objects representation in GHCJS and hence in the upcoming JS backend for GHC. This post is a summary of the content.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="heap-objects">Heap objects<a class="hash-link" href="#heap-objects" title="Direct link to heading">â€‹</a></h2><p>GHC implements Haskell code evaluation by using graph reduction. As such Haskell
programs compiled by GHC use the heap to store nodes of the graph to be
reduced and utility nodes participating in graph reduction. These nodes are:</p><ul><li>FUN: functions with their free variables as payload</li><li>THUNK: suspensions with their free variables as payload</li><li>PAP: partial application to a FUN. FUN closure and already applied arguments
as payload.</li><li>IND: indirection to another heap object</li><li>BLACKHOLE: used to overwrite a THUNK when it is being evaluated</li></ul><p>The heap is also used to store other values:</p><ul><li>CON: boxed values (saturated constructor applications) with field values as payload</li><li>Other unlifted values: TSO, BCO, arrays, MutVar#, MVar#, TVar#, stacks, stack frames...</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="info-tables">Info tables<a class="hash-link" href="#info-tables" title="Direct link to heading">â€‹</a></h2><p>Many heap objects share the same properties: e.g. all <code>Int</code> CON objects are
exactly the same except for their payload (the <code>Int#</code> value) that may be
different.
Hence heap objects are split in two parts to allow sharing of common properties:</p><ul><li>info table: statically known properties (at compilation time) that can be
shared by several heap objects</li><li>heap object itself: dynamically allocated in the heap</li></ul><p>Heap objects always have the same layout in the native code generated by GHC.
They are composed of:</p><ul><li>a pointer to an info table</li><li>some words of payload</li></ul><p>Heap traversal is done by following the info table pointer of every heap
object to query in the info table the layout of the heap object payload.</p><p>Info tables contain a pointer to a function called &quot;entry code&quot; that can be
specific to each info table. This code is mainly used to apply a node to some
arguments.
Note that with tables-next-to-code optimisation enabled, to avoid an
indirection the info table pointer is actually a pointer to this entry code and
the info table itself is stored in the words preceeding the entry code.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="heap-objects-in-javascript">Heap objects in JavaScript<a class="hash-link" href="#heap-objects-in-javascript" title="Direct link to heading">â€‹</a></h2><p>GHCJS represents most heap objects with a JavaScript object having the following
fields:</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> d1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> d2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> m</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cc </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>One question I had was: why don&#x27;t we use a JS array instead of a JS object?
Arrays should be faster than objects (i.e. hashmaps), no? It turns out that
objects like this are optimised by JS engines using &quot;hidden classes&quot; (see
<a href="https://v8.dev/blog/fast-properties" target="_blank" rel="noopener noreferrer">https://v8.dev/blog/fast-properties</a> for an explanation). That&#x27;s why
they are usually more efficient than arrays for which bound checking must be
made. Also arrays are larger in memory because they need to store their size.</p><p>Let&#x27;s now discuss the fields of the heap objects.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="f-field">f field<a class="hash-link" href="#f-field" title="Direct link to heading">â€‹</a></h3><p>&quot;f&quot; is the equivalent of the info table pointer. It contains a JavaScript
function that is the entry code for the heap object.</p><p>Similar to the tables-next-to-code optimisation discussed above, we use the
fact that JS functions are objects which have properties to store the info
table fields as properties of the function itself.</p><p>Example of an info table / entry function:</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token known-class-name class-name">Function</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> h$entry_function_xyz</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> t    </span><span class="token comment" style="color:#999988;font-style:italic">// (Int) object type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size </span><span class="token comment" style="color:#999988;font-style:italic">// (Int) number of fields in payload (-1 if variable layout)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i    </span><span class="token comment" style="color:#999988;font-style:italic">// (Array) fields layout (empty if variable layout)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n    </span><span class="token comment" style="color:#999988;font-style:italic">// (String) object name for debug</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> a    </span><span class="token comment" style="color:#999988;font-style:italic">// (Int) function arity or constructor tag</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> r    </span><span class="token comment" style="color:#999988;font-style:italic">// (Int) arity in number of JS variables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s    </span><span class="token comment" style="color:#999988;font-style:italic">// (Array) static refs that must be kept alive (SRT)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> m    </span><span class="token comment" style="color:#999988;font-style:italic">// GC mark</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="d1-d2-fields">d1, d2 fields<a class="hash-link" href="#d1-d2-fields" title="Direct link to heading">â€‹</a></h3><p>The d1 and d2 fields contain the payload of the heap object: constructor fields,
function free variables, etc.</p><p>Payloads can be composed of zero, one, or many fields. A naive solution would be
to have one JS object field (d1, d2, d3...) per payload field. However it would
be bad for two reasons:</p><ul><li><p>performance: JS engine hidden classes optimisation mentioned above needs
objects to have the same field structure.</p></li><li><p>genericity: we couldn&#x27;t write generic functions (e.g. to copy a closure)
without dynamically querying the number of fields composing the payload.</p></li></ul><p>Another solution would be to use a single field to store the whole payload. It
would fulfill the genericity constraint. However performance may not be good
because of the extra allocation of the object containing the payload and the
indirection to access its fields.</p><p>Instead GHCJS uses a middle ground approach: it always uses only two JS object
fields to store any number of payload fields. The following encoding is used to
stash any number of payload fields into two JS fields:</p><table><thead><tr><th>Payload</th><th>d1</th><th>d2</th></tr></thead><tbody><tr><td>[]</td><td>null</td><td>null</td></tr><tr><td>[a]</td><td>a</td><td>null</td></tr><tr><td>[a,b]</td><td>a</td><td>b</td></tr><tr><td>[a,b,c]</td><td>a</td><td>{d1=b,d2=c}</td></tr><tr><td>[a,b,c,d...]</td><td>a</td><td>{d1=b,d2=c,d3=d...}</td></tr></tbody></table><p>It still fulfills the genericity constraint and small objects (up to two fields
of payload) don&#x27;t pay for an extra allocation/indirection. The price to pay is
that two fields of payload are always allocated, even for for objects with 1
field of payload.</p><p>It would be interesting to benchmark the performance of the different payload
representations.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="m-field">m field<a class="hash-link" href="#m-field" title="Direct link to heading">â€‹</a></h3><p>The &quot;m&quot; field is used both for reachability checking (~ garbage collection) and
to implement the &quot;stable names&quot; features.</p><p>GHCJS can&#x27;t rely on the JS engine to know when a heap object is collected. So it
implements its own heap traversal algorithm for this. The &quot;m&quot; field is used as a
marker for this algorithm (it will be the topic of a future blog post).
In this case, the &quot;m&quot; field is a number (a GC mark).</p><p>When a StableName is created for an object, the &quot;m&quot; field of the object is
updated to point to the StableName object:</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">h$StableName</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> m </span><span class="token comment" style="color:#999988;font-style:italic">// GC mark</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s </span><span class="token comment" style="color:#999988;font-style:italic">// stable name unique id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The &quot;m&quot; field of the StableName object is used in replacement of the mark of the object.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cc-field">cc field<a class="hash-link" href="#cc-field" title="Direct link to heading">â€‹</a></h3><p>The &quot;cc&quot; field is the cost center associated to the heap object. This field is
only present when profiling mode is enabled. Cost centers are entered (pushed on
the cost center stack of the current thread) before the evaluation of thunks and
function applications.</p><p>Cost centers are allocated with the <code>h$CC</code> function.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="other-heap-object-representation">Other heap object representation<a class="hash-link" href="#other-heap-object-representation" title="Direct link to heading">â€‹</a></h2><p>The generic heap object representation presented above is only used for some
objects: those involved in graph reduction (e.g. updatable objects) and values
that don&#x27;t have a fixed layout (e.g. CON objects have different layouts
depending on which constructor they represent). The object layout allows generic
access to the infotable and to the payload, and the infotable describes the
object type and the payload layout.</p><p>Several other objects don&#x27;t need this machinery: they always have the same
layout and are never the result of a reduction (they are unlifted values). These
objects are represented as JS objects with any fields they need (i.e. not using
the d1/d2 encoding above). To determine the type of such heap objects, instead
of using the &quot;type&quot; field of an infotable the code uses the <code>instanceof</code>
operator. For example a TSO is represented as a <code>h$Thread</code> object.</p><p>Note that we could be tempted to give every heap object a different object name
and to always use <code>instanceof</code> instead of the infotable &quot;type&quot; properties. It
would mean adding <code>h$Con</code>, <code>h$Thunk</code>, <code>h$Fun</code>, <code>h$Pap</code>, <code>h$Blackhole</code>, and
<code>h$StackFrame</code> objects. Then all the heap objects could be treated in the same
way. However the isssue is that these objects need to be overwritable in place:
a Thunk becomes a Fun/Con/Pap/Blackhole, etc. As far as I know we can&#x27;t update
the &quot;instance&quot; of an object, so all these object have to be instances of
the same JS object.</p><p>Also note that the JS backend doesn&#x27;t need INDirection nodes because it can
always overwrite the fields of a JS object with the fields of another to update
a closure. For the record, indirection nodes are needed in backends that
layout closures as a chunk of bytes/words and when the size of the closure to
update is smaller than the size of the updatee closure.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="automatic-unboxing">Automatic unboxing<a class="hash-link" href="#automatic-unboxing" title="Direct link to heading">â€‹</a></h3><p>Sometimes the generic heap object representation is unnecessary. For example, a
boxed <code>Int</code> would be represented as a <code>CON</code> heap object with the <code>Int#</code> in its
payload, represented as a JavaScript number value. The only thing we can do with
this heap object is to pass it around and to extract its payload. As such, it is
more memory efficient to directly pass the payload (a JS number).</p><p>GHCJS provides an optimisation that consists in automatically unboxing some CON
heap objects. For example, Haskell booleans (True and False datacons) are
directly mapped to JavaScript booleans, boxed numbers (Float, Double, Int, Word,
Int8, etc.) are directly mapped to JavaScript numbers.</p><p>We can do this because JavaScript already provides some boxing of its own: we
can use the <code>typeof</code> operator on a heap object to know if it is a JS object, a
JS number, a JS boolean, etc. It makes it possible to distinguish between heap
object representations. In comparison, we can&#x27;t do this with the native (non-JS)
backend when we only have a pointer to a heap object: the pointer doesn&#x27;t carry
the kind of value it points to, hence the pointed memory location must be
generic enough for this introspection to be performed (e.g. using infotable
pointers).</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="summary">Summary<a class="hash-link" href="#summary" title="Direct link to heading">â€‹</a></h2><p>Heap object can be represented as JS values (number, boolean) because of the
automatic unboxing, or as JS objects: discimination is done with the <code>typeof</code>
operator.</p><p>Heap objects represented as JS objects come in two flavours:</p><ul><li>unlifted objects are represented with specific JS objects, disciminated with
the <code>instanceof</code> operator</li><li>other objects use the following generic and updatable structure:</li></ul><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> d1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> d2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> m</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">cc</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_h6_j"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/javascript">javascript</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/input-output-hk/engineering/tree/master/blog/2022-09-23-ghcjs-heap-representation.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/2022-09-28-introduce-q-d"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Model-Based Testing with QuickCheck</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/2022-08-18-js-backend-ffi"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">GHCJS FFI system in the JS Backend</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_cNA8 thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#heap-objects" class="table-of-contents__link toc-highlight">Heap objects</a></li><li><a href="#info-tables" class="table-of-contents__link toc-highlight">Info tables</a></li><li><a href="#heap-objects-in-javascript" class="table-of-contents__link toc-highlight">Heap objects in JavaScript</a><ul><li><a href="#f-field" class="table-of-contents__link toc-highlight">f field</a></li><li><a href="#d1-d2-fields" class="table-of-contents__link toc-highlight">d1, d2 fields</a></li><li><a href="#m-field" class="table-of-contents__link toc-highlight">m field</a></li><li><a href="#cc-field" class="table-of-contents__link toc-highlight">cc field</a></li></ul></li><li><a href="#other-heap-object-representation" class="table-of-contents__link toc-highlight">Other heap object representation</a><ul><li><a href="#automatic-unboxing" class="table-of-contents__link toc-highlight">Automatic unboxing</a></li></ul></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/iog_eng" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://iohk.io/en/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">IOG Blog</a></li><li class="footer__item"><a href="https://github.com/input-output-hk/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2024 IOG Engineering, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.2d1454a5.js"></script>
<script src="/assets/js/main.dffb9c5e.js"></script>
</body>
</html>