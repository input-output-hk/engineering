"use strict";(globalThis.webpackChunkengineering_iog_io=globalThis.webpackChunkengineering_iog_io||[]).push([[2882],{4929:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>g,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var n=r(8168),a=(r(6540),r(5680));const i={slug:"2022-09-23-ghcjs-heap-representation",title:"GHCJS heap representation",date:"September 23, 2022",authors:["sylvain"],tags:["ghc","javascript"]},o=void 0,l={permalink:"/2022-09-23-ghcjs-heap-representation",editUrl:"https://github.com/input-output-hk/engineering/tree/master/blog/2022-09-23-ghcjs-heap-representation.md",source:"@site/blog/2022-09-23-ghcjs-heap-representation.md",title:"GHCJS heap representation",description:"Introduction",date:"2022-09-23T00:00:00.000Z",formattedDate:"September 23, 2022",tags:[{label:"ghc",permalink:"/tags/ghc"},{label:"javascript",permalink:"/tags/javascript"}],readingTime:8.335,hasTruncateMarker:!0,authors:[{name:"Sylvain Henry",title:"Haskell DevX Engineer @ IOG",email:"sylvain.henry@iohk.io",key:"sylvain"}],frontMatter:{slug:"2022-09-23-ghcjs-heap-representation",title:"GHCJS heap representation",date:"September 23, 2022",authors:["sylvain"],tags:["ghc","javascript"]},prevItem:{title:"Model-Based Testing with QuickCheck",permalink:"/2022-09-28-introduce-q-d"},nextItem:{title:"GHCJS FFI system in the JS Backend",permalink:"/2022-08-18-js-backend-ffi"}},s={authorsImageUrls:[void 0]},p=[{value:"Introduction",id:"introduction",level:2},{value:"Heap objects",id:"heap-objects",level:2}],c={toc:p},u="wrapper";function g({components:e,...t}){return(0,a.yg)(u,(0,n.A)({},c,t,{components:e,mdxType:"MDXLayout"}),(0,a.yg)("h2",{id:"introduction"},"Introduction"),(0,a.yg)("p",null,"I recently gave a short presentation about heap objects representation in GHCJS and hence in the upcoming JS backend for GHC. This post is a summary of the content."),(0,a.yg)("h2",{id:"heap-objects"},"Heap objects"),(0,a.yg)("p",null,"GHC implements Haskell code evaluation by using graph reduction. As such Haskell\nprograms compiled by GHC use the heap to store nodes of the graph to be\nreduced and utility nodes participating in graph reduction. These nodes are:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"FUN: functions with their free variables as payload"),(0,a.yg)("li",{parentName:"ul"},"THUNK: suspensions with their free variables as payload"),(0,a.yg)("li",{parentName:"ul"},"PAP: partial application to a FUN. FUN closure and already applied arguments\nas payload."),(0,a.yg)("li",{parentName:"ul"},"IND: indirection to another heap object"),(0,a.yg)("li",{parentName:"ul"},"BLACKHOLE: used to overwrite a THUNK when it is being evaluated")),(0,a.yg)("p",null,"The heap is also used to store other values:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"CON: boxed values (saturated constructor applications) with field values as payload"),(0,a.yg)("li",{parentName:"ul"},"Other unlifted values: TSO, BCO, arrays, MutVar#, MVar#, TVar#, stacks, stack frames...")))}g.isMDXComponent=!0},5680:(e,t,r)=>{r.d(t,{xA:()=>c,yg:()=>d});var n=r(6540);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach(function(t){a(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function l(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=n.createContext({}),p=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},u="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef(function(e,t){var r=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(r),h=a,d=u["".concat(s,".").concat(h)]||u[h]||g[h]||i;return r?n.createElement(d,o(o({ref:t},c),{},{components:r})):n.createElement(d,o({ref:t},c))});function d(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=r.length,o=new Array(i);o[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:a,o[1]=l;for(var p=2;p<i;p++)o[p]=r[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}h.displayName="MDXCreateElement"}}]);