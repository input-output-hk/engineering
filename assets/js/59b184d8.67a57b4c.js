"use strict";(globalThis.webpackChunkengineering_iog_io=globalThis.webpackChunkengineering_iog_io||[]).push([[6570],{5680:(e,t,a)=>{a.d(t,{xA:()=>p,yg:()=>d});var r=a(6540);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach(function(t){n(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function l(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=r.createContext({}),g=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=g(e.components);return r.createElement(s.Provider,{value:t},e.children)},c="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef(function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=g(a),u=n,d=c["".concat(s,".").concat(u)]||c[u]||h[u]||i;return a?r.createElement(d,o(o({ref:t},p),{},{components:a})):r.createElement(d,o({ref:t},p))});function d(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,o=new Array(i);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:n,o[1]=l;for(var g=2;g<i;g++)o[g]=a[g];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}u.displayName="MDXCreateElement"},5860:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>g});var r=a(8168),n=(a(6540),a(5680));const i={slug:"2024-07-24-ghc-update",title:"IOG GHC Update #32",authors:["sylvain","doyougnu","luite"],tags:["ghc","ghc-update"]},o=void 0,l={permalink:"/2024-07-24-ghc-update",editUrl:"https://github.com/input-output-hk/engineering/tree/master/blog/2024-07-24-ghc-update-32.md",source:"@site/blog/2024-07-24-ghc-update-32.md",title:"IOG GHC Update #32",description:"Triweekly update from the GHC DevX team at IOG.",date:"2024-07-24T00:00:00.000Z",formattedDate:"July 24, 2024",tags:[{label:"ghc",permalink:"/tags/ghc"},{label:"ghc-update",permalink:"/tags/ghc-update"}],readingTime:1.305,hasTruncateMarker:!0,authors:[{name:"Sylvain Henry",title:"Haskell DevX Engineer @ IOG",email:"sylvain.henry@iohk.io",key:"sylvain"},{name:"Jeffrey M. Young",title:"Haskell DevX Engineer @ IOG",url:"https://iog.io/en/",key:"doyougnu"},{name:"Luite Stegeman",title:"Haskell DevX Engineer @ IOG",email:"luite.stegeman@iohk.io",key:"luite"}],frontMatter:{slug:"2024-07-24-ghc-update",title:"IOG GHC Update #32",authors:["sylvain","doyougnu","luite"],tags:["ghc","ghc-update"]},prevItem:{title:"IOG GHC Update #33",permalink:"/2024-08-15-ghc-update"},nextItem:{title:"IOG GHC Update #31",permalink:"/2024-07-08-ghc-update"}},s={authorsImageUrls:[void 0,void 0,void 0]},g=[{value:"High-level Summary",id:"high-level-summary",level:2},{value:"Details",id:"details",level:2}],p={toc:g},c="wrapper";function h({components:e,...t}){return(0,n.yg)(c,(0,r.A)({},p,t,{components:e,mdxType:"MDXLayout"}),(0,n.yg)("p",null,"Triweekly update from the GHC DevX team at IOG."),(0,n.yg)("p",null,"Previous updates can be found ",(0,n.yg)("a",{parentName:"p",href:"https://engineering.iog.io/tags/ghc-update"},"here"),"."),(0,n.yg)("h2",{id:"high-level-summary"},"High-level Summary"),(0,n.yg)("p",null,"The team is working on characterizing and upstreaming some GHC patches that are only present in haskell.nix-provided GHCs. The process isn't straightforward as some patches are too controversial to be upstreamed and some other need to be modified to be acceptable upstream (adding CPP for architecture independance, fixing documentation, etc.)."),(0,n.yg)("p",null,"The team is also helping update cardano-addresses to GHC JS backend (see ",(0,n.yg)("a",{parentName:"p",href:"https://github.com/IntersectMBO/cardano-addresses/pull/267"},"https://github.com/IntersectMBO/cardano-addresses/pull/267"),") and making progresses in upstreaming a new profiling method that we used to debug a performance regression in cardano-ledger."),(0,n.yg)("h2",{id:"details"},"Details"),(0,n.yg)("p",null,"Sylvain: fixed RTS linker on AArch64 to use the M32 allocator to avoid an excessive amount of calls to ",(0,n.yg)("inlineCode",{parentName:"p"},"mmap")," and fragmentation. See ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/24432"},"GHC#24432")," and ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/12914"},"GHC!12914"),". This was done in the process to update patches from haskell.nix to GHC upstream. This patch however is different from its haskell.nix counterpart which introduces a new allocator memory pool based allocator with different tradeoffs."),(0,n.yg)("p",null,"Sylvain: helped with debugging of performance issue in ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/25055"},"GHC#25055"),", which was fixed by Simon PJ in ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13038"},"GHC!13038"),".\nIn the process I've found another unrelated bug ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/25096"},"GHC#25096")," being fixed by Simon in ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13060"},"GHC!13060"),". Sadly the former bug doesn't explain the cardano-ledger performance regression we were investigating a few weeks ago. We'll check if the second one explains it when it will be fixed."),(0,n.yg)("p",null,"Luite: Worked on dynamic allocation of cost centre stacks to allow breaking down time and allocation profiles in more flexible ways. See ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/25098"},"GHC#25098"),"."),(0,n.yg)("p",null,"Jeff: haskell.nix patches triage and branch creation in ",(0,n.yg)("a",{parentName:"p",href:"https://github.com/stable-haskell/ghc/"},"https://github.com/stable-haskell/ghc/")," repository"))}h.isMDXComponent=!0}}]);