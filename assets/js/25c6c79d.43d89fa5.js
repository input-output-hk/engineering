"use strict";(globalThis.webpackChunkengineering_iog_io=globalThis.webpackChunkengineering_iog_io||[]).push([[4622],{5680:(e,t,a)=>{a.d(t,{xA:()=>g,yg:()=>m});var n=a(6540);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach(function(t){r(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},g=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},h="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef(function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,g=l(e,["components","mdxType","originalType","parentName"]),h=p(a),c=r,m=h["".concat(s,".").concat(c)]||h[c]||u[c]||i;return a?n.createElement(m,o(o({ref:t},g),{},{components:a})):n.createElement(m,o({ref:t},g))});function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[h]="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},7949:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var n=a(8168),r=(a(6540),a(5680));const i={slug:"2024-09-05-ghc-update",title:"IOG GHC Update #34",authors:["sylvain","doyougnu","luite"],tags:["ghc","ghc-update"]},o=void 0,l={permalink:"/2024-09-05-ghc-update",editUrl:"https://github.com/input-output-hk/engineering/tree/master/blog/2024-09-05-ghc-update-34.md",source:"@site/blog/2024-09-05-ghc-update-34.md",title:"IOG GHC Update #34",description:"Triweekly update from the GHC DevX team at IOG.",date:"2024-09-05T00:00:00.000Z",formattedDate:"September 5, 2024",tags:[{label:"ghc",permalink:"/tags/ghc"},{label:"ghc-update",permalink:"/tags/ghc-update"}],readingTime:2.44,hasTruncateMarker:!0,authors:[{name:"Sylvain Henry",title:"Haskell DevX Engineer @ IOG",email:"sylvain.henry@iohk.io",key:"sylvain"},{name:"Jeffrey M. Young",title:"Haskell DevX Engineer @ IOG",url:"https://iog.io/en/",key:"doyougnu"},{name:"Luite Stegeman",title:"Haskell DevX Engineer @ IOG",email:"luite.stegeman@iohk.io",key:"luite"}],frontMatter:{slug:"2024-09-05-ghc-update",title:"IOG GHC Update #34",authors:["sylvain","doyougnu","luite"],tags:["ghc","ghc-update"]},prevItem:{title:"IOG GHC Update #35",permalink:"/2024-09-26-ghc-update"},nextItem:{title:"IOG GHC Update #33",permalink:"/2024-08-15-ghc-update"}},s={authorsImageUrls:[void 0,void 0,void 0]},p=[{value:"High-level Summary",id:"high-level-summary",level:2},{value:"Details",id:"details",level:2}],g={toc:p},h="wrapper";function u({components:e,...t}){return(0,r.yg)(h,(0,n.A)({},g,t,{components:e,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"Triweekly update from the GHC DevX team at IOG."),(0,r.yg)("p",null,"Previous updates can be found ",(0,r.yg)("a",{parentName:"p",href:"https://engineering.iog.io/tags/ghc-update"},"here"),"."),(0,r.yg)("h2",{id:"high-level-summary"},"High-level Summary"),(0,r.yg)("p",null,"Some people from Input Output are attending ICFP and Haskell Symposium in Milan, including Luite from the GHC team. If you are there, come to the Input Output table and talk with James Chapman, Kevin Hammond or Luite Stegeman."),(0,r.yg)("h2",{id:"details"},"Details"),(0,r.yg)("p",null,"Sylvain: opened merge requests backporting patches to GHC 9.8 and GHC 9.10 that we need to build Cardano. Broken STM package in GHC 9.8.2 (",(0,r.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/25171"},"GHC#25171"),", ",(0,r.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13163"},"GHC!13163"),"); CoreToSTG error in 9.10 (",(0,r.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/25033"},"GHC#25033"),", ",(0,r.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13162"},"GHC!13162"),")."),(0,r.yg)("p",null,"Sylvain: opened a merge request to upstream a patch from haskell.nix adding support for extra symbols in the RTS linker to use with the external interpreter when cross-compiling. Added documentation and a test. ",(0,r.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/25155"},"GHC#25155")," and ",(0,r.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13129"},"GHC!13129"),"."),(0,r.yg)("p",null,"Jeff and Sylvain: opened a merge request to upstream a patch from haskell.nix adding some support for hidden symbols in the RTS linker for ELF binaries. Added a test. ",(0,r.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/25191"},"GHC#25191")," and ",(0,r.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13013"},"GHC!13013"),"."),(0,r.yg)("p",null,"Jeff: published the ",(0,r.yg)("a",{parentName:"p",href:"https://haskell.foundation/hs-opt-handbook.github.io/"},"philosophies of optimization")," chapter of the Haskell Optimization Handbook."),(0,r.yg)("p",null,"Jeff: investigated an error with the ",(0,r.yg)("inlineCode",{parentName:"p"},"entropy")," package in nixpkgs. This turned out to be a ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/NixOS/nixpkgs/issues/337996"},"non-issue"),"."),(0,r.yg)("p",null,"Sylvain: ",(0,r.yg)("inlineCode",{parentName:"p"},"ghc-up")," ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/haskus/packages/issues/62"},"failed to build")," with the latest release of my ",(0,r.yg)("inlineCode",{parentName:"p"},"haskus-utils-variant")," package because I forgot to make a new release of one of its dependencies (",(0,r.yg)("inlineCode",{parentName:"p"},"haskus-utils-data"),"). Managing several packages like this is a pain so I've released a new ",(0,r.yg)("a",{parentName:"p",href:"https://hackage.haskell.org/package/variant"},(0,r.yg)("inlineCode",{parentName:"a"},"variant")," package")," which has minimal dependencies. I've implemented compatibility and added CI for GHC releases from 8.10 to 9.10 so it has become a much more reliable package to depend on."),(0,r.yg)("p",null,"Sylvain: GHC's JS backend was failing when compiling ",(0,r.yg)("inlineCode",{parentName:"p"},"statistics")," package ",(0,r.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/25177"},"GHC#25177"),". This was due to the case of rubbish-literals not be properly handled in the generation of statically allocated literals. Fixing it was easy but making a reproducing test case was more involved. See ",(0,r.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13151"},"GHC!13151"),"."),(0,r.yg)("p",null,"Sylvain: refactored GHC's linker code (on the Haskell side, not in the RTS) to add documentation and better types (",(0,r.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13142"},"GHC!13142"),"). This was done in preparation for a fix for ",(0,r.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/24886"},"GHC#24886")," which will likely require merging some the JS linker code with the native linker code. For now they are still totally different code paths."),(0,r.yg)("p",null,"Sylvain: upgrading GHC to use a new release of ",(0,r.yg)("inlineCode",{parentName:"p"},"directory")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"file-io")," failed because the JS backend offered partial or no support for some POSIX functions: ",(0,r.yg)("inlineCode",{parentName:"p"},"openat"),", ",(0,r.yg)("inlineCode",{parentName:"p"},"unlinkat"),", ",(0,r.yg)("inlineCode",{parentName:"p"},"fstatat"),", ",(0,r.yg)("inlineCode",{parentName:"p"},"dup"),"... Sadly there is no NodeJS API for those functions and there doesn't seem to be a plan to implement them. Emscripten (C to JS compiler) implements these functions by maintaining a mapping table between file descriptors and file paths, which is a hack because there is no guarantee that a file path still corresponds to a given file descriptor (that's the whole point of these \"new\" ",(0,r.yg)("inlineCode",{parentName:"p"},"*at")," functions). I've implemented a fix using another less invasive hack but that probably only works on Linux for now. See ",(0,r.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/25190"},"GHC#25190"),", ",(0,r.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/13122/diffs?commit_id=a300f12c93f7ea74f8d269bf300e37fb4ffb2b6e"},"GHC!13122"),"."),(0,r.yg)("p",null,"Luite: prepared communication materials for ICFP (poster, flyers)"))}u.isMDXComponent=!0}}]);