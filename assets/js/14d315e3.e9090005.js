"use strict";(globalThis.webpackChunkengineering_iog_io=globalThis.webpackChunkengineering_iog_io||[]).push([[6705],{5680:(e,t,a)=>{a.d(t,{xA:()=>s,yg:()=>g});var n=a(6540);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach(function(t){i(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function o(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var u=n.createContext({}),p=function(e){var t=n.useContext(u),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},s=function(e){var t=p(e.components);return n.createElement(u.Provider,{value:t},e.children)},h="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef(function(e,t){var a=e.components,i=e.mdxType,l=e.originalType,u=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),h=p(a),c=i,g=h["".concat(u,".").concat(c)]||h[c]||m[c]||l;return a?n.createElement(g,r(r({ref:t},s),{},{components:a})):n.createElement(g,r({ref:t},s))});function g(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var l=a.length,r=new Array(l);r[0]=c;var o={};for(var u in t)hasOwnProperty.call(t,u)&&(o[u]=t[u]);o.originalType=e,o[h]="string"==typeof e?e:i,r[1]=o;for(var p=2;p<l;p++)r[p]=a[p];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},8100:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>r,default:()=>m,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var n=a(8168),i=(a(6540),a(5680));const l={slug:"2022-04-08-haskell-nix-march-update",title:"haskell.nix March Update",authors:[],tags:["nix"],custom_edit_url:null},r=void 0,o={permalink:"/2022-04-08-haskell-nix-march-update",editUrl:"https://github.com/input-output-hk/engineering/tree/master/blog/2022-04-08-haskell-nix-march-update-XOLP1OBCuw-import.md",source:"@site/blog/2022-04-08-haskell-nix-march-update-XOLP1OBCuw-import.md",title:"haskell.nix March Update",description:"Changes",date:"2022-04-08T00:00:00.000Z",formattedDate:"April 8, 2022",tags:[{label:"nix",permalink:"/tags/nix"}],readingTime:1.99,hasTruncateMarker:!1,authors:[],frontMatter:{slug:"2022-04-08-haskell-nix-march-update",title:"haskell.nix March Update",authors:[],tags:["nix"],custom_edit_url:null},prevItem:{title:"GHC March 2022 Update",permalink:"/2022-04-19-ghc-march-2022-update"},nextItem:{title:"GHC February 2022 Update",permalink:"/2022-03-09-ghc-february-2022-update"}},u={authorsImageUrls:[]},p=[{value:"Changes",id:"changes",level:2},{value:"Version Updates",id:"version-updates",level:2},{value:"Bug fixes",id:"bug-fixes",level:2}],s={toc:p},h="wrapper";function m({components:e,...t}){return(0,i.yg)(h,(0,n.A)({},s,t,{components:e,mdxType:"MDXLayout"}),(0,i.yg)("h2",{id:"changes"},"Changes"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"To cross compile Haskell code for windows a ",(0,i.yg)("inlineCode",{parentName:"li"},"wine")," process must be used to evaluate Template Haskell code at compile time.  Some times this code needs DLLs to be present for the Template Haskell code to run.  We had been maintaining a list of DLLs manually (",(0,i.yg)("a",{parentName:"li",href:"https://github.com/input-output-hk/haskell.nix/pull/1400"},"#1400")," for instance added ",(0,i.yg)("inlineCode",{parentName:"li"},"secp256k1"),").  A more general solution (",(0,i.yg)("a",{parentName:"li",href:"https://github.com/input-output-hk/haskell.nix/pull/1405"},"#1405"),") was found that uses the ",(0,i.yg)("inlineCode",{parentName:"li"},"pkgsHostTarget")," environment variable to obtain a list of all the packages dependencies.  Then the DLLs from the are made available to the ",(0,i.yg)("inlineCode",{parentName:"li"},"wine")," process running the Template Haskell code.  This should make more libraries build correctly while reducing unnecessary dependencies."),(0,i.yg)("li",{parentName:"ul"},"The way Haskell.nix cleans source trees has changed with ",(0,i.yg)("a",{parentName:"li",href:"https://github.com/input-output-hk/haskell.nix/pull/1403"},"#1403"),", ",(0,i.yg)("a",{parentName:"li",href:"https://github.com/input-output-hk/haskell.nix/pull/1409"},"#1409")," and ",(0,i.yg)("a",{parentName:"li",href:"https://github.com/input-output-hk/haskell.nix/pull/1418"},"#1418"),".  When using Nix ",(0,i.yg)("inlineCode",{parentName:"li"},">=2.4")," source in the store is now filtered in the same way it is locally.  This has a couple of key advantages:",(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"It makes it less likely that results on CI systems (where the source is likely to be in the store) will differ from results for local builds (where the source is in a cloned git repository)."),(0,i.yg)("li",{parentName:"ul"},"Potential for reducing load on CI.  Although more work may be needed, this kind of filtering combined with the experimental content addressing features of Nix reduce the required rebuilds."))),(0,i.yg)("li",{parentName:"ul"},"In the past rather cryptic error messages were given when an attempt was made to use an old version of GHC on a platform Haskell.nix did not support it.  In some cases Haskell.nix would even attempt to build GHC and only fail after some time.  Better error messages are now given right away when an attempt is made to use a GHC version that is not supported for a particular platform ",(0,i.yg)("a",{parentName:"li",href:"https://github.com/input-output-hk/haskell.nix/pull/1411"},"#1411"))),(0,i.yg)("h2",{id:"version-updates"},"Version Updates"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"GHC 9.2.2 was added ",(0,i.yg)("a",{parentName:"li",href:"https://github.com/input-output-hk/haskell.nix/pull/1394"},"#1394"))),(0,i.yg)("h2",{id:"bug-fixes"},"Bug fixes"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"gitMinimal")," replaces ",(0,i.yg)("inlineCode",{parentName:"li"},"git")," to reduce the dependency tree of ",(0,i.yg)("inlineCode",{parentName:"li"},"cabalProject")," functions ",(0,i.yg)("a",{parentName:"li",href:"https://github.com/input-output-hk/haskell.nix/pull/1387"},"#1387")),(0,i.yg)("li",{parentName:"ul"},"Less used of ",(0,i.yg)("inlineCode",{parentName:"li"},"allowSubstitutes=false")," ",(0,i.yg)("a",{parentName:"li",href:"https://github.com/input-output-hk/haskell.nix/pull/1389"},"#1389")),(0,i.yg)("li",{parentName:"ul"},"Fixed ",(0,i.yg)("inlineCode",{parentName:"li"},"aarch64-linux")," builds by using correct boot compiler ",(0,i.yg)("a",{parentName:"li",href:"https://github.com/input-output-hk/haskell.nix/pull/1390"},"#1390")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"icu-i18n")," package mapping added to make ",(0,i.yg)("inlineCode",{parentName:"li"},"text-icu")," build ",(0,i.yg)("a",{parentName:"li",href:"https://github.com/input-output-hk/haskell.nix/pull/1395"},"#1395")),(0,i.yg)("li",{parentName:"ul"},"Fixes needed for newer ",(0,i.yg)("inlineCode",{parentName:"li"},"nixpkgs")," versions",(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"Use list for ",(0,i.yg)("inlineCode",{parentName:"li"},"configureFlags")," ",(0,i.yg)("a",{parentName:"li",href:"https://github.com/input-output-hk/haskell.nix/pull/1396"},"#1396")),(0,i.yg)("li",{parentName:"ul"},"The spdx json file is in a ",(0,i.yg)("inlineCode",{parentName:"li"},".json")," output ",(0,i.yg)("a",{parentName:"li",href:"https://github.com/input-output-hk/haskell.nix/pull/1397"},"#1397")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"gdk_pixbuf")," is now ",(0,i.yg)("inlineCode",{parentName:"li"},"gdk-pixbuf")," ",(0,i.yg)("a",{parentName:"li",href:"https://github.com/input-output-hk/haskell.nix/pull/1398"},"#1398")))),(0,i.yg)("li",{parentName:"ul"},"Replaced deprecated NixOS binary cache settings in docs ",(0,i.yg)("a",{parentName:"li",href:"https://github.com/input-output-hk/haskell.nix/pull/1410"},"#1410")),(0,i.yg)("li",{parentName:"ul"},"Enable static build of ",(0,i.yg)("inlineCode",{parentName:"li"},"secp256k1")," on musl ",(0,i.yg)("a",{parentName:"li",href:"https://github.com/input-output-hk/haskell.nix/pull/1413"},"#1413"))),(0,i.yg)("p",null,"Finally, we\u2019d like to thank all the awesome contributors, who make\xa0",(0,i.yg)("inlineCode",{parentName:"p"},"haskell.nix"),"\xa0a thriving open source project!\xa0\u2764\ufe0f"))}m.isMDXComponent=!0}}]);