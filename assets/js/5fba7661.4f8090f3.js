"use strict";(globalThis.webpackChunkengineering_iog_io=globalThis.webpackChunkengineering_iog_io||[]).push([[3793],{5680:(e,t,a)=>{a.d(t,{xA:()=>s,yg:()=>d});var r=a(6540);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach(function(t){n(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function o(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var p=r.createContext({}),g=function(e){var t=r.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},s=function(e){var t=g(e.components);return r.createElement(p.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef(function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,p=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),c=g(a),h=n,d=c["".concat(p,".").concat(h)]||c[h]||u[h]||i;return a?r.createElement(d,l(l({ref:t},s),{},{components:a})):r.createElement(d,l({ref:t},s))});function d(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,l=new Array(i);l[0]=h;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[c]="string"==typeof e?e:n,l[1]=o;for(var g=2;g<i;g++)l[g]=a[g];return r.createElement.apply(null,l)}return r.createElement.apply(null,a)}h.displayName="MDXCreateElement"},8160:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>g});var r=a(8168),n=(a(6540),a(5680));const i={slug:"2023-05-18-ghc-update",title:"IOG GHC Update #10",authors:["sylvain","doyougnu","luite","josh","bartek"],tags:["ghc","ghc-update"]},l=void 0,o={permalink:"/2023-05-18-ghc-update",editUrl:"https://github.com/input-output-hk/engineering/tree/master/blog/2023-05-18-ghc-update-10.md",source:"@site/blog/2023-05-18-ghc-update-10.md",title:"IOG GHC Update #10",description:"Biweekly update from the GHC DevX team at IOG.",date:"2023-05-18T00:00:00.000Z",formattedDate:"May 18, 2023",tags:[{label:"ghc",permalink:"/tags/ghc"},{label:"ghc-update",permalink:"/tags/ghc-update"}],readingTime:1.76,hasTruncateMarker:!0,authors:[{name:"Sylvain Henry",title:"Haskell DevX Engineer @ IOG",email:"sylvain.henry@iohk.io",key:"sylvain"},{name:"Jeffrey M. Young",title:"Haskell DevX Engineer @ IOG",url:"https://iog.io/en/",key:"doyougnu"},{name:"Luite Stegeman",title:"Haskell DevX Engineer @ IOG",email:"luite.stegeman@iohk.io",key:"luite"},{name:"Joshua Meredith",title:"Haskell DevX Engineer @ IOG",url:"https://iog.io/en/",key:"josh"},{name:"Bart\u0142omiej Cie\u015blar",title:"Haskell DevX Intern @ IOG",email:"bartlomiej.cieslar@iohk.io",key:"bartek"}],frontMatter:{slug:"2023-05-18-ghc-update",title:"IOG GHC Update #10",authors:["sylvain","doyougnu","luite","josh","bartek"],tags:["ghc","ghc-update"]},prevItem:{title:"IOG GHC Update #11",permalink:"/2023-06-01-ghc-update"},nextItem:{title:"IOG GHC Update #9",permalink:"/2023-05-04-ghc-update"}},p={authorsImageUrls:[void 0,void 0,void 0,void 0,void 0]},g=[{value:"JavaScript backend",id:"javascript-backend",level:2},{value:"Deprecation warnings",id:"deprecation-warnings",level:2},{value:"Performance",id:"performance",level:2},{value:"Linker",id:"linker",level:2},{value:"Misc.",id:"misc",level:2}],s={toc:g},c="wrapper";function u({components:e,...t}){return(0,n.yg)(c,(0,r.A)({},s,t,{components:e,mdxType:"MDXLayout"}),(0,n.yg)("p",null,"Biweekly update from the GHC DevX team at IOG."),(0,n.yg)("p",null,"Previous updates can be found ",(0,n.yg)("a",{parentName:"p",href:"https://engineering.iog.io/tags/ghc-update"},"here"),"."),(0,n.yg)("h2",{id:"javascript-backend"},"JavaScript backend"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Josh: Merged a port of ",(0,n.yg)("inlineCode",{parentName:"p"},"clock_gettime")," from GHCJS into the JavaScript backend. This\nfunction is required by some Cabal ",(0,n.yg)("inlineCode",{parentName:"p"},"Setup.hs")," programs, so this brings us closer to\nfull Cabal functionality, as well as Unix parity.\nSee ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10396"},"GHC!10396"))),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Luite: Ported the patch to support the ",(0,n.yg)("inlineCode",{parentName:"p"},"process")," package in the GHC JavaScript\nbackend from GHCJS. The old code was never fully tested and only intended to support\nCabal, so there is missing functionality and error reporting is lacking. Work is\nnow on the way to bring it up to level where it can be merged in the ",(0,n.yg)("inlineCode",{parentName:"p"},"process")," package.")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Luite: Looked into the test failures for the JavaScript specific weak references.\nIt turned out to be caused by messing deadlock detection. Experimented with making\nthe JavaScript storage manager (",(0,n.yg)("inlineCode",{parentName:"p"},"FinalizationRegistry"),") work for deadlock detection,add\nbut it requires signifcant changes to the representation of ",(0,n.yg)("inlineCode",{parentName:"p"},"ThreadId#")," in the Haskell\ncode. For GHC 9.8 we will most likely document that deadlocks are not guaranteed to\nbe detected with the JavaScript backend, and give the user the option to manually run\nfull deadlock detection (heap scan) if desired.")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Sylvain: fixed support for the ",(0,n.yg)("inlineCode",{parentName:"p"},"ghcjs_HOST_OS")," CPP conditional.\nSee ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/23346"},"GHC#22346"),"\nand ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10430"},"GHC!10430"),".")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Sylvain: fixed ",(0,n.yg)("inlineCode",{parentName:"p"},"getpid"),". See ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/23399"},"GHC#23399")," and ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10454"},"GHC!10454"),"."))),(0,n.yg)("h2",{id:"deprecation-warnings"},"Deprecation warnings"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Bartek: changed the way warning reporting from addUsedGRE was done from artificially removing all warning categories from dynflags to an explicit argument\nSee ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10414"},"GHC!10414"))),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Bartek: almost finished the deprecated exports proposal, a bug left to fix in backpack\nSee ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10283"},"GHC!10283")))),(0,n.yg)("h2",{id:"performance"},"Performance"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Josh: Merged improvements to the implementation of handle encoders after approval of\nthe CLC. By manually unboxing functions stored in the ",(0,n.yg)("inlineCode",{parentName:"li"},"CodeBuffer")," record, the\nallocations caused by allocations are reduced by ~20%, and general GHC usage is also\nslightly improved.\nSee ",(0,n.yg)("a",{parentName:"li",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9948"},"GHC!9948"),"\nand ",(0,n.yg)("a",{parentName:"li",href:"https://gitlab.haskell.org/ghc/ghc/-/jobs/1514795#L6775"},"CI Performance Tests"))),(0,n.yg)("h2",{id:"linker"},"Linker"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Sylvain: backported fix for ",(0,n.yg)("a",{parentName:"li",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/19421"},"GHC#19421")," (",(0,n.yg)("inlineCode",{parentName:"li"},"internal error: m32_allocator_init: Failed to map"),") to 9.2. See ",(0,n.yg)("a",{parentName:"li",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10453"},"GHC!10453"))),(0,n.yg)("h2",{id:"misc"},"Misc."),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Jeff: First draft of the ",(0,n.yg)("a",{parentName:"li",href:"https://hsyl20.fr/home/files/papers/2022-ghc-modularity.pdf"},"GHC Modularity")," FUNARCH paper is complete.")))}u.isMDXComponent=!0}}]);