"use strict";(globalThis.webpackChunkengineering_iog_io=globalThis.webpackChunkengineering_iog_io||[]).push([[9745],{1955:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var a=n(8168),r=(n(6540),n(5680));const i={slug:"2022-06-01-ghc-update",title:"GHC DevX May 2022 Update",authors:["sylvain"],tags:["ghc","ghc-update"]},o=void 0,l={permalink:"/2022-06-01-ghc-update",editUrl:"https://github.com/input-output-hk/engineering/tree/master/blog/2022-06-01-ghc-update-2022-05.md",source:"@site/blog/2022-06-01-ghc-update-2022-05.md",title:"GHC DevX May 2022 Update",description:"This is the May 2022 monthly update from the GHC DevX team at IOG.",date:"2022-06-01T00:00:00.000Z",formattedDate:"June 1, 2022",tags:[{label:"ghc",permalink:"/tags/ghc"},{label:"ghc-update",permalink:"/tags/ghc-update"}],readingTime:2.61,hasTruncateMarker:!1,authors:[{name:"Sylvain Henry",title:"Haskell DevX Engineer @ IOG",email:"sylvain.henry@iohk.io",key:"sylvain"}],frontMatter:{slug:"2022-06-01-ghc-update",title:"GHC DevX May 2022 Update",authors:["sylvain"],tags:["ghc","ghc-update"]},prevItem:{title:"GHC DevX June 2022 Update",permalink:"/2022-07-01-ghc-update"},nextItem:{title:"Objectable vs GHC Binary",permalink:"/2022/05/24/april-GHCJS-Objectable-vs-GHC-Binary"}},s={authorsImageUrls:[void 0]},p=[{value:"JavaScript Backend for GHC",id:"javascript-backend-for-ghc",level:2},{value:"External Static Plugins",id:"external-static-plugins",level:2},{value:"Blog posts",id:"blog-posts",level:2},{value:"Haskell Optimization Handbook",id:"haskell-optimization-handbook",level:2}],g={toc:p},c="wrapper";function u({components:e,...t}){return(0,r.yg)(c,(0,a.A)({},g,t,{components:e,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"This is the May 2022 monthly update from the GHC DevX team at IOG."),(0,r.yg)("h2",{id:"javascript-backend-for-ghc"},"JavaScript Backend for GHC"),(0,r.yg)("p",null,'For a few months we have been merging GHCJS (Haskell to JavaScript compiler) into GHC.\nWe set our first milestone to be the ability to compile and to run the usual "Hello World" program.\nIt turned out to be much more involved than we initially thought (requiring FFI support, etc.), but we should be getting there soon.'),(0,r.yg)("p",null,"This month we have made the following progress:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"RTS"),": we have modified Hadrian and ",(0,r.yg)("inlineCode",{parentName:"p"},"rts.cabal")," in order to build a valid\nnative ",(0,r.yg)("inlineCode",{parentName:"p"},"rts")," unit that GHC can use, in particular containing appropriate\nheader files.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"linker"),": the JS linker has been hooked up with GHC's driver.\nWe fixed several panics in the linker due to erroneous symbol generation code.\nThese bugs were introduced while porting the code from the old 8.10 pretty-printing infrastructure to the newer one.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"boot libraries"),": the JS backend can now build and link all the boot libraries.\nNote that we are not claiming that they are all usable yet. In particular complete FFI support is lacking, but the JS backend Hadrian build completes and so we can start using the produced JS cross-compiler.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"levity polymorphism"),": building ",(0,r.yg)("inlineCode",{parentName:"p"},"ghc-prim")," uncovered a lurking bug related to\nlevity polymorphism. It wasn't noticed in GHCJS 8.10 because it is also\nrelated to the ",(0,r.yg)("inlineCode",{parentName:"p"},"BoxedRep")," proposal that introduced a constructor application\nin a commonly used ",(0,r.yg)("inlineCode",{parentName:"p"},"RuntimeRep"),".")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"sized literals"),": support for new sized literals have been added to the code\ngenerator."))),(0,r.yg)("p",null,"Now that have achieved a build process that actually produces a JS cross compiler, we are confronting and fixing issues in the produced JavaScript code, such as adding, managing, and debugging CPP conditional compilation blocks in JS shim files. You can follow our progress on our development branch ",(0,r.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/tree/wip/js-staging"},"here"),"."),(0,r.yg)("h2",{id:"external-static-plugins"},"External Static Plugins"),(0,r.yg)("p",null,"GHC doesn't support plugins in cross-compilers ",(0,r.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/14335"},"#14335"),'.\nSome time ago, we came up with a solution called "external static plugins" ',(0,r.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/7377"},"!7377"),".\nThese are plugins that are directly loaded from shared libaries, bypassing the issue with usual plugins."),(0,r.yg)("p",null,"Our colleague Shea Levy confirmed that the approach works, backported it to GHC 8.10, and has been working on making it work in stage1 cross-compilers for Windows.\nKudos for this work, Shea."),(0,r.yg)("p",null,"As the current user-interface based on environment variables isn't convenient, we have been working on adding new command-line flags to GHC instead.\nWe expect to propose this for integration into GHC when the new interface will be fully implemented."),(0,r.yg)("h2",{id:"blog-posts"},"Blog posts"),(0,r.yg)("p",null,"Inspired by our friends and colleagues at Well-Typed and Tweag, we have been starting to write blog posts for IOG's engineering blog.\nThey will mostly be about stuff we are working on or that we are interested in.\nFeel free to send us feedback about these posts and to send us topics you would be interested to read about."),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://engineering.iog.io/2022-04-28-on-the-inlining-of-integer-and-natural-operations"},"https://engineering.iog.io/2022-04-28-on-the-inlining-of-integer-and-natural-operations")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://engineering.iog.io/2022-05-02-setup-ext-stg-interp"},"https://engineering.iog.io/2022-05-02-setup-ext-stg-interp")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://engineering.iog.io/2022-05-17-javascript-template-haskell-external-interpreter"},"https://engineering.iog.io/2022-05-17-javascript-template-haskell-external-interpreter"))),(0,r.yg)("h2",{id:"haskell-optimization-handbook"},"Haskell Optimization Handbook"),(0,r.yg)("p",null,'The "Haskell Optimization Handbook" is an ',(0,r.yg)("a",{parentName:"p",href:"https://github.com/haskellfoundation/tech-proposals/blob/main/proposals/accepted/026-haskell-optimization-handbook.md"},"accepted proposal")," of the Haskell Foundation.\nJeff has been working behind the scene to make this proposal concrete.\nMore about this in the upcoming months."))}u.isMDXComponent=!0},5680:(e,t,n)=>{n.d(t,{xA:()=>g,yg:()=>d});var a=n(6540);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){r(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},g=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef(function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,g=l(e,["components","mdxType","originalType","parentName"]),c=p(n),h=r,d=c["".concat(s,".").concat(h)]||c[h]||u[h]||i;return n?a.createElement(d,o(o({ref:t},g),{},{components:n})):a.createElement(d,o({ref:t},g))});function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"}}]);