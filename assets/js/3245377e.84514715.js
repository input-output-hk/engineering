"use strict";(globalThis.webpackChunkengineering_iog_io=globalThis.webpackChunkengineering_iog_io||[]).push([[7523],{3738:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var r=a(8168),n=(a(6540),a(5680));const i={slug:"2023-06-29-ghc-update",title:"IOG GHC Update #13",authors:["sylvain","doyougnu","luite","josh","bartek"],tags:["ghc","ghc-update"]},l=void 0,o={permalink:"/2023-06-29-ghc-update",editUrl:"https://github.com/input-output-hk/engineering/tree/master/blog/2023-06-29-ghc-update-13.md",source:"@site/blog/2023-06-29-ghc-update-13.md",title:"IOG GHC Update #13",description:"Biweekly update from the GHC DevX team at IOG.",date:"2023-06-29T00:00:00.000Z",formattedDate:"June 29, 2023",tags:[{label:"ghc",permalink:"/tags/ghc"},{label:"ghc-update",permalink:"/tags/ghc-update"}],readingTime:2.525,hasTruncateMarker:!0,authors:[{name:"Sylvain Henry",title:"Haskell DevX Engineer @ IOG",email:"sylvain.henry@iohk.io",key:"sylvain"},{name:"Jeffrey M. Young",title:"Haskell DevX Engineer @ IOG",url:"https://iog.io/en/",key:"doyougnu"},{name:"Luite Stegeman",title:"Haskell DevX Engineer @ IOG",email:"luite.stegeman@iohk.io",key:"luite"},{name:"Joshua Meredith",title:"Haskell DevX Engineer @ IOG",url:"https://iog.io/en/",key:"josh"},{name:"Bart\u0142omiej Cie\u015blar",title:"Haskell DevX Intern @ IOG",email:"bartlomiej.cieslar@iohk.io",key:"bartek"}],frontMatter:{slug:"2023-06-29-ghc-update",title:"IOG GHC Update #13",authors:["sylvain","doyougnu","luite","josh","bartek"],tags:["ghc","ghc-update"]},prevItem:{title:"IOG GHC Update #14",permalink:"/2023-07-13-ghc-update"},nextItem:{title:"Unveiling Cardano's Dynamic P2P: a leap forward in decentralization",permalink:"/2023-06-28-p2p"}},s={authorsImageUrls:[void 0,void 0,void 0,void 0,void 0]},p=[{value:"JavaScript backend",id:"javascript-backend",level:2},{value:"Deprecation warnings",id:"deprecation-warnings",level:2},{value:"Incomplete Record Selectors",id:"incomplete-record-selectors",level:2},{value:"Cabal",id:"cabal",level:2},{value:"GHCi",id:"ghci",level:2},{value:"Miscellaneous",id:"miscellaneous",level:2}],g={toc:p},c="wrapper";function h({components:e,...t}){return(0,n.yg)(c,(0,r.A)({},g,t,{components:e,mdxType:"MDXLayout"}),(0,n.yg)("p",null,"Biweekly update from the GHC DevX team at IOG."),(0,n.yg)("p",null,"Previous updates can be found ",(0,n.yg)("a",{parentName:"p",href:"https://engineering.iog.io/tags/ghc-update"},"here"),"."),(0,n.yg)("h2",{id:"javascript-backend"},"JavaScript backend"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Luite: implemented JS support for running interactive processes via the ",(0,n.yg)("inlineCode",{parentName:"p"},"process")," library by using NodeJS features. See ",(0,n.yg)("a",{parentName:"p",href:"https://github.com/haskell/process/pull/292"},"Process#292"),". This change fixes a major issue with Cabal's custom ",(0,n.yg)("inlineCode",{parentName:"p"},"Setup.hs")," scripts which are built with the JS backend (i.e. when not using haskell.nix) as these scripts need to run other processes such as ",(0,n.yg)("inlineCode",{parentName:"p"},"ghc")," interactively.")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Sylvain: fixed an issue with exception pretty-printing. ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/23565"},"GHC#23565")," and ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10739"},"GHC!10739"),".")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Sylvain: fixed an issue with levity polymorphic data constructors. ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/22360"},"GHC#22360")," and ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10681"},"GHC!10681"),". It also fixed ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/22291"},"GHC#22291")," as a side-effect.")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Sylvain: disabled dumping the ",(0,n.yg)("inlineCode",{parentName:"p"},"eventlog")," into ",(0,n.yg)("inlineCode",{parentName:"p"},"stderr")," by default ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10677"},"GHC!10677"),". We still neeed a better eventlog implementation but at least it fixed the ",(0,n.yg)("inlineCode",{parentName:"p"},"T16707")," test in the ",(0,n.yg)("inlineCode",{parentName:"p"},"stm")," package that was failing fo a reason unrelated to stm.")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Josh: worked on updating ",(0,n.yg)("inlineCode",{parentName:"p"},"ghcjs-dom")," and ",(0,n.yg)("inlineCode",{parentName:"p"},"ghcjs-base")," to support the JS backend. This requires changes to some dependencies that have GHCJS FFI import strings, as well as dependencies that are broken by GHC 9.8.\nSee: ",(0,n.yg)("a",{parentName:"p",href:"https://github.com/haskellari/splitmix/pull/75"},"splitmix!75"))),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Jeff: Changed the CI runner on gitlab to split the JavaScript job into two jobs: a debug build and a performance build. This re-enables performance testing and tracking on GHC's testsuite for the JavaScript backend. ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10576"},"GHC!10576"))),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Jeff: Opened the ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10722"},"JStg")," draft MR. This MR is the next step on the roadmap to add GHCJS's optimizer to the JS backend. It adds a new IR to the JavaScript backend pipeline that allows us to separate concerns in the code base. The current pipeline uses the same IR to write the RTS and garbage collector, as a target to compile STG to  and as a optimization target. As a consequence the IR is not a particularly good optimization target nor a good eDSL for the RTS and GC. With this MR we'll have the beginnings of a good eDSL for the RTS and GC, which allows for a better IR for the code generator and optimizer."))),(0,n.yg)("h2",{id:"deprecation-warnings"},"Deprecation warnings"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Bartek: ",(0,n.yg)("a",{parentName:"li",href:"https://github.com/ghc-proposals/ghc-proposals/blob/master/proposals/0134-deprecating-exports-proposal.rst"},"Deprecating exports proposal")," is now implemented in GHC 9.8")),(0,n.yg)("h2",{id:"incomplete-record-selectors"},"Incomplete Record Selectors"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Bartek: The ",(0,n.yg)("a",{parentName:"li",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10736"},"MR")," for the Incomplete Record Selectors warning is ready, waiting for another ",(0,n.yg)("a",{parentName:"li",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10664"},"MR")," to fix the long-range PMC information in do-notations")),(0,n.yg)("h2",{id:"cabal"},"Cabal"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Josh: added support for ",(0,n.yg)("inlineCode",{parentName:"li"},"js"),"/",(0,n.yg)("inlineCode",{parentName:"li"},"asm"),"/",(0,n.yg)("inlineCode",{parentName:"li"},"cmm")," sources to executable components, and factorised the overlapping code for ",(0,n.yg)("inlineCode",{parentName:"li"},"c"),"/",(0,n.yg)("inlineCode",{parentName:"li"},"cpp"),"/",(0,n.yg)("inlineCode",{parentName:"li"},"js"),"/",(0,n.yg)("inlineCode",{parentName:"li"},"asm"),"/",(0,n.yg)("inlineCode",{parentName:"li"},"cmm")," source handling for both library and executable components.\nSee: ",(0,n.yg)("a",{parentName:"li",href:"https://github.com/haskell/cabal/pull/9061"},"Cabal!9061"),".")),(0,n.yg)("h2",{id:"ghci"},"GHCi"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Luite: added support for large stack offsets in the ByteCode to fix ",(0,n.yg)("a",{parentName:"li",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/22888"},"GHC#22888"),". See ",(0,n.yg)("a",{parentName:"li",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/9957"},"GHC!9957"),".")),(0,n.yg)("h2",{id:"miscellaneous"},"Miscellaneous"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Bartek: Almost finished investigating some of the cases for record fields not emitting custom warnings. See ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/23279"},"GHC#23279")," for details")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Jeff: FUNARCH GHC modularity paper was accepted! See you at ICFP.")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"Sylvain: implemented a ",(0,n.yg)("inlineCode",{parentName:"p"},"-prelude-is")," GHC flag to make the ",(0,n.yg)("inlineCode",{parentName:"p"},"Prelude")," module selectable, following the discussion on ",(0,n.yg)("a",{parentName:"p",href:"https://discourse.haskell.org/t/a-modern-take-on-the-prelude/6619"},"Discourse"),". See ticket ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/issues/23551"},"GHC#23551")," and merge request ",(0,n.yg)("a",{parentName:"p",href:"https://gitlab.haskell.org/ghc/ghc/-/merge_requests/10704"},"GHC!10704"),". Not sure if/when it's going to be merged. Do show your support on the issue if you want this."))))}h.isMDXComponent=!0},5680:(e,t,a)=>{a.d(t,{xA:()=>g,yg:()=>m});var r=a(6540);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach(function(t){n(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function o(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=r.createContext({}),p=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},g=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},c="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef(function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,s=e.parentName,g=o(e,["components","mdxType","originalType","parentName"]),c=p(a),u=n,m=c["".concat(s,".").concat(u)]||c[u]||h[u]||i;return a?r.createElement(m,l(l({ref:t},g),{},{components:a})):r.createElement(m,l({ref:t},g))});function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,l=new Array(i);l[0]=u;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[c]="string"==typeof e?e:n,l[1]=o;for(var p=2;p<i;p++)l[p]=a[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,a)}u.displayName="MDXCreateElement"}}]);