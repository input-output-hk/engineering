<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="IOG Engineering RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="IOG Engineering Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="IOG Engineering JSON Feed"><title data-react-helmet="true">Using GHC&#x27;s JavaScript Backend in the Browser | IOG Engineering</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://engineering.iog.io/2023-01-24-javascript-browser-tutorial"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Using GHC&#x27;s JavaScript Backend in the Browser | IOG Engineering"><meta data-react-helmet="true" name="description" content="In a previous"><meta data-react-helmet="true" property="og:description" content="In a previous"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2023-01-24T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://iog.io/en/,https://iog.io/en/"><meta data-react-helmet="true" property="article:tag" content="ghc,javascript,cross-compilation"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://engineering.iog.io/2023-01-24-javascript-browser-tutorial"><link data-react-helmet="true" rel="alternate" href="https://engineering.iog.io/2023-01-24-javascript-browser-tutorial" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://engineering.iog.io/2023-01-24-javascript-browser-tutorial" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.10ad4647.css">
<link rel="preload" href="/assets/js/runtime~main.59860ed6.js" as="script">
<link rel="preload" href="/assets/js/main.6bf88b75.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/iohk-logo.jpg" alt="IOG" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/iohk-logo.jpg" alt="IOG" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Engineering</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Recent</a><a class="navbar__item navbar__link" href="/tags">Tags</a><a class="navbar__item navbar__link" href="/archive">Archive</a></div><div class="navbar__items navbar__items--right"><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-06-15-ghc-update">IOG GHC Update #12</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-06-01-ghc-update">IOG GHC Update #11</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-05-18-ghc-update">IOG GHC Update #10</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-05-04-ghc-update">IOG GHC Update #9</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2023-04-21-stacks-in-the-js-backend">Stacks in the JavaScript Backend</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_rzP5" itemprop="headline">Using GHC&#x27;s JavaScript Backend in the Browser</h1><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2023-01-24T00:00:00.000Z" itemprop="datePublished">January 24, 2023</time> Â· <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Sylvain Henry</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jeffrey M. Young</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Luite Stegeman</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://iog.io/en/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Joshua Meredith</span></a></div><small class="avatar__subtitle" itemprop="description">Haskell DevX Engineer @ IOG</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>In a previous
<a href="https://engineering.iog.io/2022-12-13-ghc-js-backend-merged" target="_blank" rel="noopener noreferrer">post</a> we
introduced GHC&#x27;s new JavaScript backend, which allows the compilation of Haskell
code into JavaScript. This is the first tutorial in a new series about the
JavaScript backend. In this post, we&#x27;ll build GHC as
a JavaScript cross-compiler and run a trivial Haskell program in the browser.</p><p>We plan to write more of those blog post in the coming weeks and
months as we add new features (e.g. support for &quot;foreign exports&quot; that will
allow JavaScript code to call into Haskell code, support for Template Haskell,
etc.). For now it relies on our &quot;insider&quot; knowledge (e.g. how the FFI works)
that isn&#x27;t well documented elsewhere. We do plan to add a chapter about the
JavaScript backend in GHC&#x27;s user guide, but for now your best chance is to look
at GHCJS&#x27;s documentation or at the source code.</p><p>Please note: this is a technology preview of the in-development JavaScript backend
for GHC. Not all Haskell features are implemented, and bugs are expected. It is
currently rather complicated for JavaScript code to call into Haskell code (&quot;foreign
exports&quot; aren&#x27;t implemented). GHC isn&#x27;t a multi-target compiler yet, so a GHC executable
built for a native platform (Linux/x86-64, Windows/x86-64, Darwin/AArch64...) as currently distributed (via ghcup, Stack, binary distributions, etc.) won&#x27;t be able to produce JavaScript. Official prebuilt binary distributions are likely to remain
unavailable until GHC gains multi-target support - requiring the JavaScript backend
to be built from source even after the backend matures.
That&#x27;s why we start this post with the required steps to build yourself
a GHC compiler capable of producing JavaScript.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="building-ghc-as-a-cross-compiler-to-javascript">Building GHC as a Cross Compiler to JavaScript<a class="hash-link" href="#building-ghc-as-a-cross-compiler-to-javascript" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="installing-dependencies">Installing Dependencies<a class="hash-link" href="#installing-dependencies" title="Direct link to heading">â€‹</a></h3><p>First we need to install all the typical dependencies for GHC plus <code>Emscripten</code>,
so our final list is:</p><ul><li>GHC version 9.2 or later</li><li>Cabal</li><li>Alex</li><li>Happy</li><li>Emscripten to configure with</li><li>(Optional) NodeJS to run JavaScript locally</li></ul><p>Let&#x27;s take these in order, a standard GHC distribution with Cabal is needed so we can boot our new compiler.
We recommend using  GHCUP
(<a href="https://www.haskell.org/ghcup/install/" target="_blank" rel="noopener noreferrer">https://www.haskell.org/ghcup/install/</a>),
or your system&#x27;s package manager to install the this. </p><p>We need Alex and Happy to build GHC, these can be installed through Cabal:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">cabal install alex happy -j</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We need Emscripten during the <code>configure</code> step of the build. <code>Emscripten</code> should be available in most package managers, but you can also build and install it from source:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/emscripten-core/emsdk.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd emsdk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./emsdk install latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./emsdk activate latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source ./emsdk_env.sh</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>After installing Emscripten, <code>emconfigure</code> should be available on your system
path. Use <code>which emconfigure</code> to check that it is on your <code>$PATH</code>. If you built
from source, then the output should point to a location within the emsdk git
project like so:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ which emconfigure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/path/to/emsdk/upstream/emscripten/emconfigure</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>For more detailed installation instructions, see <a href="https://emscripten.org/docs/getting_started/downloads.html" target="_blank" rel="noopener noreferrer">https://emscripten.org/docs/getting_started/downloads.html</a>. </p><p>That&#x27;s all we need to build GHC as a cross compiler. NodeJS can be installed via your system&#x27;s package manager if you want to run the JavaScript programs locally. We&#x27;ll assume it&#x27;s in your <code>$PATH</code> for the rest of the blog post.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="building-ghc">Building GHC<a class="hash-link" href="#building-ghc" title="Direct link to heading">â€‹</a></h3><p>With all the dependencies installed, we can clone GHC HEAD and build the cross compiler:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://gitlab.haskell.org/ghc/ghc.git --recursive</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You should notice quite a few submodules being cloned as well as the main repo; expect this to take a while. Once this has completed, navigate to the <code>ghc</code> directory and run the following configuration commands:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">cd ghc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./boot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">emconfigure ./configure --target=javascript-unknown-ghcjs</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>emconfigure ./configure --target=javascript-unknown-ghcjs</code> will finish by outputting a screen that looks like:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Configure completed successfully.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Building GHC version  : 9.5.20221219</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Git commit id  : 761c1f49f55afc9a9f290fafb48885c2033069ed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Build platform        : x86_64-unknown-linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Host platform         : x86_64-unknown-linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Target platform       : javascript-unknown-ghcjs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Bootstrapping using   : /home/josh/.ghcup/bin/ghc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      which is version   : 9.4.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      with threaded RTS? : YES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Using (for bootstrapping) : gcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Using clang               : /home/josh/emsdk/upstream/emscripten/emcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      which is version       : 15.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      linker options         :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Building a cross compiler : YES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Unregisterised            : NO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   TablesNextToCode          : YES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Build GMP in tree         : NO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   hs-cpp       : /home/josh/emsdk/upstream/emscripten/emcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   hs-cpp-flags : -E -undef -traditional -Wno-invalid-pp-token -Wno-unicode -Wno-trigraphs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ar           : /home/josh/emsdk/upstream/emscripten/emar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ld           : /home/josh/emsdk/upstream/emscripten/emcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   nm           : /home/josh/emsdk/upstream/bin/llvm-nm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   objdump      : /usr/bin/objdump</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ranlib       : /home/josh/emsdk/upstream/emscripten/emranlib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   otool        : otool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   install_name_tool : install_name_tool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   windres      :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   dllwrap      :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   genlib       :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Happy        : /home/josh/.cabal/bin/happy (1.20.0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Alex         : /home/josh/.cabal/bin/alex (3.2.7.1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   sphinx-build :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   xelatex      :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   makeinfo     :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   git          : /usr/bin/git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   cabal-install : /home/josh/.cabal/bin/cabal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Using LLVM tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      clang : clang</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      llc   : llc-14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      opt   : opt-14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   HsColour was not found; documentation will not contain source links</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Tools to build Sphinx HTML documentation available: NO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Tools to build Sphinx PDF documentation available: NO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Tools to build Sphinx INFO documentation available: NO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----------------------------------------------------------------------</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If everything is correct, you&#x27;ll see that the <code>Target platform</code> is set to
<code>javascript-unknown-ghcjs</code>, and the build tools will be set to their
Emscripten counterparts: <code>ar</code> becomes <code>emar</code>, <code>nm</code> becomes <code>llvm-nm</code>, etc.</p><p>Finally, to build GHC:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">./hadrian/build --bignum=native -j --docs=none</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Expect this to take around a half hour or longer. If all goes well you should see:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">/--------------------------------------------------------\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Successfully built library &#x27;ghc&#x27; (Stage1, way p).      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Library: _build/stage1/compiler/build/libHSghc-9.5_p.a |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Library synopsis: The GHC API.                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\--------------------------------------------------------/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Copy package &#x27;ghc&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cabal-copy (for _build/stage1/lib/package.conf.d/ghc-9.5.conf)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Run GhcPkg Recache Stage1: none =&gt; none</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Copy file: _build/stage0/bin/javascript-unknown-ghcjs-ghc =&gt; _build/stage1/bin/javascript-unknown-ghcjs-ghc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Build completed in 1h00m</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Take note of <code>_build/stage1/bin/javascript-unknown-ghcjs-ghc</code> path. This is the GHC executable that we&#x27;ll use to compile to JavaScript. To make life easier on ourselves we can alias it:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">alias ghc-js=`pwd`/_build/stage1/bin/javascript-unknown-ghcjs-ghc</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="first-haskell-to-javascript-program">First Haskell to JavaScript Program<a class="hash-link" href="#first-haskell-to-javascript-program" title="Direct link to heading">â€‹</a></h2><p>Now that we have a version of GHC that can output JavaScript, let&#x27;s compile a Haskell program and run it with NodeJS. Make a file named &quot;HelloJS.hs&quot;, with the following contents:</p><div class="codeBlockContainer_I0IT language-haskell theme-code-block"><div class="codeBlockContent_wNvx haskell"><pre tabindex="0" class="prism-code language-haskell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">-- HelloJS.hs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module Main where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main :: IO ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main = putStrLn &quot;Hello, JavaScript!&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Now we can compile it using the alias we defined earlier:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ghc-js HelloJS.hs</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You should see the following output, and a <code>HelloJS</code> executable.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">[1 of 2] Compiling Main             ( HelloJS.hs, HelloJS.o )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2 of 2] Linking HelloJS.jsexe</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If you have NodeJS is on your <code>Path</code>, then this executable can be run just like any other command line program:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">./HelloJS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello, JavaScript!</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Notice that a directory called <code>HelloJS.jsexe</code> was created. This directory
contains all the final JavaScript code, including a file named <code>all.js</code>, and a
minimal <code>index.html</code> HTML file that wraps <code>all.js</code>. For now, we&#x27;ll only care
about <code>all.js</code> and return to <code>index.html</code> later. <code>all.js</code> <em>is</em> the payload of our
<code>HelloJS</code> exectuable. The executable is simply a copy of <code>all.js</code>, with a call
to <code>node</code> added to the top. We could have equivalently run our program with:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">node HelloJS.jsexe/all.js</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="haskell-in-the-browser">Haskell in the Browser<a class="hash-link" href="#haskell-in-the-browser" title="Direct link to heading">â€‹</a></h2><p>We saw in the previous example that GHC&#x27;s JavaScript backend allows us to write
Haskell and run the output JavaScript with NodeJS. This produces a portable
executable, but otherwise doesn&#x27;t enable anything we couldn&#x27;t do before; GHC can
already compile Haskell to run on most platforms! So let&#x27;s do something novel,
and run Haskell in the browser.</p><p>In this example, we&#x27;ll use Haskell to draw a simple SVG circle to our browser window. Put the following code in a file named <code>HelloBrowser.hs</code>:</p><div class="codeBlockContainer_I0IT language-haskell theme-code-block"><div class="codeBlockContent_wNvx haskell"><pre tabindex="0" class="prism-code language-haskell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">-- HelloBrowser.hs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module Main where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import Foreign.C.String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foreign import javascript &quot;((arr,offset) =&gt; document.body.innerHTML = h$decodeUtf8z(arr,offset))&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  setInnerHtml :: CString -&gt; IO ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">circle :: String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">circle = &quot;&lt;svg width=300 height=300&gt;&lt;circle cx=50% cy=50% r=50%&gt;&lt;/circle&gt;&lt;/svg&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main :: IO ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main = withCString circle setInnerHtml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Notice that we&#x27;ve encountered a Haskell feature that&#x27;s only available in the
JavaScript backend: JavaScript foreign imports. This feature allows our Haskell
program to call JavaScript functions. In our example we use this feature to call
a JavaScript <a href="https://262.ecma-international.org/13.0/#prod-ArrowFunction" target="_blank" rel="noopener noreferrer">arrow
function</a> that
updates the <code>body</code> of the page with our HTML snippet containing a drawing of a
circle. Alternatively, we could have set the foreign import to a function symbol
like so:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">foreign import javascript &quot;setInnerHTML&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  setInnerHtml :: CString -&gt; IO ()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>where <code>setInnerHTML</code> is defined in a <code>.js</code> file that is then loaded
by passing the JavaScript file to GHC along with the Haskell sources.</p><p>Next, we can compile our program to JavaScript, again with our built GHC:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ghc-js HelloBrowser.hs</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Or <code>ghc-js HelloBrowser.hs foo.js</code> if <code>setInnerHTML</code> is defined in <code>foo.js</code>.</p><p>Recall the <code>index.html</code> file inside the <code>HelloBrowser.jsexe</code> directory. This HTML
file has our compiled JavaScript already included, so if you open it in your
browser, you&#x27;ll find it loads our SVG circle in the top-left of the page!</p><p><img alt="Example webpage screenshot" src="data:image/png;base64,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JoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhACUJoQAlCaEAJQmhAAU9u9//19DGrzCtvYzlwAAAABJRU5ErkJggg==" width="600" height="600"></p><p><code>index.html</code> contains the minimal HTML code required to load the generated JavaScript code. It simply loads the <code>all.js</code> file mentioned above with the following <code>script</code> tag that you can reuse in your own HTML files:</p><div class="codeBlockContainer_I0IT language-html theme-code-block"><div class="codeBlockContent_wNvx html"><pre tabindex="0" class="prism-code language-html codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">language</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">javascript</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">all.js</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">defer</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>As the JS backend still lacks support for some FFI features (foreign exports, foreign &quot;wrapper&quot; imports...), JavaScript codes can&#x27;t easily interact with Haskell codes. It reduces the amount of advanced/interesting examples we can present for now. We&#x27;ll publish new blog posts illustrating these features when they will be implemented.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">â€‹</a></h2><p>In this post, we&#x27;ve seen how to build a first Haskell program to run in the browser using a preview of GHC&#x27;s in-development JavaScript backend. This program used &quot;foreign imports&quot; to make a JavaScript function available within the Haskell code, which allows a limited interaction between Haskell and the browser. We also saw the structure of the outputs of the JavaScript backend, in the <code>.jsexe</code> directory, and how this allows our Haskell program to be invoked by a custom HTML wrapper. This was all enabled by building a version of GHC from source, with the build process having been configured with Emscripten to produce a GHC exectuable that targets JavaScript.</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_h6_j"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ghc">ghc</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/javascript">javascript</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/cross-compilation">cross-compilation</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/2023-01-26-hs-bindgen-introduction"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">One step forward, an easier interoperability between Rust and Haskell</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/2023-01-12-ghc-update"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">GHC DevX Update 2023-01-12</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_cNA8 thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#building-ghc-as-a-cross-compiler-to-javascript" class="table-of-contents__link toc-highlight">Building GHC as a Cross Compiler to JavaScript</a><ul><li><a href="#installing-dependencies" class="table-of-contents__link toc-highlight">Installing Dependencies</a></li><li><a href="#building-ghc" class="table-of-contents__link toc-highlight">Building GHC</a></li></ul></li><li><a href="#first-haskell-to-javascript-program" class="table-of-contents__link toc-highlight">First Haskell to JavaScript Program</a></li><li><a href="#haskell-in-the-browser" class="table-of-contents__link toc-highlight">Haskell in the Browser</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/iog_eng" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://iohk.io/en/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">IOG Blog</a></li><li class="footer__item"><a href="https://github.com/input-output-hk/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 IOG Engineering, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.59860ed6.js"></script>
<script src="/assets/js/main.6bf88b75.js"></script>
</body>
</html>